# 标题场景-变化颜色的外框

<link rel="stylesheet" href="/css/videoStyles.css" />

<div class="video-container">
  <div class="video-tabs">
    <a href="#bilibili" class="video-tab bilibili-tab">哔哩哔哩</a>
    <a href="#youtube" class="video-tab youtube-tab">YouTube</a>
  </div>

  <div id="youtube" class="video-content">
    <iframe 
      class="video-frame"
      src="https://www.youtube.com/embed/X2eaQnsRC84?si=2EcHHYM5GRGXjVJ4" 
      frameborder="0" 
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
      allowfullscreen>
    </iframe>
  </div>
  
  <div id="bilibili" class="video-content">
    <iframe 
      class="video-frame"
      src="//player.bilibili.com/player.html?bvid=BV1naRUYmEQp&page=1&autoplay=0&danmaku=0&high_quality=1" 
      scrolling="no" 
      border="0" 
      frameborder="no" 
      framespacing="0" 
      allowfullscreen="true">
    </iframe>
  </div>
</div>

在游戏开发中，标题场景（Title Scene）是玩家启动游戏后首先看到的界面，它不仅展示游戏名称和基本信息，还能通过视觉效果给玩家留下第一印象。本课我们将实现一个简约而动态的标题场景，其特色是具有随时间变化颜色的外框，为游戏增添视觉吸引力。

<img src="https://theorhythm.top/gamedev/GE/26-标题场景-变化颜色的外框.PNG" style='width: 800px;' />

## 一、标题场景的设计需求

对于一个标题场景，我们有以下设计需求：

1. **信息展示**：清晰显示游戏名称和关键信息（如最高分）
2. **视觉吸引**：使用动态效果（如颜色变化）吸引玩家的注意力
3. **简洁直观**：界面设计简洁明了，让玩家一目了然
4. **情感渲染**：通过视觉设计营造游戏的整体氛围和风格

## 二、创建标题场景类

首先，我们创建一个`SceneTitle`类来专门管理标题场景：

```cpp
// scene_title.h
#ifndef SCENE_TITLE_H
#define SCENE_TITLE_H

#include "core/scene.h"

class SceneTitle : public Scene
{
protected:
    SDL_FColor boundary_color_ = {0.5, 0.5, 0.5, 1};
    float color_timer_ = 0;

public:
    void init() override;
    void handleEvents(SDL_Event& event) override;
    void update(float dt) override;
    void render() override;
    void clean() override;

private:
    void renderBackground();
    void updateColor();
};

#endif // SCENE_TITLE_H
```

`SceneTitle`类继承自基础的`Scene`类，并添加了两个额外的成员变量：
- `boundary_color_`：用于存储边界线的颜色
- `color_timer_`：用于记录时间，以便计算颜色变化

同时，我们添加了两个辅助方法：
- `renderBackground()`：渲染背景和边界线
- `updateColor()`：根据时间更新边界线的颜色

## 三、实现标题场景功能

### 1. 场景初始化

在标题场景的初始化方法中，我们设置文本显示：

```cpp
// scene_title.cpp
void SceneTitle::init()
{
    Scene::init();
    auto size = glm::vec2(game_.getScreenSize().x/2.0f, game_.getScreenSize().y/3.0f);
    HUDText::addHUDTextChild(this, "幽 灵 逃 生", game_.getScreenSize() / 2.0f - glm::vec2(0, 100), size, "assets/font/VonwaonBitmap-16px.ttf", 64);
    auto score_text = "最高分: " + std::to_string(game_.getHighScore());
    HUDText::addHUDTextChild(this, score_text, game_.getScreenSize() / 2.0f + glm::vec2(0, 100), glm::vec2(200, 50), "assets/font/VonwaonBitmap-16px.ttf", 32);
}
```

这段代码执行以下操作：
1. 首先调用父类的初始化方法
2. 创建一个足够大的区域来容纳游戏标题
3. 使用`HUDText`在屏幕中上方显示游戏标题"幽 灵 逃 生"
4. 在屏幕中下方显示最高分信息

这里我们利用了前面课程中开发的`HUDText`类，它可以方便地创建带背景的文本显示。

### 2. 事件处理、更新和清理

事件处理和清理方法相对简单，主要是调用父类的对应方法：

```cpp
void SceneTitle::handleEvents(SDL_Event &event)
{
    Scene::handleEvents(event);
}

void SceneTitle::clean()
{
    Scene::clean();
}
```

更新方法需要额外处理颜色变化的时间计算：

```cpp
void SceneTitle::update(float dt)
{
    Scene::update(dt);
    color_timer_ += dt;
    updateColor();
}
```

每次更新时，我们增加时间计数器并调用`updateColor()`方法计算新的颜色。

### 3. 渲染方法

渲染方法负责绘制场景的所有视觉元素：

```cpp
void SceneTitle::render()
{
    renderBackground();
    Scene::render();
}
```

首先调用`renderBackground()`绘制背景和边界，然后通过父类的`render()`方法绘制场景中的所有子对象（包括之前添加的文本）。

### 4. 背景渲染和颜色更新

这两个方法是标题场景的核心特色：

```cpp
void SceneTitle::renderBackground()
{
    game_.drawBoundary(glm::vec2(30.0f), game_.getScreenSize() - glm::vec2(30.0f), 10.0f, boundary_color_);
}
```

`renderBackground()`方法使用`Game`类的`drawBoundary()`方法在屏幕边缘绘制一个彩色边框。参数依次是：
- 左上角坐标（屏幕边缘向内30像素）
- 右下角坐标（屏幕边缘向内30像素）
- 边框宽度（10像素）
- 边框颜色

```cpp
void SceneTitle::updateColor()
{
    boundary_color_.r = 0.5f + 0.5f * sinf(color_timer_ * 0.9f);
    boundary_color_.g = 0.5f + 0.5f * sinf(color_timer_ * 0.8f);
    boundary_color_.b = 0.5f + 0.5f * sinf(color_timer_ * 0.7f);
}
```

`updateColor()`方法使用正弦函数计算颜色的RGB分量。通过使用不同的频率（0.9f, 0.8f, 0.7f），我们创造了一个彩虹般的颜色变化效果：
- 基础值0.5f确保颜色分量至少为50%亮度
- 添加的0.5f * sin()部分使颜色在0-1范围内波动
- 不同频率使红、绿、蓝三个分量以不同速度变化，产生丰富的颜色组合

## 四、在游戏中应用标题场景

要在游戏中应用标题场景，我们需要修改游戏的初始化代码，让游戏启动时加载标题场景而非直接进入主游戏场景：

```cpp
// game.cpp
void Game::init(std::string title, int width, int height)
{
    // ... 其他初始化代码 ...
    
    // 创建场景
    current_scene_ = new SceneTitle();
    current_scene_->init();
}
```

修改之前，游戏启动时直接创建并初始化`SceneMain`；修改之后，游戏启动时创建并初始化`SceneTitle`。

<img src="https://theorhythm.top/gamedev/GE/26-标题场景-变化颜色的外框截图.png" style='width: 800px;' />

## 五、正弦函数在视觉效果中的应用

值得关注的是我们使用正弦函数创建平滑颜色变化的技巧。正弦函数在游戏视觉效果中非常有用，因为：

1. **周期性**：正弦函数是周期性的，可以创造循环动画效果
2. **平滑过渡**：正弦函数在周期内变化平滑，没有突兀的跳变
3. **可预测性**：正弦函数的取值范围固定在[-1, 1]，便于映射到其他值域（如颜色值）
4. **相位差**：通过设置不同的频率和相位，可以创造丰富多样的组合效果

在我们的实现中，使用了不同频率的正弦函数来计算RGB分量，这种技巧可以应用到游戏中的许多其他视觉效果，如脉动、波动、闪烁等。

## 总结

在本课中，我们实现了一个带有动态彩色边框的标题场景：

1. 设计并实现了`SceneTitle`类，继承自基础的`Scene`类
2. 使用`HUDText`在标题场景中显示游戏名称和最高分信息
3. 实现了边框颜色随时间变化的效果，使用正弦函数创造平滑过渡
4. 修改游戏初始化代码，使游戏启动时加载标题场景

标题场景作为游戏的"门面"，给玩家留下第一印象，其设计对玩家体验有重要影响。通过简单而有效的动态视觉效果，我们可以增强游戏的吸引力和专业感。

## 练习

1. 修改标题场景，添加一个"开始游戏"按钮，点击后切换到主游戏场景
2. 尝试使用不同的颜色变化函数，如余弦、线性插值等，观察效果变化
3. 为标题文本添加缩放动画，使文本大小随时间轻微变化
4. 利用上一课学到的音频功能，为标题场景添加背景音乐
5. 扩展标题场景，添加游戏说明、制作人员等信息