# UI-血量图标

<link rel="stylesheet" href="/css/videoStyles.css" />

<div class="video-container">
  <div class="video-tabs">
    <a href="#bilibili" class="video-tab bilibili-tab">哔哩哔哩</a>
    <a href="#youtube" class="video-tab youtube-tab">YouTube</a>
  </div>

  <div id="youtube" class="video-content">
    <iframe 
      class="video-frame"
      src="https://www.youtube.com/embed/YVpfnVgmyKM?si=yRKkiCOPMjW87ryI" 
      frameborder="0" 
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
      allowfullscreen>
    </iframe>
  </div>

  <div id="bilibili" class="video-content">
    <iframe 
      class="video-frame"
      src="//player.bilibili.com/player.html?bvid=BV1FMcEe5EJV&page=1&autoplay=0&danmaku=0&high_quality=1" 
      scrolling="no" 
      border="0" 
      frameborder="no" 
      framespacing="0" 
      allowfullscreen="true">
    </iframe>
  </div>
</div>

在上一课中，我们实现了星空背景卷轴效果，使游戏场景更加丰富和动感。然而，玩家仍然无法直观地了解自己当前的生命值状态。在这一课中，我们将实现血量UI图标，使玩家能够清晰地看到自己的生命值情况。

<img src="https://theorhythm.top/gamedev/SS/21 UI-血量图标.PNG" style='width: 800px;' />

## 游戏UI的重要性

用户界面（User Interface，简称UI）是游戏中至关重要的一部分，它为玩家提供了与游戏交互的接口和反馈。一个设计良好的UI应该：

1. **提供重要信息**：如玩家的生命值、得分、弹药量等
2. **直观易懂**：使用图标、颜色、动画等方式表达信息，让玩家一目了然
3. **不干扰游戏体验**：UI元素应适当放置，不遮挡主要游戏内容
4. **与游戏风格一致**：UI的视觉风格应与游戏整体美术风格协调一致

在射击游戏中，生命值显示是最基本也是最重要的UI元素之一。它让玩家知道自己还能承受多少伤害，从而调整游戏策略。

## 1. 添加UI纹理成员变量

首先，我们在`SceneMain.h`文件中添加一个UI纹理成员变量，用于存储血量图标：

```cpp
// SceneMain.h
class SceneMain : public Scene {
public:
    // ...现有方法...
    void renderUI();

private:
    // ...现有成员...
    SDL_Texture* uiHealth;
};
```

我们添加了两个新成员和方法：
- `uiHealth`：血量图标的纹理
- `renderUI()`：渲染UI的方法

## 2. 加载血量图标资源

在`SceneMain.cpp`的`init()`方法中，我们需要加载血量图标资源：

```cpp
// SceneMain.cpp
void SceneMain::init()
{
    // 读取并播放背景音乐
    // ...前面的代码保持不变

    // 读取ui Health
    uiHealth = IMG_LoadTexture(game.getRenderer(), "assets/image/Health UI Black.png");

    // ...后面的代码保持不变
}
```

这段代码使用`IMG_LoadTexture()`函数加载血量图标图片，并将其纹理存储在`uiHealth`成员变量中。

## 3. 清理UI资源

在`SceneMain.cpp`的`clean()`方法中，我们需要添加清理UI资源的代码：

```cpp
// SceneMain.cpp
void SceneMain::clean()
{
    // ...前面的代码保持不变

    // 清理ui
    if (uiHealth != nullptr){
        SDL_DestroyTexture(uiHealth);
    }

    // ...后面的代码保持不变
}
```

这段代码确保在游戏结束时释放血量图标的纹理资源，防止内存泄漏。

## 4. 实现渲染UI方法

接下来，我们实现`renderUI()`方法，用于渲染血量图标：

```cpp
// SceneMain.cpp
void SceneMain::renderUI()
{
    int x = 10;
    int y = 10;
    int size = 32;
    int offset = 40;
    SDL_SetTextureColorMod(uiHealth, 100, 100, 100); // 颜色减淡
    for (int i = 0; i < player.maxHealth; i++)
    {
        SDL_Rect rect = {x + i * offset, y, size, size};
        SDL_RenderCopy(game.getRenderer(), uiHealth, NULL, &rect);
    }
    SDL_SetTextureColorMod(uiHealth, 255, 255, 255); // reset color
    for (int i = 0; i < player.currentHealth; i++)
    {
        SDL_Rect rect = {x + i * offset, y, size, size};
        SDL_RenderCopy(game.getRenderer(), uiHealth, NULL, &rect);
    }
}
```

这个方法实现了一个简单而直观的血量显示系统：

1. 首先，设置绘制参数：血量图标的起始位置（左上角坐标）、大小和间隔
2. 调用`SDL_SetTextureColorMod()`函数将血量图标的颜色调暗，然后绘制所有可能的血量图标（对应最大生命值）
3. 重置图标颜色，然后绘制当前实际的血量图标（对应当前生命值）

这种方法通过颜色对比显示了玩家已损失的生命值（暗色图标）和剩余的生命值（亮色图标），使玩家能够直观地了解自己的生命值状态。

## 5. 更新游戏渲染循环

最后，我们需要在游戏渲染循环中调用`renderUI()`方法：

```cpp
// SceneMain.cpp
void SceneMain::render()
{
    // 渲染玩家子弹
    renderPlayerProjectiles();
    //渲染敌机子弹
    renderEnemyProjectiles();
    // 渲染玩家
    if (!isDead){
        SDL_Rect playerRect = { static_cast<int>(player.position.x), 
                        static_cast<int>(player.position.y), 
                        player.width, 
                        player.height};
        SDL_RenderCopy(game.getRenderer(), player.texture, NULL, &playerRect);
    }
    // 渲染敌人
    renderEnemies();
    // 渲染物品
    renderItems();
    // 渲染爆炸效果
    renderExplosions();
    // 渲染UI
    renderUI();
}
```

在`render()`方法的最后，我们添加了对`renderUI()`的调用，以渲染血量图标。渲染顺序很重要，我们将UI放在最后渲染，确保它显示在所有游戏元素之上。

## 调整纹理颜色

在实现过程中，我们使用了`SDL_SetTextureColorMod()`函数来调整纹理的颜色。这个函数允许我们在不改变原始纹理的情况下，修改纹理渲染时的颜色调制值，公式如下：

```
finalColor = textureColor * colorMod / 255
```

当我们设置`colorMod`为`(100, 100, 100)`时，纹理的每个颜色通道(R, G, B)都会被调暗到原来的约39%（100/255），使图标看起来更暗，表示已损失的生命值。

当我们重置`colorMod`为`(255, 255, 255)`时，纹理的颜色会保持原样，表示当前的生命值。

## 完成效果

实现上述代码后，游戏右上角将显示一排血量图标，反映玩家当前的生命值状态。当玩家受到伤害时，相应的图标会变暗，当玩家获得生命物品时，图标会重新变亮。这样，玩家就能清晰地了解自己的生命值情况，更好地规划游戏策略。

<img src="https://theorhythm.top/gamedev/SS/21 UI-血量图标截图.png" style='width: 800px;' />

## 总结

在本课中，我们实现了血量UI图标，使玩家能够直观地了解自己的生命值状态。我们学习了：

1. 如何添加和加载UI纹理资源
2. 如何实现单独的渲染UI方法
3. 如何使用颜色调制表示不同状态的UI元素
4. 如何在游戏渲染循环中集成UI渲染
5. 如何清理UI资源，防止内存泄漏

这些技术为实现更复杂的游戏UI奠定了基础，你可以在此基础上添加更多UI元素，如得分显示、武器状态、游戏时间等，使游戏更加完整和用户友好。

## 练习

1. 尝试为游戏添加得分显示UI，记录玩家击落敌机的数量，并在屏幕右上角显示得分。

2. 实现一个简单的游戏暂停菜单，当玩家按下ESC键时，显示暂停菜单，并提供继续游戏和返回主菜单的选项。

3. 添加武器能量条UI，显示玩家武器的冷却状态，使玩家能够更好地掌握射击节奏。

4. 设计并实现一个游戏开始倒计时UI，在游戏开始前倒计时3秒，增强游戏的紧张感和准备时间。
