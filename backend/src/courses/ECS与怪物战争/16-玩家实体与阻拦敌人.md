# 16 ç©å®¶å®ä½“ä¸é˜»æ‹¦æ•Œäºº

<div class="video-container">
  <div id="bilibili" class="video-content">
    <!-- Bç«™åµŒå…¥ï¼šä½¿ç”¨ https æ˜ç¡®åè®®ï¼ˆé¿å… file:// æˆ– http å¯¼è‡´è¢«æµè§ˆå™¨æ‹¦æˆªï¼‰ -->
    <iframe
      class="video-frame"
      src="https://player.bilibili.com/player.html?bvid=BV1iJyjBSEBr&page=1&autoplay=0&danmaku=0&high_quality=1"
      width="100%"
      height="480"
      scrolling="no"
      frameborder="0"
      allowfullscreen>
    </iframe>
  </div>
</div>

[åœ¨ Bilibili ä¸Šè§‚çœ‹](https://www.bilibili.com/video/BV1iJyjBSEBr)

## ğŸ“– æ¦‚è¿°

ä¸Šä¸€èŠ‚æˆ‘ä»¬å·²ç»å»ºç«‹äº†â€œè“å›¾ + å·¥å‚â€ä½“ç³»ï¼Œå¹¶ç”¨å®ƒæŠŠæ•Œäººä»æ‰‹å†™ `emplace` å˜æˆäº†æ•°æ®é©±åŠ¨çš„åˆ›å»ºæµç¨‹ã€‚

ä½†å¡”é˜²ç©æ³•è¦è·‘èµ·æ¥ï¼Œ**åªæœ‰æ•Œäººè¿˜ä¸å¤Ÿ**ï¼šæˆ‘ä»¬å¾—èƒ½æ”¾ç½®ç©å®¶å•ä½ï¼Œå¹¶è®©è¿‘æˆ˜å•ä½èƒ½â€œæ‹¦ä½â€æ•Œäººï¼Œå½¢æˆæœ€åŸºç¡€çš„å¯¹æŠ—å…³ç³»ã€‚

è¿™ä¸€èŠ‚çš„ç›®æ ‡å¯ä»¥æµ“ç¼©æˆä¸¤å¥è¯ï¼š

- **ç©å®¶ä¹Ÿè¦èµ°â€œè“å›¾ + å·¥å‚â€**ï¼šæŠŠç©å®¶èŒä¸šï¼ˆæˆ˜å£«/å¼“ç®­æ‰‹/æªå…µ/å¥³å·«ï¼‰çš„å±æ€§ã€èŠ±è´¹ã€åŠ¨ç”»ç­‰é…ç½®å†™è¿› JSONï¼Œå†äº¤ç»™ `EntityFactory` ç”Ÿæˆå®ä½“ã€‚
- **å¼•å…¥é˜»æŒ¡ç³»ç»Ÿï¼ˆBlockSystemï¼‰**ï¼šå½“æ•Œäººè¿›å…¥é˜»æŒ¡åŠå¾„æ—¶åœæ­¢ç§»åŠ¨ï¼Œå¹¶è®°å½•è‡ªå·±â€œè¢«è°é˜»æŒ¡â€ï¼›é˜»æŒ¡è€…ä¹Ÿéœ€è¦è®°å½•â€œæœ€å¤šèƒ½æ‹¦å‡ ä¸ªã€ç°åœ¨æ‹¦äº†å‡ ä¸ªâ€ã€‚

<img src="https://theorhythm.top/gamedev/MW/æ€ªç‰©æˆ˜äº‰.066.webp" style='width: 800px;' />

> PPT ç¬¬ 66 é¡µï¼šé˜»æŒ¡ç³»ç»Ÿçš„æ¦‚å¿µå›¾ï¼ˆé˜»æŒ¡è€… / è¢«é˜»æŒ¡è€… / é˜»æŒ¡åŠå¾„ï¼‰

æœ¬èŠ‚å¯¹åº”ä»£ç æ ‡ç­¾ï¼š`16-ç©å®¶å®ä½“ä¸é˜»æ‹¦æ•Œäºº`ï¼ˆåŸºçº¿ï¼š`15-å®ä½“å·¥å‚ä¸è“å›¾`ï¼‰ã€‚

## ğŸ¯ å­¦ä¹ ç›®æ ‡

- æ–°å¢ç©å®¶èŒä¸šæ•°æ® `assets/data/player_data.json`ï¼Œç†è§£å®ƒä¸æ•Œäººé…ç½®çš„å…±é€šç‚¹ä¸å·®å¼‚ç‚¹
- æ‰©å±•è“å›¾ç»“æ„ï¼šæ–°å¢ `PlayerBlueprint / PlayerClassBlueprint`ï¼Œå¹¶åœ¨ `BlueprintManager` ä¸­åŠ è½½ç©å®¶è“å›¾
- æ‰©å±•å®ä½“å·¥å‚ï¼šå®ç° `EntityFactory::createPlayerUnit()` ä¸ `addPlayerComponent()`ï¼Œç»™ç©å®¶è¡¥é½â€œèŠ±è´¹ / èŒä¸šç±»å‹ / é˜»æŒ¡èƒ½åŠ›â€ç­‰ä¿¡æ¯
- å¼•å…¥é˜»æŒ¡ç›¸å…³ç»„ä»¶ä¸ç³»ç»Ÿï¼š`BlockerComponent / BlockedByComponent / BlockSystem`
- ç”¨äº‹ä»¶è§£è€¦åŠ¨ç”»åˆ‡æ¢ï¼šé€šè¿‡ `PlayAnimationEvent` è®©ç³»ç»Ÿè§¦å‘â€œèµ°è·¯/æ”»å‡»â€ç­‰åŠ¨ç”»ï¼ˆä¸ç›´æ¥æ”¹ç»„ä»¶ï¼‰

## ğŸ—‚ï¸ 1) ç©å®¶èŒä¸šæ•°æ®ï¼š`assets/data/player_data.json`

æœ¬èŠ‚æ–°å¢ç©å®¶èŒä¸šé…ç½®æ–‡ä»¶ï¼š`assets/data/player_data.json`ï¼Œç»“æ„ä¸ä¸Šä¸€èŠ‚çš„ `enemy_data.json` ç±»ä¼¼ï¼šé¡¶å±‚ key æ˜¯èŒä¸šåï¼ˆå¦‚ `warrior/archer`ï¼‰ï¼Œvalue æ˜¯èŒä¸šé…ç½®ã€‚

å…¶ä¸­æœ€å…³é”®çš„å­—æ®µæœ‰ï¼š

- **å±æ€§ï¼ˆstatsï¼‰**ï¼š`hp/atk/def/range/atk_interval`
- **èŒä¸šç±»å‹ä¸èƒ½åŠ›**ï¼š`type`ï¼ˆmelee/rangedï¼‰ã€`healer`ã€`block`ï¼ˆé˜»æŒ¡æ•°ï¼‰ã€`cost`ï¼ˆå‡ºå‡»æ¶ˆè€—ï¼‰
- **è¡¨ç°**ï¼š`sprite_sheet/width/height/offset` + `animation{...}` + `sounds{...}`

ä¾‹å¦‚æˆ˜å£«ï¼ˆèŠ‚é€‰ï¼‰ï¼š

```json
{
  "warrior": {
    "type": "melee",
    "block": 3,
    "cost": 10,
    "animation": { "idle": { "row": 0, "frames": [0,1,2,3,4,5,6,7] } }
  }
}
```

å…ˆè®°ä½ä¸€ä¸ªå†™æ•°æ®é©±åŠ¨æ—¶å¾ˆæœ‰ç”¨çš„åŸåˆ™ï¼š

> JSON è´Ÿè´£â€œå¯é…ç½®çš„å‚æ•°â€ï¼Œç»„ä»¶/ç³»ç»Ÿè´Ÿè´£â€œå¯è¿è¡Œçš„è¡Œä¸ºâ€ã€‚

æˆ‘ä»¬åœ¨è¿™ä¸€èŠ‚åªæŠŠ `block/cost/type/healer` è§£æå‡ºæ¥ï¼›åƒ `projectile/skill` è¿™ç±»å­—æ®µå…ˆç•™ç€ï¼Œåç»­æˆ˜æ–—ç³»ç»Ÿå†æ¥å…¥ã€‚

## ğŸ§© 2) æ‰©å±•è“å›¾ï¼šPlayerBlueprint ä¸ PlayerClassBlueprint

ä¸Šä¸€èŠ‚æˆ‘ä»¬ä¸ºæ•Œäººå®šä¹‰äº† `EnemyClassBlueprint`ï¼›è¿™ä¸€èŠ‚è¦åšçš„äº‹æƒ…å¾ˆè‡ªç„¶ï¼šä¸ºç©å®¶ä¹Ÿè¡¥ä¸€å¥—å¯¹åº”ç»“æ„ã€‚

è“å›¾æ–°å¢ç‚¹é›†ä¸­åœ¨ `src/game/data/entity_blueprint.h`ï¼š

```cpp
struct PlayerBlueprint {
    game::defs::PlayerType type_{game::defs::PlayerType::UNKNOWN};
    entt::id_type skill_id_{entt::null};
    bool healer_{false};
    int block_{0};
    int cost_{0};
};

struct PlayerClassBlueprint {
    entt::id_type class_id_{entt::null};
    std::string class_name_;
    StatsBlueprint stats_{};
    PlayerBlueprint player_{};
    SoundBlueprint sounds_{};
    SpriteBlueprint sprite_{};
    DisplayInfoBlueprint display_info_{};
    std::unordered_map<entt::id_type, AnimationBlueprint> animations_;
};
```

è¿™é‡Œçš„æ‹†åˆ†æ–¹å¼ä¸ä¸Šä¸€èŠ‚ä¿æŒä¸€è‡´ï¼š**æ¯å—æ•°æ®éƒ½æœ‰è‡ªå·±çš„å­è“å›¾**ï¼Œæœ€åç”± `PlayerClassBlueprint` ç»„åˆèµ·æ¥ï¼Œäº¤ç»™å·¥å‚åˆ›å»ºå®ä½“ã€‚

ä¸ºäº†è®© `PlayerBlueprint` èƒ½è¡¨è¾¾èŒä¸šç±»å‹ï¼Œæœ¬èŠ‚æ–°å¢äº† `src/game/defs/constants.h`ï¼š

- `BLOCK_RADIUS`ï¼šé˜»æŒ¡åˆ¤å®šåŠå¾„
- `PlayerType`ï¼š`MELEE/RANGED/MIXED/UNKNOWN`

## ğŸ“š 3) BlueprintManagerï¼šåŠ è½½ç©å®¶èŒä¸šè“å›¾

`BlueprintManager` æ–°å¢äº†ç©å®¶è“å›¾å®¹å™¨ä¸åŠ è½½/è·å–æ¥å£ï¼š

- `loadPlayerClassBlueprints("assets/data/player_data.json")`
- `getPlayerClassBlueprint(class_id)`

è§£ææµç¨‹å‡ ä¹æ˜¯â€œç…§æŠ„æ•Œäººè“å›¾â€çš„æ¨¡æ¿ï¼šéå† JSON é¡¶å±‚ï¼Œå“ˆå¸Œå‡º `class_id`ï¼Œå†é€å—è§£æå­è“å›¾ï¼Œæœ€å `emplace` è¿› mapã€‚

å”¯ä¸€éœ€è¦å•ç‹¬è¯´æ˜çš„æ˜¯ `parsePlayer()`ï¼šå®ƒæŠŠ JSON çš„â€œå­—ç¬¦ä¸²ç±»å‹â€ç¿»è¯‘æˆå†…éƒ¨æšä¸¾ + å“ˆå¸Œ idï¼š

```cpp
auto type_str = json["type"].get<std::string>();
auto type = type_str == "melee" ? game::defs::PlayerType::MELEE :
    type_str == "ranged" ? game::defs::PlayerType::RANGED :
    type_str == "mixed" ? game::defs::PlayerType::MIXED :
    game::defs::PlayerType::UNKNOWN;

entt::id_type skill_id = entt::null;
if (json.contains("skill")) {
    skill_id = entt::hashed_string(json["skill"].get<std::string>().c_str());
}
```

åé¢æˆ‘ä»¬ä¼šçœ‹åˆ°ï¼šå·¥å‚ç”¨ `PlayerType` æ¥å†³å®šâ€œè¦ä¸è¦åŠ é˜»æŒ¡è€…ç»„ä»¶â€ï¼Œå¹¶ç”¨ `skill_id` ä¸ºæœªæ¥æŠ€èƒ½ç³»ç»Ÿé¢„ç•™æ¥å£ã€‚

## ğŸ­ 4) EntityFactoryï¼šåˆ›å»ºç©å®¶å®ä½“ï¼ˆå¹¶æŠŠâ€œé˜»æŒ¡èƒ½åŠ›â€å˜æˆç»„ä»¶ï¼‰

### 4.1 createPlayerUnitï¼šç©å®¶å®ä½“çš„è£…é…æµç¨‹

`EntityFactory` æ–°å¢ `createPlayerUnit()`ï¼Œç»“æ„ä¸ `createEnemyUnit()` åŸºæœ¬ä¸€è‡´ï¼šæŒ‰è“å›¾åˆ†æ­¥è£…é…ç»„ä»¶ã€‚

å…³é”®æ˜¯æ–°å¢ `addPlayerComponent()`ï¼š

```cpp
addStatsComponent(entity, blueprint.stats_, level, rarity);
addPlayerComponent(entity, blueprint.player_, rarity);
```

å®ƒæŠŠâ€œèŒä¸šèƒ½åŠ›â€å˜æˆ ECS ä¸–ç•Œé‡Œçš„æ•°æ®ç»„ä»¶/æ ‡ç­¾ã€‚

### 4.2 addPlayerComponentï¼šèŠ±è´¹ + èŒä¸šæ ‡ç­¾ + é˜»æŒ¡è€…ç»„ä»¶

ç©å®¶èŒä¸šä¸ä»…éœ€è¦ä¸€ä¸ªâ€œæ ‡è¯†æˆ‘æ˜¯ç©å®¶â€çš„ç»„ä»¶ï¼Œæœ¬èŠ‚è¿˜é¡ºæ‰‹æŠŠèŒä¸šæ ‡ç­¾å’Œé˜»æŒ¡ä¿¡æ¯ä¹Ÿè¡¥é½ï¼š

- `PlayerComponent{ cost_ }`ï¼šç”¨äºåç»­ cost ç³»ç»Ÿï¼ˆç›®å‰ä»…ä½œä¸ºæ•°æ®ä¿å­˜ï¼‰
- `MeleeUnitTag / RangedUnitTag / HealerTag`ï¼šç”¨äºç³»ç»Ÿç­›é€‰
- `BlockerComponent{ max_count_, current_count_ }`ï¼šåªæœ‰è¿‘æˆ˜å•ä½éœ€è¦é˜»æŒ¡èƒ½åŠ›

å¯¹åº”å®ç°ï¼ˆèŠ‚é€‰ï¼‰ï¼š

```cpp
registry_.emplace<game::component::PlayerComponent>(entity, cost);

if (player.type_ == game::defs::PlayerType::MELEE) {
    registry_.emplace<game::defs::MeleeUnitTag>(entity);
    registry_.emplace<game::component::BlockerComponent>(entity, player.block_);
} else if (player.type_ == game::defs::PlayerType::RANGED) {
    registry_.emplace<game::defs::RangedUnitTag>(entity);
    if (player.healer_) {
        registry_.emplace<game::defs::HealerTag>(entity);
    }
}
```

> è¿™é‡Œçš„ `BlockerComponent` åªå­˜â€œå®¹é‡ä¸å½“å‰è®¡æ•°â€ï¼Œå¹¶ä¸å­˜â€œæ•Œäººåˆ—è¡¨â€ã€‚ä¸‹ä¸€èŠ‚çš„â€œç›®æ ‡é”å®š/æ”»å‡»â€ä¼šå¼•å…¥ç›®æ ‡ç»„ä»¶ä¸æˆ˜æ–—äº¤äº’ï¼Œå†é€æ­¥è¡¥é½å®Œæ•´é€»è¾‘ã€‚

## ğŸ›‘ 5) é˜»æŒ¡ç³»ç»Ÿï¼šBlocker / BlockedBy / BlockSystem

### 5.1 ä¸¤ä¸ªæ–°ç»„ä»¶ï¼šè°èƒ½æŒ¡ã€è°è¢«æŒ¡

æœ¬èŠ‚æ–°å¢ä¸¤ä¸ªç»„ä»¶ï¼ˆéƒ½éå¸¸è½»é‡ï¼‰ï¼š

- `BlockerComponent`ï¼ˆé˜»æŒ¡è€…ï¼‰ï¼š`max_count_ / current_count_`
- `BlockedByComponent`ï¼ˆè¢«é˜»æŒ¡è€…ï¼‰ï¼šä¿å­˜â€œæˆ‘è¢«å“ªä¸ªå®ä½“æŒ¡ä½äº†â€

è¿™ç±»ç»„ä»¶çš„è®¾è®¡ä¼˜ç‚¹æ˜¯ï¼š**ç³»ç»Ÿå¯ä»¥ç”¨ view + exclude å¿«é€Ÿç­›é€‰å¯¹è±¡**ï¼Œè€Œä¸æ˜¯åœ¨ç³»ç»Ÿå†…éƒ¨ç»´æŠ¤é¢å¤–å®¹å™¨ã€‚

### 5.2 BlockSystemï¼šåˆ¤å®šä¸çŠ¶æ€ç»´æŠ¤

`BlockSystem::update()` åˆ†æˆä¸¤æ®µï¼š

1) **æ¸…ç†æ— æ•ˆé˜»æŒ¡å…³ç³»**ï¼šå¦‚æœæ•Œäººèº«ä¸Šçš„ `BlockedByComponent.entity_` å·²ç»æ— æ•ˆï¼ˆä¾‹å¦‚é˜»æŒ¡è€…è¢«é”€æ¯ï¼‰ï¼Œå°±ç§»é™¤ `BlockedByComponent`ï¼Œå¹¶è§¦å‘â€œç»§ç»­èµ°è·¯â€çš„åŠ¨ç”»äº‹ä»¶ï¼š

```cpp
if (!registry.valid(blocked_by_component.entity_)) {
    registry.remove<game::component::BlockedByComponent>(blocked_by_entity);
    dispatcher.enqueue(engine::utils::PlayAnimationEvent{blocked_by_entity, "walk"_hs, true});
}
```

2) **å»ºç«‹æ–°çš„é˜»æŒ¡å…³ç³»**ï¼šéå†â€œè¿˜æ²¡æœ‰è¢«æŒ¡ä½çš„æ•Œäººâ€ï¼Œä¸æ‰€æœ‰é˜»æŒ¡è€…åšè·ç¦»æ£€æµ‹ã€‚è·ç¦»åˆ¤æ–­ç”¨ `distanceSquared`ï¼ˆé¿å…å¼€æ–¹ï¼‰ï¼ŒåŠå¾„å¸¸é‡æ¥è‡ª `game::defs::BLOCK_RADIUS`ï¼š

```cpp
if (engine::utils::distanceSquared(enemy_pos, blocker_pos) <
    game::defs::BLOCK_RADIUS * game::defs::BLOCK_RADIUS) {
    if (blocker.current_count_ >= blocker.max_count_) continue;
    blocker.current_count_++;
    enemy_velocity.velocity_ = glm::vec2(0.0f, 0.0f);
    registry.emplace<game::component::BlockedByComponent>(enemy_entity, blocker_entity);
    dispatcher.enqueue(engine::utils::PlayAnimationEvent{enemy_entity, "attack"_hs, true});
}
```

æ³¨æ„è¿™é‡Œç”¨äº†ä¸€ä¸ªå¾ˆé‡è¦çš„ç­›é€‰æŠ€å·§ï¼šæ•Œäºº view ç›´æ¥æ’é™¤ `BlockedByComponent`ï¼š

```cpp
registry.view<EnemyComponent, TransformComponent, VelocityComponent>(
    entt::exclude<BlockedByComponent>
);
```

è¿™èƒ½ä¿è¯â€œå·²ç»è¢«é˜»æŒ¡çš„æ•Œäººâ€ä¸ä¼šé‡å¤è§¦å‘é˜»æŒ¡é€»è¾‘ï¼Œä¹Ÿèƒ½è®©ä»£ç æ›´æ¸…æ™°ã€‚

### 5.3 FollowPathSystemï¼šè¢«é˜»æŒ¡å°±ä¸èµ°è·¯å¾„

ä¸ºäº†è®©â€œé˜»æŒ¡ = åœæ­¢ç§»åŠ¨â€ï¼Œæœ¬èŠ‚åœ¨ `FollowPathSystem` é‡ŒåŒæ ·ç”¨ `exclude` æ’é™¤è¢«é˜»æŒ¡æ•Œäººï¼š

```cpp
auto view = registry.view<VelocityComponent, TransformComponent, EnemyComponent>(
    entt::exclude<BlockedByComponent>
);
```

è¿™æ ·ä¸€æ¥ï¼š**åªè¦æ•Œäººèº«ä¸ŠæŒ‚äº† `BlockedByComponent`ï¼Œå®ƒå°±ä¸ä¼šå†æ›´æ–°è·¯å¾„é€Ÿåº¦**ï¼Œè‡ªç„¶å°±åœåœ¨åŸåœ°ã€‚

## ğŸ¬ 6) ç”¨äº‹ä»¶åˆ‡æ¢åŠ¨ç”»ï¼šPlayAnimationEvent + AnimationSystem

é˜»æŒ¡ç³»ç»Ÿåœ¨åˆ¤å®šæ—¶ï¼Œä¼šæƒ³è®©æ•Œäººâ€œèµ°è·¯ â†” æ”»å‡»â€åˆ‡æ¢åŠ¨ç”»ã€‚å¦‚æœç›´æ¥åœ¨ `BlockSystem` é‡Œå»æ”¹ `AnimationComponent`ï¼Œç³»ç»Ÿé—´è€¦åˆä¼šå˜é‡ã€‚

æœ¬èŠ‚çš„åšæ³•æ˜¯ï¼šæ–°å¢ä¸€ä¸ªå¼•æ“çº§äº‹ä»¶ `PlayAnimationEvent`ï¼ˆåœ¨ `src/engine/utils/events.h`ï¼‰ï¼Œç”± `AnimationSystem` ç›‘å¬å¹¶å¤„ç†ï¼š

- `AnimationSystem` æ„é€ æ—¶è¿æ¥ `dispatcher.sink<PlayAnimationEvent>()`
- æ”¶åˆ°äº‹ä»¶å `try_get<AnimationComponent>`ï¼Œå­˜åœ¨åˆ™ä¿®æ”¹å½“å‰åŠ¨ç”»ã€é‡ç½®å¸§ä¸æ—¶é—´ï¼Œå¹¶è®¾ç½® loop

è¿™å¥—æœºåˆ¶çš„ä»·å€¼åœ¨äºï¼š**åŠ¨ç”»åˆ‡æ¢ä¸å†ä¾èµ–â€œè°èƒ½æ‹¿åˆ°ç»„ä»¶æŒ‡é’ˆâ€**ï¼Œè€Œæ˜¯é€šè¿‡ç»Ÿä¸€äº‹ä»¶æ€»çº¿å¹¿æ’­ï¼Œç³»ç»Ÿä¹‹é—´çš„è¾¹ç•Œæ›´æ¸…æ™°ã€‚

## ğŸ–±ï¸ 7) è¾“å…¥ç³»ç»Ÿå‡çº§ï¼šåŠ¨ä½œåä»å­—ç¬¦ä¸²æ”¹ä¸ºå“ˆå¸Œ id

ä¸ºäº†è®©è¾“å…¥ç³»ç»Ÿä¸å…¨é¡¹ç›®çš„ `_hs` ä¹ æƒ¯ç»Ÿä¸€ï¼Œæœ¬èŠ‚æŠŠ `InputManager` çš„åŠ¨ä½œåç§°ä» `std::string` æ”¹æˆ `entt::id_type`ï¼š

- `onAction("mouse_left"_hs)` ç»‘å®šå›è°ƒ
- `isActionPressed("mouse_left"_hs)` æŸ¥è¯¢çŠ¶æ€

UI çŠ¶æ€æœºé‡ŒåŸæ¥å†™æ­»çš„ `"MouseLeftClick"` ä¹Ÿé¡ºæ‰‹æ”¹æˆäº† `"mouse_left"_hs`ã€‚

ä»ç»“æœçœ‹ï¼Œå®ƒå¸¦æ¥ä¸¤ä¸ªå¥½å¤„ï¼š

1) **æ›´å¿«**ï¼šå“ˆå¸Œ id æ›´é€‚åˆåš `unordered_map` çš„ keyï¼ˆå°‘å­—ç¬¦ä¸²åˆ†é…/æ¯”è¾ƒï¼‰ã€‚
2) **æ›´ä¸€è‡´**ï¼šäº‹ä»¶ã€åŠ¨ç”»ã€è“å›¾ key éƒ½åœ¨ç”¨å“ˆå¸Œå­—ç¬¦ä¸²ï¼Œè¾“å…¥ä¹Ÿç»Ÿä¸€åå†™èµ·æ¥æ›´é¡ºæ‰‹ã€‚

## ğŸ§ª 8) åœ¨ GameScene ä¸­åšæœ€å°éªŒè¯ï¼šç‚¹å‡»åˆ›å»ºç©å®¶ã€è§‚å¯Ÿé˜»æŒ¡

æœ¬èŠ‚ä¸ºäº†å¿«é€ŸéªŒè¯â€œç©å®¶ + é˜»æŒ¡â€é—­ç¯ï¼Œåœ¨ `GameScene` é‡ŒåŠ äº†å‡ æ¡ä¸´æ—¶æµ‹è¯•é€»è¾‘ï¼š

- é¼ æ ‡å³é”®ï¼šåœ¨é¼ æ ‡ä½ç½®åˆ›å»º `warrior`ï¼ˆè¿‘æˆ˜ï¼‰
- é¼ æ ‡å·¦é”®ï¼šåœ¨é¼ æ ‡ä½ç½®åˆ›å»º `archer`ï¼ˆè¿œç¨‹ï¼‰
- `pause`ï¼šæ¸…ç©ºæ‰€æœ‰ç©å®¶å®ä½“ï¼ˆæ–¹ä¾¿åå¤æµ‹è¯•ï¼‰

å¹¶æŠŠç³»ç»Ÿæ›´æ–°é¡ºåºè°ƒæ•´ä¸ºï¼š

1) `FollowPathSystem` æ›´æ–°æ•Œäººå¯»è·¯é€Ÿåº¦  
2) `BlockSystem` åˆ¤å®šé˜»æŒ¡ï¼ˆå¯èƒ½è®©æ•Œäººåœä¸‹ï¼‰  
3) `MovementSystem` æ ¹æ®é€Ÿåº¦æ›´æ–°ä½ç½®  
4) `AnimationSystem` åˆ·æ–°åŠ¨ç”»å¸§  

è¿™ä¸ªé¡ºåºçš„å…³é”®ç‚¹æ˜¯ï¼š**é˜»æŒ¡è¦å‘ç”Ÿåœ¨ç§»åŠ¨ä¹‹å‰**ï¼Œå¦åˆ™æ•Œäººæœ¬å¸§ä¼šå…ˆç§»åŠ¨ä¸€æ®µè·ç¦»å†è¢«åœä¸‹ï¼Œè¡¨ç°ä¼šâ€œæ»‘ä¸€ä¸‹â€ã€‚

## âœ… æœ¬èŠ‚å°ç»“

- ç©å®¶å•ä½ä¹Ÿçº³å…¥â€œè“å›¾ + å·¥å‚â€ä½“ç³»ï¼šæ–°å¢ `player_data.json`ã€`PlayerClassBlueprint`ã€`createPlayerUnit()`
- å¼•å…¥æœ€å°é˜»æŒ¡é—­ç¯ï¼š`BlockerComponent / BlockedByComponent / BlockSystem`ï¼Œå¹¶ç”¨ `exclude` è®©è¢«é˜»æŒ¡æ•Œäººåœæ­¢å¯»è·¯
- åŠ¨ç”»åˆ‡æ¢å¼€å§‹äº‹ä»¶åŒ–ï¼šæ–°å¢ `PlayAnimationEvent`ï¼Œç”± `AnimationSystem` ç»Ÿä¸€å¤„ç†
- è¾“å…¥ç³»ç»Ÿå‡çº§ä¸ºå“ˆå¸ŒåŠ¨ä½œåï¼šä¸ `_hs` ä½“ç³»ç»Ÿä¸€ï¼Œä¾¿äºåç»­æ‰©å±•

## â¡ï¸ ä¸‹ä¸€èŠ‚é¢„å‘Š

æœ‰äº†â€œèƒ½æ‹¦ä½æ•Œäººâ€çš„è¿‘æˆ˜å•ä½åï¼Œä¸‹ä¸€èŠ‚æˆ‘ä»¬ä¼šå¼•å…¥**ç›®æ ‡é”å®šä¸æ”»å‡»**ï¼š

- ç©å®¶å•ä½å¦‚ä½•åœ¨æ”»å‡»èŒƒå›´å†…æ‰¾æ•Œäººå¹¶é”å®šç›®æ ‡
- æ•Œäººè¢«é˜»æŒ¡åå¦‚ä½•æŠŠé˜»æŒ¡è€…ä½œä¸ºæ”»å‡»å¯¹è±¡
- æ”»å‡»å†·å´ã€å¾…æœºä¸æ”»å‡»åŠ¨ç”»çš„åˆ‡æ¢æµç¨‹