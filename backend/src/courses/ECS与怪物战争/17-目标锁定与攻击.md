# 17 ç›®æ ‡é”å®šä¸æ”»å‡»

<div class="video-container">
  <div id="bilibili" class="video-content">
    <!-- Bç«™åµŒå…¥ï¼šä½¿ç”¨ https æ˜ç¡®åè®®ï¼ˆé¿å… file:// æˆ– http å¯¼è‡´è¢«æµè§ˆå™¨æ‹¦æˆªï¼‰ -->
    <iframe
      class="video-frame"
      src="https://player.bilibili.com/player.html?bvid=BV1UAyuB7EQe&page=1&autoplay=0&danmaku=0&high_quality=1"
      width="100%"
      height="480"
      scrolling="no"
      frameborder="0"
      allowfullscreen>
    </iframe>
  </div>
</div>

[åœ¨ Bilibili ä¸Šè§‚çœ‹](https://www.bilibili.com/video/BV1UAyuB7EQe)

## ğŸ“– æ¦‚è¿°

ä¸Šä¸€èŠ‚æˆ‘ä»¬å·²ç»è®©ç©å®¶å•ä½èƒ½è¢«åˆ›å»ºã€æ•Œäººèƒ½è¢«é˜»æŒ¡ï¼šè¿‘æˆ˜ç©å®¶æŠŠæ•Œäººæ‹¦ä¸‹æ¥ï¼Œæ•Œäººä¹Ÿä¼šâ€œåœä½ä¸åŠ¨â€ã€‚

ä½†â€œåœä½â€åªæ˜¯å¡”é˜²çš„ç¬¬ä¸€æ­¥ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬è¦è§£å†³çš„æ˜¯æ›´æ ¸å¿ƒçš„æˆ˜æ–—å¾ªç¯ï¼š

1) **ç›®æ ‡é”å®š**ï¼šè§’è‰²å¦‚ä½•åœ¨èŒƒå›´å†…æ‰¾åˆ°å¯æ”»å‡»ç›®æ ‡ï¼Ÿç›®æ ‡å¤±æ•ˆ/ç¦»å¼€èŒƒå›´åæ€ä¹ˆåŠï¼Ÿ  
2) **æ”»å‡»å¯åŠ¨**ï¼šå†·å´ç»“æŸåå¦‚ä½•å‘èµ·æ”»å‡»ï¼Ÿè¿‘æˆ˜/è¿œç¨‹/æ²»ç–—æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ  
3) **åŠ¨ç”»ä¸è¡Œä¸ºè§£è€¦**ï¼šæ”»å‡»ä¼šæ’­æ”¾ä¸€æ®µåŠ¨ä½œåŠ¨ç”»ï¼ŒåŠ¨ç”»ç»“æŸåæ‰æ¢å¤åˆ°â€œèµ°è·¯/å¾…æœºâ€ï¼Œè¿™å¥—â€œçŠ¶æ€åˆ‡æ¢â€åº”è¯¥ç”±è°è´Ÿè´£ï¼Ÿ  

![](../æœ¬æœŸå‚è€ƒ/PPTæˆªå›¾/æ€ªç‰©æˆ˜äº‰.068.png)

> PPT ç¬¬ 68 é¡µï¼šç©å®¶ï¼ˆæ”»å‡»/æ²»ç–—ï¼‰å•ä½çš„ç›®æ ‡é”å®šä¸æ”»å‡»æµç¨‹

![](../æœ¬æœŸå‚è€ƒ/PPTæˆªå›¾/æ€ªç‰©æˆ˜äº‰.069.png)

> PPT ç¬¬ 69 é¡µï¼šæ•Œæ–¹ï¼ˆè¿‘æˆ˜/è¿œç¨‹ï¼‰å•ä½çš„ç›®æ ‡é”å®šä¸æ”»å‡»æµç¨‹

æœ¬èŠ‚å¯¹åº”ä»£ç æ ‡ç­¾ï¼š`17-ç›®æ ‡é”å®šä¸æ”»å‡»`ï¼ˆåŸºçº¿ï¼š`16-ç©å®¶å®ä½“ä¸é˜»æ‹¦æ•Œäºº`ï¼‰ã€‚

## ğŸ¯ å­¦ä¹ ç›®æ ‡

- ç”¨ `TargetComponent` è¡¨ç¤ºâ€œé”å®šç›®æ ‡â€ï¼Œå¹¶åœ¨ç›®æ ‡å¤±æ•ˆ/ç¦»å¼€å°„ç¨‹æ—¶æ¸…é™¤
- ç”¨ `AttackReadyTag` + `TimerSystem` è¡¨ç¤ºâ€œæ”»å‡»å†·å´â€ï¼Œè®©â€œèƒ½ä¸èƒ½æ”»å‡»â€æˆä¸ºå¯ç­›é€‰çš„ ECS çŠ¶æ€
- ç”¨ `AttackStarterSystem` ç»Ÿä¸€å¯åŠ¨æ”»å‡»ï¼šä¸åŒé˜µè¥/èŒä¸šè§¦å‘ä¸åŒåŠ¨ç”»ä¸è¡Œä¸ºï¼ˆå¹¶åˆ‡èµ°å†·å´çŠ¶æ€ï¼‰
- ç”¨ `ActionLockTag` è§£å†³â€œæ”»å‡»åŠ¨ç”»æœŸé—´ä¸å…è®¸ç§»åŠ¨â€çš„é—®é¢˜
- ç”¨äº‹ä»¶æŠŠåŠ¨ç”»ç”Ÿå‘½å‘¨æœŸä¸²èµ·æ¥ï¼š`PlayAnimationEvent` å¯åŠ¨åŠ¨ç”»ï¼Œ`AnimationFinishedEvent` é€šçŸ¥ç»“æŸï¼Œ`AnimationStateSystem` è´Ÿè´£å›åˆ° idle/walk
- ç”¨ `OrientationSystem` ä¿è¯é¢æœæ–¹å‘æ­£ç¡®ï¼ˆé¢æœç›®æ ‡ / é¢æœé˜»æŒ¡è€… / é¢æœç§»åŠ¨æ–¹å‘ï¼‰

## ğŸ§© 1) ç›®æ ‡ç»„ä»¶ï¼š`TargetComponent`

ç›®æ ‡é”å®šçš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªæç®€ç»„ä»¶ï¼šåªä¿å­˜ç›®æ ‡å®ä½“å³å¯ï¼ˆECS ä¸–ç•Œé‡Œâ€œå…³ç³»â€ä¹Ÿå¯ä»¥ç”¨ entity å¼•ç”¨è¡¨è¾¾ï¼‰ã€‚

`src/game/component/target_component.h`ï¼š

```cpp
struct TargetComponent {
    entt::entity entity_{entt::null};
};
```

é…å¥—åœ°ï¼Œæˆ‘ä»¬ä¸ºâ€œä¸´æ—¶çŠ¶æ€â€å‡†å¤‡äº†å‡ ä¸ªæ ‡ç­¾ï¼ˆ`src/game/defs/tags.h`ï¼‰ï¼š

- `AttackReadyTag`ï¼šæ”»å‡»å†·å´ç»“æŸï¼Œå¯ä»¥å‘èµ·æ”»å‡»
- `InjuredTag`ï¼šå—ä¼¤ï¼ˆç”¨äºæ²»ç–—å•ä½ç­›é€‰ç›®æ ‡ï¼‰
- `ActionLockTag`ï¼šåŠ¨ä½œé”ï¼ˆç¡¬ç›´ï¼‰ï¼ŒåŠ¨ç”»æ’­å®Œå‰ä¸å…è®¸åšä¸‹ä¸€æ­¥ï¼ˆä¾‹å¦‚ç»§ç»­ç§»åŠ¨ï¼‰

è¿™ä¸€èŠ‚ä½ ä¼šåå¤çœ‹åˆ°ä¸€ä¸ª ECS å†™æ³•çš„å…¸å‹å¥—è·¯ï¼š

> **â€œçŠ¶æ€â€ä¸æ˜¯æšä¸¾ï¼Œè€Œæ˜¯ç»„ä»¶/æ ‡ç­¾**ï¼›ç³»ç»Ÿé€šè¿‡ `view + exclude` ç›´æ¥ç­›é€‰å‡ºâ€œå½“å‰åº”è¯¥å¤„ç†çš„äººâ€ã€‚

## ğŸ¯ 2) SetTargetSystemï¼šç»Ÿä¸€å¤„ç†â€œè®¾ç½®ç›®æ ‡ / æ¸…é™¤ç›®æ ‡â€

`SetTargetSystem` è¢«æ‹†æˆ 4 æ®µé€»è¾‘ï¼ˆå¯¹åº” PPT çš„åˆ†æ”¯ï¼‰ï¼š

- `updateHasTarget()`ï¼šæœ‰ç›®æ ‡ â†’ æ ¡éªŒç›®æ ‡æœ‰æ•ˆæ€§ä¸è·ç¦»
- `updateNoTargetPlayer()`ï¼šç©å®¶æ”»å‡»å‹å•ä½ â†’ æ‰¾æ•Œäºº
- `updateNoTargetEnemy()`ï¼šæ•Œæ–¹è¿œç¨‹å•ä½ â†’ æ‰¾ç©å®¶
- `updateHealer()`ï¼šæ²»ç–—è€… â†’ æ‰¾â€œå—ä¼¤ä¸”è¡€é‡ç™¾åˆ†æ¯”æœ€ä½â€çš„å‹å†›

### 2.1 æœ‰ç›®æ ‡ï¼šç›®æ ‡å¤±æ•ˆ/ç¦»å¼€å°„ç¨‹åˆ™æ¸…é™¤

```cpp
if (!registry.valid(target.entity_)) {
    registry.remove<TargetComponent>(entity);
}

auto range_radius = stats.range_ + game::defs::UNIT_RADIUS;
if (distanceSquared(self_pos, target_pos) > range_radius * range_radius) {
    registry.remove<TargetComponent>(entity);
}
```

è¿™é‡Œæ–°å¢äº†ä¸€ä¸ªå¸¸é‡ï¼š`UNIT_RADIUS`ï¼ˆ`src/game/defs/constants.h`ï¼‰ï¼Œç”¨äºæŠŠâ€œå°„ç¨‹â€ä»ç‚¹åˆ°ç‚¹æ‰©å±•æˆæ›´ç¬¦åˆç›´è§‰çš„â€œåŠå¾„åˆ¤å®šâ€ï¼ˆå°„ç¨‹ + ç›®æ ‡ä½“ç§¯ï¼‰ã€‚

### 2.2 æ— ç›®æ ‡çš„ç©å®¶æ”»å‡»å•ä½ï¼šèŒƒå›´å†…æ‰¾åˆ°ä¸€ä¸ªæ•Œäººå°±é”å®š

ç©å®¶æ”»å‡»å•ä½çš„ç­›é€‰æ¡ä»¶å¾ˆå…³é”®ï¼š**æœ‰ç©å®¶ç»„ä»¶ + æ²¡æœ‰ Target + ä¸æ˜¯æ²»ç–—è€…**ã€‚

```cpp
auto view_player_no_target = registry.view<TransformComponent, StatsComponent, PlayerComponent>(
    entt::exclude<TargetComponent, HealerTag>
);
```

ç„¶åä¸æ•Œäººåšè·ç¦»æ£€æµ‹ï¼Œæ‰¾åˆ°ä¸€ä¸ªå°± `emplace<TargetComponent>`ï¼š

```cpp
if (distanceSquared(player_pos, enemy_pos) <= range_radius * range_radius) {
    registry.emplace<TargetComponent>(player_entity, enemy_entity);
    break;
}
```

### 2.3 æ²»ç–—è€…ï¼šé”å®šâ€œå—ä¼¤ä¸”è¡€é‡ç™¾åˆ†æ¯”æœ€ä½â€çš„å‹å†›

æ²»ç–—å•ä½çš„ç›®æ ‡é€‰æ‹©æ›´åƒçœŸå®æ¸¸æˆï¼šä¸æ²»æ»¡è¡€å•ä½ï¼Œä¼˜å…ˆæ•‘æœ€å±é™©çš„é‚£ä¸ªã€‚

åšæ³•æ˜¯ï¼š

1) ç”¨ `InjuredTag` ç­›é€‰â€œéœ€è¦æ²»ç–—â€çš„å€™é€‰ç›®æ ‡  
2) åœ¨æ²»ç–—å°„ç¨‹å†…éå†å€™é€‰è€…ï¼Œè®¡ç®— `hp/max_hp`ï¼Œå–æœ€å°å€¼  
3) ç”¨ `emplace_or_replace<TargetComponent>` æ›´æ–°æ²»ç–—ç›®æ ‡ï¼ˆæ‰¾ä¸åˆ°åˆ™ç§»é™¤ç›®æ ‡ï¼‰

è¿™å¥—å†™æ³•ä¹Ÿä½“ç°äº†â€œæ ‡ç­¾çš„ä»·å€¼â€ï¼š`InjuredTag` è®©ç³»ç»Ÿä¸ç”¨æ¯”è¾ƒæ•°å€¼å°±èƒ½å¿«é€Ÿç¼©å°æœç´¢èŒƒå›´ã€‚

## â±ï¸ 3) TimerSystemï¼šæŠŠæ”»å‡»å†·å´å˜æˆå¯ç­›é€‰çŠ¶æ€ï¼ˆAttackReadyTagï¼‰

æ”»å‡»å†·å´è®¡æ—¶å™¨æ”¾åœ¨ `StatsComponent.atk_timer_` ä¸­ï¼›`TimerSystem` æ¯å¸§æ¨è¿›è®¡æ—¶å™¨ï¼Œå¹¶åœ¨å†·å´ç»“æŸæ—¶æ‰“ä¸Š `AttackReadyTag`ï¼š

```cpp
stats.atk_timer_ += delta_time;
if (stats.atk_timer_ >= stats.atk_interval_) {
    registry.emplace_or_replace<AttackReadyTag>(entity);
    stats.atk_timer_ = 0.0f;
}
```

è¿™æ ·åç»­ç³»ç»Ÿåªéœ€è¦ç­›é€‰â€œå¸¦ `AttackReadyTag` çš„å®ä½“â€å³å¯ï¼Œä¸å¿…åœ¨æ¯ä¸ªç³»ç»Ÿé‡Œå†™ä¸€éå†·å´åˆ¤æ–­ã€‚

## âš”ï¸ 4) AttackStarterSystemï¼šå‘èµ·æ”»å‡»ï¼ˆå¹¶å¯åŠ¨åŠ¨ç”»ï¼‰

æ”»å‡»å¯åŠ¨ç³»ç»Ÿåšä¸€ä»¶äº‹ï¼š**å½“â€œæœ‰ç›®æ ‡/æˆ–è¢«é˜»æŒ¡ + å†·å´ç»“æŸâ€æ—¶ï¼Œè§¦å‘ä¸€æ¬¡æ”»å‡»åŠ¨ä½œ**ã€‚

å®ƒæ‹†æˆ 3 æ®µå¤„ç†ï¼š

### 4.1 è¢«é˜»æŒ¡çš„æ•Œäººï¼šç›®æ ‡å°±æ˜¯é˜»æŒ¡è€…ï¼ˆä¸éœ€è¦ TargetComponentï¼‰

```cpp
auto view_enemy_blocked = registry.view<EnemyComponent, BlockedByComponent, AttackReadyTag>();
```

è§¦å‘æ”»å‡»æ—¶ï¼š

- åŠ  `ActionLockTag`ï¼ˆç¡®ä¿åŠ¨ç”»æ’­å®Œå‰ä¸ä¼šç»§ç»­ç§»åŠ¨ï¼‰
- ç§»é™¤ `AttackReadyTag`ï¼ˆè®©å†·å´é‡æ–°å¼€å§‹è®¡æ—¶ï¼‰
- å‘é€ `PlayAnimationEvent` æ’­æ”¾ä¸€æ¬¡ `attack`ï¼ˆä¸å¾ªç¯ï¼‰

```cpp
registry.emplace_or_replace<ActionLockTag>(enemy_entity);
registry.remove<AttackReadyTag>(enemy_entity);
dispatcher.enqueue(PlayAnimationEvent{enemy_entity, "attack"_hs, false});
```

### 4.2 è¿œç¨‹æ•Œäººï¼šæœ‰ Target ä¸”å†·å´ç»“æŸï¼Œæ’­ ranged_attack

è¿œç¨‹æ•Œäººéœ€è¦ `TargetComponent`ï¼Œå¹¶ä¸”æœªè¢«é˜»æŒ¡ï¼ˆå¦åˆ™èµ°è¿‘æˆ˜åˆ†æ”¯ï¼‰ï¼š

```cpp
auto view_enemy_ranged = registry.view<EnemyComponent, TargetComponent, AttackReadyTag>(
    entt::exclude<BlockedByComponent>
);
```

è§¦å‘æ”»å‡»æ—¶åŒæ ·ä¼š `ActionLockTag` + æ¸…ç©ºé€Ÿåº¦ + æ’­ `ranged_attack`ï¼š

```cpp
registry.emplace_or_replace<ActionLockTag>(enemy_entity);
registry.emplace_or_replace<VelocityComponent>(enemy_entity, glm::vec2(0.0f, 0.0f));
dispatcher.enqueue(PlayAnimationEvent{enemy_entity, "ranged_attack"_hs, false});
```

### 4.3 ç©å®¶ï¼šæœ‰ Target ä¸”å†·å´ç»“æŸï¼Œæ”»å‡»æˆ–æ²»ç–—

ç©å®¶ä¸ç§»åŠ¨ï¼Œæ‰€ä»¥è¿™é‡Œä¸éœ€è¦ `ActionLockTag`ï¼›åŠ¨ç”»æ ¹æ®æ˜¯å¦æœ‰ `HealerTag` åˆ†æµï¼š

```cpp
if (registry.all_of<HealerTag>(player_entity)) {
    dispatcher.enqueue(PlayAnimationEvent{player_entity, "heal"_hs, false});
} else {
    dispatcher.enqueue(PlayAnimationEvent{player_entity, "attack"_hs, false});
}
registry.remove<AttackReadyTag>(player_entity);
```

> è¿™ä¸€èŠ‚åªåšåˆ°â€œå‘èµ·æ”»å‡»å¹¶æ’­æ”¾åŠ¨ç”»â€ï¼Œè¿˜æ²¡æœ‰çœŸæ­£æ‰£è¡€/æ²»ç–—ã€‚ä¸‹ä¸€èŠ‚ä¼šæŠŠâ€œåŠ¨ç”»å¸§äº‹ä»¶ â†’ ä¼¤å®³ç»“ç®—â€ä¸²èµ·æ¥ã€‚

## ğŸ¬ 5) åŠ¨ç”»ç”Ÿå‘½å‘¨æœŸï¼šAnimationFinishedEvent + AnimationStateSystem

### 5.1 AnimationSystemï¼šéå¾ªç¯åŠ¨ç”»ç»“æŸæ—¶å‘äº‹ä»¶

å½“åŠ¨ç”»ä¸å¾ªç¯ä¸”æ’­æ”¾åˆ°æœ€åä¸€å¸§ï¼Œ`AnimationSystem` ä¼šå‘é€ `AnimationFinishedEvent`ï¼š

```cpp
dispatcher_.enqueue(AnimationFinishedEvent{entity, anim_component.current_animation_id_});
```

### 5.2 AnimationStateSystemï¼šæ”¶åˆ°â€œåŠ¨ç”»ç»“æŸâ€åå›åˆ° walk/idleï¼Œå¹¶è§£é™¤ ActionLock

`AnimationStateSystem` ä¸“é—¨ç›‘å¬ `AnimationFinishedEvent`ï¼Œæ²¡æœ‰ update å‡½æ•°ï¼ŒåªåšçŠ¶æ€æ”¶å°¾ï¼š

- æ•Œäººï¼šå¦‚æœè¢«é˜»æŒ¡ â†’ å› `idle`ï¼›å¦åˆ™ â†’ å› `walk`ï¼›å¹¶ç§»é™¤ `ActionLockTag`
- ç©å®¶ï¼šç›´æ¥å› `idle`

è¿™ä¸€æ­¥éå¸¸å…³é”®ï¼šå®ƒæŠŠâ€œåŠ¨ç”»ç»“æŸåçš„åˆ‡æ¢é€»è¾‘â€ä»å„ä¸ªç³»ç»Ÿé‡ŒæŠ½å‡ºæ¥ï¼Œé¿å…â€œè°è§¦å‘åŠ¨ç”»ï¼Œè°è´Ÿè´£å–„åâ€çš„è€¦åˆã€‚

## ğŸ§­ 6) æœå‘ç³»ç»Ÿï¼šOrientationSystem

è§’è‰²å¼€å§‹æ”»å‡»åï¼Œå¦‚æœæœå‘ä¸æ­£ç¡®ï¼Œè§‚æ„Ÿä¼šå¾ˆæ€ªã€‚

æœ¬èŠ‚æ–°å¢ `OrientationSystem`ï¼Œå¹¶æŒ‰ä¼˜å…ˆçº§ä¾æ¬¡å¤„ç†ï¼š

1) **æœ‰ç›®æ ‡**ï¼šé¢æœç›®æ ‡  
2) **è¢«é˜»æŒ¡**ï¼šé¢æœé˜»æŒ¡è€…  
3) **ç§»åŠ¨ä¸­æ•Œäºº**ï¼šé¢æœç§»åŠ¨æ–¹å‘ï¼ˆæœ€åå¤„ç†ï¼Œç¡®ä¿ç§»åŠ¨æ–¹å‘ä¼˜å…ˆçº§æœ€é«˜ï¼‰  

æœ€ç»ˆæ•ˆæœæ˜¯ï¼š

- ç©å®¶/è¿œç¨‹æ•Œäººæ”»å‡»æ—¶ä¼šé¢å‘ç›®æ ‡
- è¢«é˜»æŒ¡æ•Œäººä¼šé¢å‘é˜»æŒ¡è€…
- ç§»åŠ¨ä¸­çš„æ•Œäººä¼šé¢å‘é€Ÿåº¦æ–¹å‘

åŒæ—¶è€ƒè™‘äº† `FaceLeftTag`ï¼šæœ‰äº›ç´ æé»˜è®¤æœå‘ä¸åŒï¼Œéœ€è¦æŠŠç¿»è½¬è§„åˆ™åè¿‡æ¥ã€‚

## ğŸ§© 7) ä¸æ—§ç³»ç»Ÿçš„è¡”æ¥ï¼šBlock / FollowPath çš„å°æ”¹åŠ¨

ä¸ºäº†è®©â€œåŠ¨ä½œé”â€çœŸæ­£ç”Ÿæ•ˆï¼Œæœ¬èŠ‚å¯¹æ—§ç³»ç»Ÿåšäº†ä¸¤å¤„å…³é”®è°ƒæ•´ï¼š

- `FollowPathSystem`ï¼šæ’é™¤ `ActionLockTag`ï¼Œé¿å…æ•Œäººæ”»å‡»åŠ¨ç”»æœŸé—´ç»§ç»­æŒ‰è·¯å¾„ç§»åŠ¨
- `BlockSystem`ï¼šé˜»æŒ¡å…³ç³»å¤±æ•ˆæ—¶é¡ºå¸¦ç§»é™¤ `ActionLockTag`ï¼Œå¹¶æ¢å¤ `walk` åŠ¨ç”»

## ğŸ§ª 8) GameScene æœ€å°éªŒè¯ï¼šè®©æ²»ç–—è€…æœ‰ç›®æ ‡å¯é€‰

æœ¬èŠ‚ä¸ºäº†éªŒè¯â€œæ²»ç–—è€…æ‰¾å‹å†›â€çš„é€»è¾‘ï¼Œåœ¨æµ‹è¯•è¾“å…¥é‡ŒåŠ äº†ä¸€ç‚¹å°æŠ€å·§ï¼š

- åˆ›å»ºæˆ˜å£«/å¼“ç®­æ‰‹æ—¶ï¼Œæ‰‹åŠ¨ç»™å®ƒä»¬åŠ  `InjuredTag`ï¼Œå¹¶æŠŠ `hp_` è®¾æˆ `max_hp_/2`
- ç»‘å®š `move_left` åŠ¨ä½œï¼ˆé”®ä½è§é…ç½®ï¼‰ç”¨æ¥åˆ›å»º `witch`ï¼ˆæ²»ç–—è€…ï¼‰

è¿™æ ·ä½ å°±èƒ½è§‚å¯Ÿåˆ°ï¼š

- æ²»ç–—è€…åœ¨å°„ç¨‹å†…ä¼šé”å®šå—ä¼¤å‹å†›ï¼Œå¹¶å‘¨æœŸæ€§æ’­æ”¾ `heal` åŠ¨ç”»
- æ”»å‡»å•ä½åœ¨å°„ç¨‹å†…ä¼šé”å®šæ•Œäººï¼Œå¹¶å‘¨æœŸæ€§æ’­æ”¾ `attack` åŠ¨ç”»
- è¢«é˜»æŒ¡çš„æ•Œäººä¼šå‘¨æœŸæ€§æ’­æ”¾ `attack`ï¼ŒåŠ¨ç”»ç»“æŸåå›åˆ° `idle`

## âœ… æœ¬èŠ‚å°ç»“

- ç”¨ `TargetComponent` + `SetTargetSystem` å»ºç«‹äº†â€œé”å®š/æ¸…é™¤ç›®æ ‡â€çš„é€šç”¨æœºåˆ¶ï¼ˆæ”»å‡»/æ²»ç–—é€šåƒï¼‰
- ç”¨ `TimerSystem` å°†å†·å´é€»è¾‘é›†ä¸­å¤„ç†ï¼Œå¹¶é€šè¿‡ `AttackReadyTag` æŠŠâ€œå¯æ”»å‡»â€å˜æˆ ECS çŠ¶æ€
- ç”¨ `AttackStarterSystem` å‘èµ·æ”»å‡»ï¼šç»Ÿä¸€è§¦å‘åŠ¨ç”»ï¼Œå¹¶ç”¨ `ActionLockTag` ç®¡æ§æ•Œäººçš„â€œç¡¬ç›´æœŸâ€
- ç”¨ `AnimationFinishedEvent` æŠŠåŠ¨ç”»ç»“æŸä¿¡å·äº‹ä»¶åŒ–ï¼Œå†ç”± `AnimationStateSystem` ç»Ÿä¸€åšâ€œå›åˆ° idle/walk + è§£é”â€
- æ–°å¢ `OrientationSystem` ä¿®æ­£æœå‘ï¼Œè®©â€œèµ°è·¯/æ”»å‡»/è¢«é˜»æŒ¡â€æ—¶è§†è§‰ä¸€è‡´

## â¡ï¸ ä¸‹ä¸€èŠ‚é¢„å‘Š

è¿™ä¸€èŠ‚æˆ‘ä»¬å®Œæˆäº†â€œç›®æ ‡é”å®š + æ”»å‡»å¯åŠ¨ + åŠ¨ç”»çŠ¶æ€æ”¶å°¾â€ï¼Œä½†è¿˜ç¼ºäº†æœ€é‡è¦çš„ä¸€ç¯ï¼š**çœŸæ­£çš„ä¼¤å®³ä¸æ²»ç–—ç»“ç®—**ã€‚

ä¸‹ä¸€èŠ‚æˆ‘ä»¬ä¼šå¼•å…¥â€œåŠ¨ç”»é©±åŠ¨çš„æˆ˜æ–—äº¤äº’â€ï¼šåœ¨æ”»å‡»åŠ¨ç”»çš„å…³é”®å¸§è§¦å‘äº‹ä»¶ï¼Œæ‰§è¡Œä¼¤å®³/æ²»ç–—ï¼Œå¹¶è®©æˆ˜æ–—é€»è¾‘ä¸åŠ¨ç”»èŠ‚å¥å¯¹é½ã€‚