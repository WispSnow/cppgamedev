# å…³å¡åˆ‡æ¢ - å…±äº«æ¸¸æˆæ•°æ®

<div class="video-container">
  <div id="bilibili" class="video-content">
    <!-- Bç«™åµŒå…¥ï¼šä½¿ç”¨ https æ˜ç¡®åè®®ï¼ˆé¿å… file:// æˆ– http å¯¼è‡´è¢«æµè§ˆå™¨æ‹¦æˆªï¼‰ -->
    <iframe
      class="video-frame"
      src="https://player.bilibili.com/player.html?bvid=BV1sbbrz1ExE&page=1&autoplay=0&danmaku=0&high_quality=1"
      width="100%"
      height="480"
      scrolling="no"
      frameborder="0"
      allowfullscreen>
    </iframe>
  </div>
</div>

[åœ¨ Bilibili ä¸Šè§‚çœ‹](https://www.bilibili.com/video/BV1sbbrz1ExE)

## ğŸ“Œ é—®é¢˜èƒŒæ™¯

æ¬¢è¿æ¥åˆ°ã€ŠC++æ¸¸æˆå¼€å‘ä¹‹æ—…ã€‹çš„ç¬¬29è¯¾ï¼åœ¨ä¸Šä¸€èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬æˆåŠŸå®ç°äº†ä»ä¸€ä¸ªå…³å¡è·³è½¬åˆ°å¦ä¸€ä¸ªå…³å¡çš„åŠŸèƒ½ï¼Œè®©æˆ‘ä»¬çš„æ¸¸æˆä¸–ç•Œå¾—ä»¥å»¶å±•ã€‚ç„¶è€Œï¼Œä¸€ä¸ªå…³é”®é—®é¢˜éšä¹‹è€Œæ¥ï¼š**å½“ç©å®¶è¿›å…¥æ–°å…³å¡æ—¶ï¼Œä»–çš„ç”Ÿå‘½å€¼ä¼šå›æ»¡ï¼Œä¹‹å‰è¾›è‹¦æ”¶é›†çš„å®çŸ³å¾—åˆ†ä¹Ÿæ¸…é›¶äº†**ã€‚è¿™å°±åƒç”µå½±æ¢å¹•ï¼Œä¸»è§’å´å¤±å¿†äº†ã€‚

### âš ï¸ å½“å‰çš„é—®é¢˜

```
æ•°æ®ä¸¢å¤±çš„é—®é¢˜ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Level 1ï¼š               â”‚
â”‚ ğŸ‘¤ ç”Ÿå‘½: 1/3            â”‚
â”‚ ğŸ’ å¾—åˆ†: 150            â”‚
â”‚ â†’ è¿›å…¥ Level 2 ğŸšª       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åœºæ™¯åˆ‡æ¢ä¸­...           â”‚
â”‚ GameScene è¢«é”€æ¯        â”‚
â”‚ æ•°æ®éšä¹‹æ¶ˆå¤± ğŸ’¥         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Level 2ï¼š               â”‚
â”‚ ğŸ‘¤ ç”Ÿå‘½: 3/3 âŒ         â”‚
â”‚ ğŸ’ å¾—åˆ†: 0 âŒ           â”‚
â”‚ æ•°æ®è¢«é‡ç½®ï¼            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| é—®é¢˜ | è¯´æ˜ | å½±å“ |
|------|------|------|
| **æ•°æ®é‡ç½®** | åˆ‡æ¢å…³å¡åçŠ¶æ€æ¸…é›¶ | æ¸¸æˆä½“éªŒä¸­æ–­ |
| **ç”Ÿå‘½å€¼å›æ»¡** | å¤±å»éš¾åº¦å¹³è¡¡ | æ¸¸æˆå¤ªå®¹æ˜“ |
| **å¾—åˆ†æ¸…é›¶** | å¤±å»è¿›åº¦æ„Ÿ | ç¼ºå°‘æˆå°±æ„Ÿ |
| **çŠ¶æ€ä¸¢å¤±** | æ•°æ®ä¸åœºæ™¯è€¦åˆ | æ¶æ„è®¾è®¡ç¼ºé™· |

### ğŸ’¡ è§£å†³æ–¹æ¡ˆï¼šSessionData å…±äº«æ•°æ®

<img src="https://theorhythm.top/gamedev/SL/SL.085.webp" alt="å…±äº«æ¸¸æˆæ•°æ®" style="display: block; margin: auto; width: 700px;" />

**æ ¸å¿ƒæ€æƒ³**ï¼š
1. åˆ›å»ºç‹¬ç«‹çš„ SessionData ç±»å­˜å‚¨æ¸¸æˆçŠ¶æ€
2. ä½¿ç”¨ `shared_ptr` åœ¨åœºæ™¯é—´å…±äº«æ•°æ®
3. æ•°æ®ç”Ÿå‘½å‘¨æœŸç‹¬ç«‹äºåœºæ™¯
4. å®ç°å­˜æ¡£/è¯»æ¡£åŠŸèƒ½

```
æ•°æ®å…±äº«æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SessionData     â”‚ â† ç‹¬ç«‹çš„æ•°æ®å¯¹è±¡
â”‚ â€¢ current_health â”‚   ç”Ÿå‘½å‘¨æœŸé•¿äºåœºæ™¯
â”‚ â€¢ current_score  â”‚
â”‚ â€¢ map_path       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ shared_ptr
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚         â”‚
    â†“         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Level 1 â”‚â”‚Level 2 â”‚ â† GameScene å®ä¾‹
â”‚Scene   â”‚â”‚Scene   â”‚   å…±äº«åŒä¸€æ•°æ®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ¯ æœ¬è¯¾ç›®æ ‡

| ç›®æ ‡ | è¯´æ˜ |
|------|------|
| **åˆ›å»º SessionData ç±»** | å­˜å‚¨è·¨åœºæ™¯çš„æ¸¸æˆçŠ¶æ€ |
| **æ¶æ„é‡æ„** | GameScene ä¾èµ–å¤–éƒ¨æ•°æ® |
| **ä½¿ç”¨ shared_ptr** | å®‰å…¨åœ°å…±äº«æ•°æ®å¯¹è±¡ |
| **å®ç°å­˜æ¡£/è¯»æ¡£** | JSON åºåˆ—åŒ–åŠŸèƒ½ |

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šé—®é¢˜åˆ†æä¸æ¶æ„è®¾è®¡

### ğŸ’¡ é—®é¢˜çš„æ ¸å¿ƒï¼šæ•°æ®ä¸åœºæ™¯çš„è€¦åˆ

**å½“å‰çš„é—®é¢˜æ ¹æº**åœ¨äºï¼Œç©å®¶çš„ç”Ÿå‘½å€¼ã€å¾—åˆ†ç­‰çŠ¶æ€ä¿¡æ¯ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸä¸ `GameScene` å¯¹è±¡æ˜¯ç»‘å®šçš„ã€‚

```
æ•°æ®è€¦åˆçš„é—®é¢˜ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GameScene 1        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ health_ = 1      â”‚ â”‚
â”‚ â”‚ score_ = 150     â”‚ â”‚ â† æ•°æ®åœ¨åœºæ™¯å†…
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Replace
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GameScene 2        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ health_ = 3      â”‚ â”‚ â† æ–°å¯¹è±¡ï¼Œæ–°æ•°æ®
â”‚ â”‚ score_ = 0       â”‚ â”‚ â† é‡ç½®ï¼
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åœºæ™¯ç”Ÿå‘½å‘¨æœŸ**ï¼š

```
åœºæ™¯åˆ‡æ¢è¿‡ç¨‹ï¼š
    â†“
1. SceneManager æ‰§è¡Œ Replace
    â†“
2. é”€æ¯æ—§åœºæ™¯ (Level 1)
    delete GameScene 1
    â†“
3. æ—§åœºæ™¯çš„æ‰€æœ‰æˆå‘˜å˜é‡è¢«é”€æ¯
    health_, score_ æ¶ˆå¤±ï¼
    â†“
4. åˆ›å»ºæ–°åœºæ™¯ (Level 2)
    new GameScene 2
    â†“
5. æ–°åœºæ™¯åˆå§‹åŒ–é»˜è®¤å€¼
    health_ = 3, score_ = 0
```

**è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±å¿…é¡»å°†éœ€è¦æŒä¹…åŒ–çš„æ•°æ®ä»åœºæ™¯ä¸­å‰¥ç¦»å‡ºæ¥ï¼Œè®©å®ƒçš„ç”Ÿå‘½å‘¨æœŸç‹¬ç«‹äºã€ä¸”é•¿äºä»»ä½•å•ä¸ªæ¸¸æˆåœºæ™¯**ã€‚

---

## 1. è§£å†³æ–¹æ¡ˆï¼šSessionData ç±»

æˆ‘ä»¬åœ¨æ¸¸æˆé€»è¾‘å±‚ `src/game/` ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„ç›®å½• `data`ï¼Œå¹¶åœ¨å…¶ä¸­å®šä¹‰ `SessionData` ç±»ã€‚è¿™ä¸ªç±»å°†æˆä¸ºæˆ‘ä»¬æ¸¸æˆçŠ¶æ€çš„å”¯ä¸€"çœŸç†ä¹‹æº"ã€‚

### src/game/data/session_data.hï¼ˆæ–°å»ºæ–‡ä»¶ï¼‰

```cpp
#pragma once
#include <string>
#include <memory>
#include <nlohmann/json.hpp> 

namespace game::data {

/**
 * @brief ç®¡ç†ä¸åŒæ¸¸æˆåœºæ™¯ä¹‹é—´çš„æ¸¸æˆçŠ¶æ€
 */
class SessionData final {
private:
    int current_health_ = 3;
    int max_health_ = 3;
    int current_score_ = 0;
    int high_score_ = 0;
    
    // è¿›å…¥å…³å¡æ—¶çš„çŠ¶æ€ï¼ˆç”¨äºè¯»/å­˜æ¡£ï¼‰
    int level_health_ = 3;
    int level_score_ = 0;
    std::string map_path_ = "assets/maps/level1.tmj";

public:
    SessionData() = default;
    ~SessionData() = default;

    // åˆ é™¤å¤åˆ¶å’Œç§»åŠ¨æ“ä½œä»¥é˜²æ­¢æ„å¤–å¤åˆ¶
    SessionData(const SessionData&) = delete;
    SessionData& operator=(const SessionData&) = delete;

    // --- Getters & Setters ---
    int getCurrentHealth() const { return current_health_; }
    void setCurrentHealth(int health);
    void addScore(int score_to_add);
    const std::string& getMapPath() const { return map_path_; }
    // ... å…¶ä»– Getters/Setters

    void reset();
    void setNextLevel(const std::string& map_path);
    bool saveToFile(const std::string& filename) const;
    bool loadFromFile(const std::string& filename);
};

} // namespace game::data
```

### ğŸ’¡ è®¾è®¡äº®ç‚¹

#### 1. çŠ¶æ€åˆ†ç¦»

```cpp
int current_health_ = 3;  // å®æ—¶ç”Ÿå‘½å€¼
int level_health_ = 3;    // å…³å¡åˆå§‹ç”Ÿå‘½å€¼
```

**ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªç”Ÿå‘½å€¼ï¼Ÿ**

```
çŠ¶æ€åˆ†ç¦»çš„ç”¨é€”ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿›å…¥å…³å¡æ—¶ï¼š         â”‚
â”‚ level_health_ = 3    â”‚ â† å¿«ç…§
â”‚ current_health_ = 3  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ¸¸æˆè¿›è¡Œä¸­ï¼š         â”‚
â”‚ level_health_ = 3    â”‚ â† ä¸å˜
â”‚ current_health_ = 1  â”‚ â† å®æ—¶å˜åŒ–
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç©å®¶æ­»äº¡åï¼š         â”‚
â”‚ æ¢å¤åˆ°å…³å¡åˆå§‹çŠ¶æ€ï¼š â”‚
â”‚ current_health_ =    â”‚
â”‚   level_health_      â”‚ â† ä»å…³å¡å¼€å§‹å¤æ´»
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| å˜é‡ | è¯´æ˜ | ç”¨é€” |
|------|------|------|
| **current_health_** | å®æ—¶ç”Ÿå‘½å€¼ | æ¸¸æˆè¿‡ç¨‹ä¸­çš„å½“å‰çŠ¶æ€ |
| **level_health_** | å…³å¡åˆå§‹ç”Ÿå‘½å€¼ | ç”¨äºå¤æ´»ã€å­˜æ¡£ |
| **current_score_** | å®æ—¶å¾—åˆ† | æ¸¸æˆè¿‡ç¨‹ä¸­çš„å½“å‰å¾—åˆ† |
| **level_score_** | å…³å¡åˆå§‹å¾—åˆ† | ç”¨äºå¤æ´»ã€å­˜æ¡£ |

#### 2. ä¸å¯å¤åˆ¶

```cpp
// åˆ é™¤å¤åˆ¶å’Œç§»åŠ¨æ“ä½œä»¥é˜²æ­¢æ„å¤–å¤åˆ¶
SessionData(const SessionData&) = delete;
SessionData& operator=(const SessionData&) = delete;
```

**ä¸ºä»€ä¹ˆåˆ é™¤æ‹·è´ï¼Ÿ**

```
å•ä¾‹æ¨¡å¼æ€æƒ³ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸€ä¸ªæ¸¸æˆä¼šè¯ =       â”‚
â”‚ ä¸€ä¸ª SessionData     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¦‚æœå…è®¸æ‹·è´ï¼š       â”‚
â”‚ SessionData data1;   â”‚
â”‚ SessionData data2=data1;â”‚
â”‚ â†’ ä¸¤ä»½æ•°æ®ï¼         â”‚
â”‚ â†’ å“ªä¸ªæ˜¯æ­£ç¡®çš„ï¼Ÿ     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åˆ é™¤æ‹·è´åï¼š         â”‚
â”‚ SessionData data;    â”‚
â”‚ // data2 = data;     â”‚
â”‚ â†’ ç¼–è¯‘é”™è¯¯ï¼âœ…       â”‚
â”‚ â†’ ä¿è¯å”¯ä¸€æ€§         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SessionData æˆå‘˜æ€»è§ˆ

| æˆå‘˜å˜é‡ | ç±»å‹ | è¯´æ˜ |
|---------|------|------|
| **current_health_** | `int` | å½“å‰ç”Ÿå‘½å€¼ |
| **max_health_** | `int` | æœ€å¤§ç”Ÿå‘½å€¼ |
| **current_score_** | `int` | å½“å‰å¾—åˆ† |
| **high_score_** | `int` | å†å²æœ€é«˜åˆ† |
| **level_health_** | `int` | å…³å¡èµ·å§‹ç”Ÿå‘½å€¼ |
| **level_score_** | `int` | å…³å¡èµ·å§‹å¾—åˆ† |
| **map_path_** | `string` | å½“å‰å…³å¡åœ°å›¾è·¯å¾„ |

---

## 2. å®ç°æ ¸å¿ƒåŠŸèƒ½

### src/game/data/session_data.cppï¼ˆæ–°å»ºæ–‡ä»¶ï¼‰

```cpp
#include "session_data.h"
#include <fstream>
#include <nlohmann/json.hpp>
#include <spdlog/spdlog.h>

namespace game::data {

void SessionData::setNextLevel(const std::string &map_path) {
    map_path_ = map_path;
    // "å¿«ç…§"å½“å‰çŠ¶æ€ï¼Œä½œä¸ºä¸‹ä¸€ä¸ªå…³å¡çš„åˆå§‹çŠ¶æ€
    level_health_ = current_health_;
    level_score_ = current_score_;
}

bool SessionData::saveToFile(const std::string& filename) const {
    nlohmann::json j;
    j["level_score"] = level_score_;
    j["level_health"] = level_health_;
    j["max_health"] = max_health_;
    j["high_score"] = high_score_;
    j["map_path"] = map_path_;

    std::ofstream ofs(filename);
    if (!ofs.is_open()) { /* ... error handling ... */ return false; }
    ofs << j.dump(4); // å†™å…¥æ ¼å¼åŒ–çš„JSON
    return true;
}

bool SessionData::loadFromFile(const std::string& filename) {
    std::ifstream ifs(filename);
    if (!ifs.is_open()) { /* ... error handling ... */ return false; }
    nlohmann::json j;
    ifs >> j;

    current_score_ = level_score_ = j.value("level_score", 0);
    current_health_ = level_health_ = j.value("level_health", 3);
    max_health_ = j.value("max_health", 3);
    high_score_ = j.value("high_score", 0);
    map_path_ = j.value("map_path", "assets/maps/level1.tmj");
    return true;
}

// ... å…¶ä»–å‡½æ•°çš„å®ç° ...
}
```

### æ ¸å¿ƒæ–¹æ³•è§£æ

#### setNextLevel æ–¹æ³•

```
setNextLevel å·¥ä½œæµç¨‹ï¼š
    â†“
1. æ›´æ–°åœ°å›¾è·¯å¾„
    map_path_ = "level2.tmj"
    â†“
2. å¿«ç…§å½“å‰çŠ¶æ€
    level_health_ = current_health_
    level_score_ = current_score_
    â†“
3. è¿™äº›å€¼æˆä¸ºä¸‹ä¸€å…³çš„åˆå§‹å€¼
    ä¸‹ä¸€å…³ä»è¿™ä¸ªçŠ¶æ€å¼€å§‹
```

**å¿«ç…§æœºåˆ¶**ï¼š

```
å¿«ç…§ç¤ºä¾‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Level 1 ç»“æŸæ—¶ï¼š     â”‚
â”‚ current_health_ = 2  â”‚
â”‚ current_score_ = 150 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è°ƒç”¨ setNextLevel()  â”‚
â”‚ level_health_ = 2    â”‚ â† å¿«ç…§
â”‚ level_score_ = 150   â”‚ â† å¿«ç…§
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Level 2 å¼€å§‹æ—¶ï¼š     â”‚
â”‚ current_health_ = 2  â”‚ â† ç»§æ‰¿å¿«ç…§
â”‚ current_score_ = 150 â”‚ â† ç»§æ‰¿å¿«ç…§
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å­˜æ¡£åŠŸèƒ½

```
saveToFile æµç¨‹ï¼š
    â†“
1. åˆ›å»º JSON å¯¹è±¡
    nlohmann::json j
    â†“
2. å¡«å……æ•°æ®
    j["level_health"] = level_health_
    j["level_score"] = level_score_
    ...
    â†“
3. æ ¼å¼åŒ–è¾“å‡º
    j.dump(4)  â† 4ç©ºæ ¼ç¼©è¿›
    â†“
4. å†™å…¥æ–‡ä»¶
    ofstream â†’ save.json
```

**JSON æ ¼å¼ç¤ºä¾‹**ï¼š

```json
{
    "level_health": 2,
    "level_score": 150,
    "max_health": 3,
    "high_score": 200,
    "map_path": "assets/maps/level2.tmj"
}
```

#### è¯»æ¡£åŠŸèƒ½

```
loadFromFile æµç¨‹ï¼š
    â†“
1. æ‰“å¼€æ–‡ä»¶
    ifstream(filename)
    â†“
2. è§£æ JSON
    ifs >> j
    â†“
3. è¯»å–æ•°æ®ï¼ˆå¸¦é»˜è®¤å€¼ï¼‰
    j.value("level_health", 3)
    â†“
4. åŒæ­¥ current å’Œ level
    current_health_ = level_health_
    â†“
æ•°æ®æ¢å¤å®Œæˆ
```

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šæ¶æ„é‡æ„

ç°åœ¨æˆ‘ä»¬éœ€è¦è®© GameScene ä½¿ç”¨è¿™ä¸ªå…±äº«çš„æ•°æ®å¯¹è±¡ã€‚

---

## 3. æ”¹é€  GameSceneï¼šä»"æ‹¥æœ‰è€…"åˆ°"ä½¿ç”¨è€…"

ç°åœ¨ï¼Œ`GameScene` ä¸å†éœ€è¦è‡ªå·±ç®¡ç†çŠ¶æ€ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªå¤–éƒ¨ä¼ å…¥çš„ `SessionData` å¯¹è±¡æ¥å·¥ä½œã€‚è¿™é‡Œï¼Œ`std::shared_ptr` æ˜¯æˆ‘ä»¬çš„æœ€ä½³é€‰æ‹©ã€‚

### src/game/scene/game_scene.hï¼ˆæ›´æ–°ï¼‰

```cpp
#include <memory> // For std::shared_ptr

namespace game::data {
    class SessionData;
}

class GameScene final: public engine::scene::Scene {
    // åœºæ™¯é—´å…±äº«æ•°æ®ï¼Œå› æ­¤ç”¨shared_ptr
    std::shared_ptr<game::data::SessionData> game_session_data_;
    // ...
public:
    // æ„é€ å‡½æ•°ä¸å†éœ€è¦ nameï¼Œè€Œæ˜¯æ¥æ”¶ä¸€ä¸ª SessionData æ™ºèƒ½æŒ‡é’ˆ
    GameScene(engine::core::Context& context, 
              engine::scene::SceneManager& scene_manager, 
              std::shared_ptr<game::data::SessionData> data = nullptr);
    // ...
};
```

### ğŸ’¡ ä¸ºä»€ä¹ˆç”¨ std::shared_ptrï¼Ÿ

```
shared_ptr çš„ä½œç”¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GameScene 1 åˆ›å»º     â”‚
â”‚ shared_ptr<Data>     â”‚
â”‚ å¼•ç”¨è®¡æ•° = 1         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åˆ›å»º GameScene 2     â”‚
â”‚ ä¼ é€’ shared_ptr      â”‚
â”‚ å¼•ç”¨è®¡æ•° = 2         â”‚ â† ä¸¤ä¸ªåœºæ™¯å…±äº«
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é”€æ¯ GameScene 1     â”‚
â”‚ å¼•ç”¨è®¡æ•° = 1         â”‚ â† æ•°æ®ä»å­˜æ´»
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ GameScene 2 ä½¿ç”¨ä¸­   â”‚
â”‚ æ•°æ®å®‰å…¨ä¿ç•™ âœ…      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å½“ SceneManager æ›¿æ¢åœºæ™¯æ—¶**ï¼š

1. æ—§ GameScene çš„ `shared_ptr` å®ä¾‹è¢«é”€æ¯
2. æ–° GameScene æŒæœ‰åŒä¸€ä¸ª SessionData å¯¹è±¡çš„å¦ä¸€ä¸ª `shared_ptr` å®ä¾‹
3. SessionData å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä»2å˜ä¸º1ï¼Œä½†ä¸ä¼šé™åˆ°0ï¼Œå› æ­¤å®ƒä¸ä¼šè¢«é”€æ¯

**è¿™å®Œç¾åœ°å®ç°äº†æ•°æ®å¯¹è±¡åœ¨åœºæ™¯åˆ‡æ¢è¿‡ç¨‹ä¸­çš„"å¹¸å­˜"**ã€‚

### å¼•ç”¨è®¡æ•°æœºåˆ¶

```
å¼•ç”¨è®¡æ•°å˜åŒ–ï¼š
æ—¶é—´    åœºæ™¯1  åœºæ™¯2  å¼•ç”¨è®¡æ•°  å¯¹è±¡çŠ¶æ€
  â†“
t1:    åˆ›å»º   -      1        å­˜æ´»
t2:    æŒæœ‰   åˆ›å»º    2        å­˜æ´»
t3:    é”€æ¯   æŒæœ‰    1        å­˜æ´» âœ…
t4:    -     é”€æ¯    0        é”€æ¯

å¯¹æ¯” unique_ptrï¼š
t1:    åˆ›å»º   -      -        å­˜æ´»
t3:    é”€æ¯   -      -        é”€æ¯ âŒ
â†’ æ•°æ®ä¸¢å¤±ï¼
```

| æ™ºèƒ½æŒ‡é’ˆ | æ‰€æœ‰æƒ | é€‚ç”¨åœºæ™¯ |
|---------|-------|---------|
| **unique_ptr** | ç‹¬å  | å•ä¸€æ‰€æœ‰è€… |
| **shared_ptr** | å…±äº« | å¤šä¸ªæ‰€æœ‰è€…ï¼ˆè·¨åœºæ™¯æ•°æ®ï¼‰âœ… |
| **weak_ptr** | è§‚å¯Ÿ | é¿å…å¾ªç¯å¼•ç”¨ |

### GameScene æ„é€ å‡½æ•°

#### src/game/scene/game_scene.cppï¼ˆæ›´æ–°ï¼‰

```cpp
// src/game/scene/game_scene.cpp
GameScene::GameScene(engine::core::Context& context, 
                     engine::scene::SceneManager& scene_manager,
                     std::shared_ptr<game::data::SessionData> data)
    : Scene("GameScene", context, scene_manager), game_session_data_(std::move(data)) {
    if (!game_session_data_) { // å¦‚æœæ²¡æœ‰ä¼ å…¥SessionDataï¼Œåˆ™åˆ›å»ºä¸€ä¸ªé»˜è®¤çš„
        game_session_data_ = std::make_shared<game::data::SessionData>();
        spdlog::info("æœªæä¾› SessionDataï¼Œä¸ºæ–°æ¸¸æˆåˆ›å»ºã€‚");
    }
}
```

### æ„é€ å‡½æ•°é€»è¾‘

```
æ„é€ å‡½æ•°æµç¨‹ï¼š
    â†“
æ¥æ”¶ shared_ptr<SessionData>
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           â”‚           â”‚
data != null  data == null
â”‚           â”‚
â†“           â†“
ä½¿ç”¨ä¼ å…¥çš„  åˆ›å»ºæ–°çš„
SessionData SessionData
â”‚           â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”‚
      â†“
game_session_data_ å°±ç»ª
```

**ä¸¤ç§ä½¿ç”¨åœºæ™¯**ï¼š

| åœºæ™¯ | å‚æ•° | è¡Œä¸º |
|------|------|------|
| **æ¸¸æˆå¯åŠ¨** | `nullptr` | åˆ›å»ºæ–°çš„ SessionData |
| **å…³å¡åˆ‡æ¢** | ä¼ å…¥ç°æœ‰ | ä½¿ç”¨å…±äº«çš„ SessionData |

---

## 4. ä½¿ç”¨ SessionData

ç°åœ¨ï¼Œæ‰€æœ‰ä¸æ¸¸æˆçŠ¶æ€ç›¸å…³çš„é€»è¾‘éƒ½å°†é€šè¿‡ `game_session_data_` æ¥è¿›è¡Œã€‚

### åŠ è½½å…³å¡

ä¸å†ä»åœºæ™¯åè·å–åœ°å›¾è·¯å¾„ï¼Œè€Œæ˜¯ä» SessionData è·å–ã€‚

```cpp
// in GameScene::initLevel()
auto level_path = game_session_data_->getMapPath();
level_loader.loadLevel(level_path, *this);
```

### è·¯å¾„æ¥æºå¯¹æ¯”

```
ä¿®æ”¹å‰ï¼ˆåœºæ™¯åï¼‰ï¼š
scene_name_ = "level1"
    â†“
levelNameToPath()
    â†“
"assets/maps/level1.tmj"

ä¿®æ”¹åï¼ˆSessionDataï¼‰ï¼š
game_session_data_->getMapPath()
    â†“
"assets/maps/level1.tmj"

ä¼˜åŠ¿ï¼š
âœ… æ•°æ®é›†ä¸­ç®¡ç†
âœ… æ”¯æŒä»»æ„è·¯å¾„
âœ… æ˜“äºå­˜æ¡£/è¯»æ¡£
```

### ç©å®¶å—ä¼¤

å½“ç©å®¶ä¸æ•Œäººç¢°æ’æ—¶ï¼Œæ›´æ–° SessionDataã€‚

```cpp
// ç©å®¶å—ä¼¤
void GameScene::handlePlayerDamage(int damage) {
    // ...
    game_session_data_->setCurrentHealth(player_component->getHealthComponent()->getCurrentHealth());
}
```

### æ”¶é›†é“å…·

åƒåˆ°å®çŸ³æ—¶ï¼Œæ›´æ–°å¾—åˆ†ã€‚

```cpp
// åƒåˆ°å®çŸ³
void GameScene::playerVSItemCollision(...) {
    if (item->getName() == "gem") {
        game_session_data_->addScore(5);
    }
    // ...
}
```

### æ•°æ®åŒæ­¥

```
æ•°æ®åŒæ­¥æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¸¸æˆäº‹ä»¶å‘ç”Ÿï¼š       â”‚
â”‚ â€¢ ç©å®¶å—ä¼¤           â”‚
â”‚ â€¢ æ”¶é›†é“å…·           â”‚
â”‚ â€¢ å®Œæˆå…³å¡           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ GameScene å¤„ç†äº‹ä»¶   â”‚
â”‚ â€¢ æ›´æ–°ç»„ä»¶çŠ¶æ€       â”‚
â”‚ â€¢ æ’­æ”¾éŸ³æ•ˆ/ç‰¹æ•ˆ      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åŒæ­¥åˆ° SessionData   â”‚
â”‚ â€¢ setCurrentHealth() â”‚
â”‚ â€¢ addScore()         â”‚
â”‚ â€¢ setNextLevel()     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SessionData ä¿æŒæœ€æ–° â”‚
â”‚ éšæ—¶å¯ä»¥å­˜æ¡£         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šåœºæ™¯åˆ‡æ¢é›†æˆ

æœ€åï¼Œæˆ‘ä»¬æ¥ä¿®æ”¹å…³å¡åˆ‡æ¢çš„é€»è¾‘ï¼Œç¡®ä¿ SessionData èƒ½å¤Ÿæ­£ç¡®åœ°ä¼ é€’ä¸‹å»ã€‚

---

## 5. ä¸²è”åœºæ™¯åˆ‡æ¢

### src/game/scene/game_scene.cppï¼ˆæ›´æ–°ï¼‰

```cpp
void GameScene::toNextLevel(engine::object::GameObject *trigger)
{
    // 1. ä»è§¦å‘å™¨è·å–ä¸‹ä¸€å…³çš„åœ°å›¾å
    auto scene_name = trigger->getName();
    auto map_path = levelNameToPath(scene_name);

    // 2. æ›´æ–° SessionDataï¼Œä¸ºä¸‹ä¸€å…³åšå‡†å¤‡
    game_session_data_->setNextLevel(map_path);

    // 3. åˆ›å»ºæ–°åœºæ™¯ï¼Œå¹¶æŠŠå½“å‰çš„ game_session_data_ ä¼ ç»™å®ƒ
    auto next_scene = std::make_unique<game::scene::GameScene>(context_, scene_manager_, game_session_data_);

    // 4. è¯·æ±‚æ›¿æ¢åœºæ™¯
    scene_manager_.requestReplaceScene(std::move(next_scene));
}
```

### å®Œæ•´çš„åˆ‡æ¢æµç¨‹

```
å…³å¡åˆ‡æ¢æ•°æ®ä¼ é€’ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è§¦å‘åˆ‡æ¢          â”‚
â”‚    ç©å®¶ â†’ ğŸšª         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. è·å–ç›®æ ‡å…³å¡      â”‚
â”‚    trigger->getName()â”‚
â”‚    "level2"          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. æ›´æ–° SessionData  â”‚
â”‚    setNextLevel()    â”‚
â”‚    å¿«ç…§å½“å‰çŠ¶æ€      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 4. åˆ›å»ºæ–°åœºæ™¯        â”‚
â”‚    new GameScene(    â”‚
â”‚      ...,            â”‚
â”‚      game_session    â”‚
â”‚        _data_)       â”‚ â† ä¼ é€’ shared_ptr
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 5. shared_ptr å¤åˆ¶   â”‚
â”‚    å¼•ç”¨è®¡æ•° +1       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 6. æ›¿æ¢åœºæ™¯          â”‚
â”‚    Replace Scene     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 7. æ—§åœºæ™¯é”€æ¯        â”‚
â”‚    å¼•ç”¨è®¡æ•° -1       â”‚
â”‚    æ•°æ®ä¿ç•™ âœ…       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 8. æ–°åœºæ™¯åˆå§‹åŒ–      â”‚
â”‚    ä½¿ç”¨ SessionData  â”‚
â”‚    ç»§æ‰¿çŠ¶æ€ âœ…       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¿™ä¸ªæµç¨‹éå¸¸æ¸…æ™°ï¼šæ›´æ–°æ•°æ® â†’ åˆ›å»ºæ–°åœºæ™¯å¹¶ä¼ é€’æ•°æ® â†’ åˆ‡æ¢**ã€‚

### æ¸¸æˆå¯åŠ¨

åŒæ—¶ï¼Œæ¸¸æˆå¯åŠ¨æ—¶åˆ›å»ºç¬¬ä¸€ä¸ªåœºæ™¯çš„é€»è¾‘ä¹Ÿè¦ç›¸åº”ç®€åŒ–ã€‚

#### src/engine/core/game_app.cppï¼ˆæ›´æ–°ï¼‰

```cpp
// åˆ›å»ºç¬¬ä¸€ä¸ªåœºæ™¯å¹¶å‹å…¥æ ˆ
// in GameApp::init()
auto scene = std::make_unique<game::scene::GameScene>(*context_, *scene_manager_);
scene_manager_->requestPushScene(std::move(scene));
```

**è¿™é‡Œæˆ‘ä»¬æ²¡æœ‰ä¼ é€’ SessionDataï¼Œæ‰€ä»¥ GameScene çš„æ„é€ å‡½æ•°ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ä¼šè¯**ã€‚

### æ•°æ®æµå‘

```
æ•°æ®æµå‘å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GameApp::init()    â”‚
â”‚   åˆ›å»ºé¦–ä¸ªåœºæ™¯       â”‚
â”‚   data = nullptr     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GameScene 1        â”‚
â”‚   æ„é€ å‡½æ•°           â”‚
â”‚   åˆ›å»º SessionData   â”‚ â† æ–°å»º
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   toNextLevel()      â”‚
â”‚   setNextLevel()     â”‚
â”‚   ä¼ é€’ SessionData   â”‚ â† å…±äº«
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GameScene 2        â”‚
â”‚   æ„é€ å‡½æ•°           â”‚
â”‚   ä½¿ç”¨ä¼ å…¥çš„ Data    â”‚ â† ç»§æ‰¿
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
       ...ç»§ç»­ä¼ é€’...
```

---

## âœ… ç¼–è¯‘ä¸è¿è¡Œ

ç¼–è¯‘å¹¶è¿è¡Œæ¸¸æˆï¼Œä½ ä¼šçœ‹åˆ°æ•°æ®åœ¨å…³å¡é—´æ­£ç¡®ä¿ç•™ï¼š

```
è¿è¡Œæ•ˆæœï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Level 1ï¼š              â”‚
â”‚  ğŸ‘¤ ç”Ÿå‘½: 3/3           â”‚
â”‚  ğŸ’ å¾—åˆ†: 0             â”‚
â”‚  æ”¶é›†å®çŸ³...            â”‚
â”‚  ğŸ’ å¾—åˆ†: 50            â”‚
â”‚  å—ä¼¤...                â”‚
â”‚  ğŸ‘¤ ç”Ÿå‘½: 1/3           â”‚
â”‚  â†’ è¿›å…¥ Level 2 ğŸšª      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Level 2ï¼š              â”‚
â”‚  ğŸ‘¤ ç”Ÿå‘½: 1/3 âœ…        â”‚
â”‚  ğŸ’ å¾—åˆ†: 50 âœ…         â”‚
â”‚  æ•°æ®æˆåŠŸä¿ç•™ï¼         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä½ ä¼šçœ‹åˆ°ï¼š**
- âœ… å…³å¡åˆ‡æ¢åç”Ÿå‘½å€¼ä¿æŒä¸å˜
- âœ… å¾—åˆ†ç»§ç»­ç´¯ç§¯
- âœ… æ¸¸æˆçŠ¶æ€è¿è´¯
- âœ… å¯ä»¥å­˜æ¡£å’Œè¯»æ¡£
- âœ… å®Œæ•´çš„æ¸¸æˆä½“éªŒ

---

## ğŸ¯ ç³»ç»Ÿæ¶æ„æ€»ç»“

### å®Œæ•´çš„æ•°æ®å…±äº«ç³»ç»Ÿ

```
æ•°æ®å…±äº«æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     SessionData          â”‚ â† æ•°æ®å±‚
â”‚  (æ¸¸æˆçŠ¶æ€çš„å”¯ä¸€æº)      â”‚   ç‹¬ç«‹ç”Ÿå‘½å‘¨æœŸ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ shared_ptr
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         â”‚         â”‚
    â†“         â†“         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Level 1 â”‚â”‚Level 2 â”‚â”‚Level 3 â”‚ â† åœºæ™¯å±‚
â”‚Scene   â”‚â”‚Scene   â”‚â”‚Scene   â”‚   ä½¿ç”¨å…±äº«æ•°æ®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†‘         â†‘         â†‘
    â”‚         â”‚         â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    SceneManager          â”‚ â† ç®¡ç†å±‚
â”‚  (æ§åˆ¶åœºæ™¯åˆ‡æ¢)          â”‚   ä¼ é€’ shared_ptr
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæˆå°±

æˆ‘ä»¬æˆåŠŸåœ°ï¼š

1. âœ… **è§£è€¦äº†æ•°æ®ä¸åœºæ™¯**ï¼šæ•°æ®ç”Ÿå‘½å‘¨æœŸç‹¬ç«‹
2. âœ… **å®ç°äº†æ•°æ®å…±äº«**ï¼šä½¿ç”¨ `shared_ptr` å®‰å…¨ä¼ é€’
3. âœ… **è®¾è®¡äº†çŠ¶æ€åˆ†ç¦»**ï¼šcurrent vs level çŠ¶æ€
4. âœ… **å®ç°äº†å­˜æ¡£ç³»ç»Ÿ**ï¼šJSON åºåˆ—åŒ–
5. âœ… **ä¿è¯äº†æ•°æ®å”¯ä¸€æ€§**ï¼šåˆ é™¤æ‹·è´æ„é€ 
6. âœ… **æå‡äº†æ¸¸æˆä½“éªŒ**ï¼šè¿è´¯çš„æ¸¸æˆè¿›ç¨‹

### æ¶æ„å¯¹æ¯”

```
é‡æ„å‰ vs é‡æ„åï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é‡æ„å‰ï¼ˆè€¦åˆï¼‰ï¼š     â”‚
â”‚ GameScene {          â”‚
â”‚   int health_;       â”‚
â”‚   int score_;        â”‚
â”‚ }                    â”‚
â”‚ â†’ æ•°æ®éšåœºæ™¯æ¶ˆå¤± âŒ  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é‡æ„åï¼ˆè§£è€¦ï¼‰ï¼š     â”‚
â”‚ SessionData {        â”‚
â”‚   int health_;       â”‚
â”‚   int score_;        â”‚
â”‚ }                    â”‚
â”‚ GameScene {          â”‚
â”‚   shared_ptr<Data>   â”‚
â”‚ }                    â”‚
â”‚ â†’ æ•°æ®ç‹¬ç«‹å­˜åœ¨ âœ…    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### shared_ptr çš„ä¼˜åŠ¿

| åœºæ™¯ | unique_ptr | shared_ptr |
|------|-----------|------------|
| **å•ä¸€æ‰€æœ‰è€…** | âœ… å®Œç¾ | âš ï¸ è¿‡åº¦ |
| **è·¨åœºæ™¯æ•°æ®** | âŒ æ— æ³•å®ç° | âœ… å®Œç¾ |
| **å¼•ç”¨è®¡æ•°** | âŒ æ—  | âœ… è‡ªåŠ¨ç®¡ç† |
| **ç”Ÿå‘½å‘¨æœŸ** | å›ºå®š | çµæ´» |

### å…³é”®æŠ€æœ¯ç‚¹

| æŠ€æœ¯ç‚¹ | å®ç°æ–¹å¼ | æ•ˆæœ |
|-------|---------|------|
| **æ•°æ®è§£è€¦** | SessionData ç±» | ç‹¬ç«‹ç”Ÿå‘½å‘¨æœŸ |
| **å®‰å…¨å…±äº«** | `shared_ptr` | å¼•ç”¨è®¡æ•°ç®¡ç† |
| **çŠ¶æ€å¿«ç…§** | level_health/score | æ”¯æŒå¤æ´»å’Œå­˜æ¡£ |
| **æ•°æ®åºåˆ—åŒ–** | nlohmann/json | å­˜æ¡£/è¯»æ¡£ |
| **é˜²æ­¢å¤åˆ¶** | delete copy | ä¿è¯å”¯ä¸€æ€§ |

### èŒè´£åˆ’åˆ†

```
æ¸…æ™°çš„èŒè´£åˆ†å·¥ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SessionData      â”‚ â† æ•°æ®ç®¡ç†è€…
â”‚ "å­˜å‚¨æ¸¸æˆçŠ¶æ€"    â”‚   â€¢ ç”Ÿå‘½å€¼
â”‚                  â”‚   â€¢ å¾—åˆ†
â”‚                  â”‚   â€¢ å…³å¡è·¯å¾„
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GameScene        â”‚ â† æ•°æ®ä½¿ç”¨è€…
â”‚ "ä½¿ç”¨æ¸¸æˆçŠ¶æ€"    â”‚   â€¢ è¯»å–æ•°æ®
â”‚                  â”‚   â€¢ æ›´æ–°æ•°æ®
â”‚                  â”‚   â€¢ ä¼ é€’æ•°æ®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SceneManager     â”‚ â† åˆ‡æ¢åè°ƒè€…
â”‚ "ç®¡ç†åœºæ™¯åˆ‡æ¢"    â”‚   â€¢ åˆ›å»ºåœºæ™¯
â”‚                  â”‚   â€¢ ä¼ é€’æŒ‡é’ˆ
â”‚                  â”‚   â€¢ é”€æ¯åœºæ™¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“š æ€»ç»“

å¤ªæ£’äº†ï¼æˆ‘ä»¬å®Œæˆäº†ä¸€æ¬¡æ„ä¹‰é‡å¤§çš„æ¶æ„é‡æ„ã€‚**é€šè¿‡å¼•å…¥ SessionData ç±»å¹¶ä½¿ç”¨ shared_ptr è¿›è¡Œä¼ é€’ï¼Œæˆ‘ä»¬å½»åº•è§£å†³äº†è·¨åœºæ™¯æ•°æ®æŒä¹…åŒ–çš„é—®é¢˜**ã€‚

**å…³é”®è¦ç‚¹ï¼š**
- ğŸ“¦ SessionDataï¼šç‹¬ç«‹çš„æ¸¸æˆçŠ¶æ€ç®¡ç†ç±»
- ğŸ”— shared_ptrï¼šå®‰å…¨çš„è·¨åœºæ™¯æ•°æ®å…±äº«
- ğŸ“¸ çŠ¶æ€å¿«ç…§ï¼šcurrent vs level åˆ†ç¦»è®¾è®¡
- ğŸ’¾ å­˜æ¡£ç³»ç»Ÿï¼šJSON åºåˆ—åŒ–å’Œååºåˆ—åŒ–
- ğŸš« é˜²æ­¢å¤åˆ¶ï¼šåˆ é™¤æ‹·è´æ„é€ ä¿è¯å”¯ä¸€æ€§
- ğŸ”„ æ•°æ®ä¼ é€’ï¼šåœºæ™¯åˆ‡æ¢æ—¶ä¼ é€’ shared_ptr
- ğŸ® è¿è´¯ä½“éªŒï¼šå®Œæ•´çš„æ¸¸æˆè¿›ç¨‹

> ğŸ’¡ **è®¾è®¡å“²å­¦**ï¼šåœ¨æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬è§£è€¦äº†æ•°æ®ä¸åœºæ™¯ï¼Œå°†æ˜“å˜çš„æ¸¸æˆçŠ¶æ€ï¼ˆå¦‚HPã€åˆ†æ•°ï¼‰ä»åœºæ™¯ç±»ä¸­åˆ†ç¦»å‡ºæ¥ã€‚æŒæ¡äº† `std::shared_ptr` çš„ä¸€ç§ç»å…¸ç”¨æ³•ï¼šå®‰å…¨åœ°ç®¡ç†å…±äº«å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚å®ç°äº†æ•°æ®é©±åŠ¨çš„å…³å¡åŠ è½½ï¼ŒGameScene ç°åœ¨å¯ä»¥åŠ è½½ç”± SessionData æŒ‡å®šçš„ä»»ä½•åœ°å›¾ã€‚é¡ºä¾¿åŠ å…¥äº†å­˜æ¡£/è¯»æ¡£åŠŸèƒ½ï¼Œä¸ºæˆ‘ä»¬çš„æ¸¸æˆå¢æ·»äº†ä¸“ä¸šçº§çš„åŠŸèƒ½ã€‚è¿™ç§æ¶æ„è®¾è®¡æ˜¯å¤§å‹æ¸¸æˆçš„æ ‡å‡†æ¨¡å¼ï¼Œæ•°æ®å±‚ä¸è¡¨ç°å±‚çš„åˆ†ç¦»è®©ç³»ç»Ÿæ›´åŠ æ¸…æ™°ã€çµæ´»ã€æ˜“äºç»´æŠ¤ã€‚

**æ¶æ„é‡æ„çš„ä»·å€¼**ï¼š

```
è€¦åˆ vs è§£è€¦ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è€¦åˆè®¾è®¡ï¼ˆâŒï¼‰ï¼š     â”‚
â”‚ â€¢ æ•°æ®åœ¨åœºæ™¯å†…       â”‚
â”‚ â€¢ åˆ‡æ¢å³ä¸¢å¤±         â”‚
â”‚ â€¢ æ— æ³•å­˜æ¡£           â”‚
â”‚ â€¢ ä½“éªŒä¸­æ–­           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è§£è€¦è®¾è®¡ï¼ˆâœ…ï¼‰ï¼š     â”‚
â”‚ â€¢ æ•°æ®ç‹¬ç«‹ç®¡ç†       â”‚
â”‚ â€¢ è·¨åœºæ™¯å…±äº«         â”‚
â”‚ â€¢ è½»æ¾å­˜æ¡£           â”‚
â”‚ â€¢ ä½“éªŒè¿è´¯           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¥½çš„æ¶æ„è®©ä¸€åˆ‡å˜ç®€å•ï¼
```

---

## ğŸš€ ä¸‹ä¸€æ­¥å±•æœ›

ç°åœ¨ï¼Œç©å®¶åœ¨"é˜³å…‰å²›"çš„å†’é™©ä¹‹æ—…å°†æ˜¯è¿è´¯è€Œå®Œæ•´çš„ã€‚ä»–ä»¬å¯ä»¥å¸¦ç€ç§¯ç´¯çš„å¾—åˆ†å’Œå‰©ä½™çš„ç”Ÿå‘½ï¼Œå‹‡æ•¢åœ°è¿ˆå‘ä¸‹ä¸€ä¸ªæœªçŸ¥çš„å…³å¡ã€‚

ä½†æˆ‘ä»¬çš„æ¸¸æˆä¸–ç•Œä»ç„¶ç¼ºå°‘ä¸€æ ·é‡è¦çš„ä¸œè¥¿â€”â€”**æ–‡å­—**ï¼

- â“ å¦‚ä½•æ¸²æŸ“æ–‡æœ¬ï¼Ÿ
- â“ å¦‚ä½•æ˜¾ç¤ºç”Ÿå‘½å€¼å’Œå¾—åˆ†ï¼Ÿ
- â“ å¦‚ä½•æ„å»ºæ¸¸æˆUIç³»ç»Ÿï¼Ÿ

ä¸‹ä¸€è¯¾ï¼Œæˆ‘ä»¬å°†å­¦ä¹ æ–‡æœ¬æ¸²æŸ“ï¼š

- ğŸ“ **æ–‡æœ¬æ¸²æŸ“å¼•æ“**ï¼šä½¿ç”¨ SDL_ttf æ¸²æŸ“æ–‡å­—
- ğŸ¨ **UIç®¡ç†å™¨**ï¼šç»Ÿä¸€ç®¡ç†ç•Œé¢å…ƒç´ 
- ğŸ’– **ç”Ÿå‘½å›¾æ ‡**ï¼šæ˜¾ç¤ºç©å®¶ç”Ÿå‘½å€¼
- ğŸ† **å¾—åˆ†æ˜¾ç¤º**ï¼šå®æ—¶æ˜¾ç¤ºæ¸¸æˆå¾—åˆ†
- ğŸ® **å®Œæ•´çš„UIç³»ç»Ÿ**ï¼šæ‰“é€ ä¸“ä¸šçš„æ¸¸æˆç•Œé¢

æ•¬è¯·æœŸå¾…ï¼ğŸ®ğŸŒŸ