# èµ„æºç®¡ç†æ¨¡å—

<div class="video-container">
  <div id="bilibili" class="video-content">
    <!-- Bç«™åµŒå…¥ï¼šä½¿ç”¨ https æ˜ç¡®åè®®ï¼ˆé¿å… file:// æˆ– http å¯¼è‡´è¢«æµè§ˆå™¨æ‹¦æˆªï¼‰ -->
    <iframe
      class="video-frame"
      src="https://player.bilibili.com/player.html?bvid=BV1hVKhziEpS&page=1&autoplay=0&danmaku=0&high_quality=1"
      width="100%"
      height="480"
      scrolling="no"
      frameborder="0"
      allowfullscreen>
    </iframe>
  </div>
</div>

[åœ¨ Bilibili ä¸Šè§‚çœ‹](https://www.bilibili.com/video/BV1hVKhziEpS)

## ğŸ“– æ¦‚è¿°

åœ¨ä¹‹å‰çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ­å»ºäº†æ¸¸æˆå¼•æ“çš„"éª¨æ¶"â€”â€”ä¸»å¾ªç¯ä¸æ—¶é—´æ§åˆ¶ã€‚ç°åœ¨ï¼Œæ˜¯æ—¶å€™ä¸ºè¿™ä¸ªéª¨æ¶æ·»åŠ "è¡€è‚‰"äº†ã€‚ä»»ä½•æ¸¸æˆéƒ½ç¦»ä¸å¼€å„ç§èµ„æºï¼šå›¾ç‰‡ã€éŸ³æ•ˆ

## ğŸ¯ æ ¸å¿ƒé—®é¢˜

æœ¬èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªå®Œæ•´çš„èµ„æºç®¡ç†æ¨¡å—ï¼Œå®ƒèƒ½è§£å†³ä»¥ä¸‹æ ¸å¿ƒé—®é¢˜ï¼š

### ğŸš« é¿å…é‡å¤åŠ è½½
åŒä¸€å¼ å›¾ç‰‡æˆ–åŒä¸€ä¸ªéŸ³æ•ˆåœ¨æ¸¸æˆä¸­å¯èƒ½ä¼šè¢«å¤šæ¬¡ä½¿ç”¨ã€‚æˆ‘ä»¬ä¸å¸Œæœ›æ¯æ¬¡ä½¿ç”¨éƒ½ä»ç¡¬ç›˜é‡æ–°åŠ è½½ä¸€æ¬¡ï¼Œè¿™ä¼šä¸¥é‡å½±å“æ€§èƒ½ã€‚

### ğŸ”„ è‡ªåŠ¨åŒ–å†…å­˜ç®¡ç†  
æ‰‹åŠ¨ç®¡ç†åŠ è½½åˆ°å†…å­˜ä¸­çš„æ¯ä¸€ä¸ªèµ„æºï¼ˆ`SDL_Texture`, `Mix_Chunk`ç­‰ï¼‰æ—¢ç¹çåˆå®¹æ˜“å‡ºé”™ï¼Œæ˜¯å†…å­˜æ³„æ¼çš„é‡ç¾åŒºã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªèƒ½è‡ªåŠ¨é‡Šæ”¾èµ„æºçš„ç³»ç»Ÿã€‚

### ğŸ”— ç»Ÿä¸€çš„è®¿é—®æ¥å£
å¼•æ“çš„å…¶ä»–éƒ¨åˆ†ä¸åº”è¯¥å…³å¿ƒèµ„æºæ˜¯å¦‚ä½•è¢«åŠ è½½å’Œå­˜å‚¨çš„ã€‚å®ƒä»¬åªéœ€è¦ä¸€ä¸ªç®€å•çš„æ¥å£ï¼Œé€šè¿‡æ–‡ä»¶åå°±èƒ½è·å–åˆ°æ‰€éœ€çš„èµ„æºã€‚ä¹‹å‰çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ­å»ºäº†æ¸¸æˆå¼•æ“çš„â€œéª¨æ¶â€â€”â€”ä¸»å¾ªç¯ä¸æ—¶é—´æ§åˆ¶ã€‚ç°åœ¨ï¼Œæ˜¯æ—¶å€™ä¸ºè¿™ä¸ªéª¨æ¶æ·»åŠ â€œè¡€è‚‰â€äº†ã€‚ä»»ä½•æ¸¸æˆéƒ½ç¦»ä¸å¼€å„ç§èµ„æºï¼šå›¾ç‰‡ã€éŸ³æ•ˆã€éŸ³ä¹ã€å­—ä½“ç­‰ã€‚ä¸€ä¸ªå¥½çš„æ¸¸æˆå¼•æ“å¿…é¡»æœ‰ä¸€ä¸ªé«˜æ•ˆã€å¥å£®çš„èµ„æºç®¡ç†ç³»ç»Ÿã€‚

## ğŸ—ï¸ 1. æ¶æ„è®¾è®¡ï¼šå¤–è§‚æ¨¡å¼ï¼ˆFacadeï¼‰

ä¸ºäº†å®ç°ä¸Šè¿°ç›®æ ‡ï¼Œæˆ‘ä»¬å°†é‡‡ç”¨**å¤–è§‚æ¨¡å¼ (Facade Pattern)**ã€‚æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª`ResourceManager`ç±»ï¼Œå®ƒä½œä¸ºæ•´ä¸ªèµ„æºæ¨¡å—çš„å”¯ä¸€å…¬å…±å…¥å£ã€‚å®ƒæœ¬èº«ä¸ç›´æ¥å¤„ç†åŠ è½½é€»è¾‘ï¼Œè€Œæ˜¯å°†ä»»åŠ¡å§”æ‰˜ç»™å†…éƒ¨çš„ä¸‰ä¸ªä¸“ä¸šå­ç®¡ç†å™¨ï¼š

<img src="https://theorhythm.top/gamedev/SL/SL.026.webp" alt="ç´ æå­˜å‚¨ç®¡ç†æ¨¡å—è®¾è®¡" style="display: block; margin: auto; width: 700px;" />

### ğŸ“¦ å­ç®¡ç†å™¨åˆ†å·¥

- **`TextureManager`** - è´Ÿè´£ç®¡ç†å›¾ç‰‡çº¹ç† (`SDL_Texture`)
- **`AudioManager`** - è´Ÿè´£ç®¡ç†éŸ³æ•ˆ (`Mix_Chunk`) å’ŒèƒŒæ™¯éŸ³ä¹ (`Mix_Music`)  
- **`FontManager`** - è´Ÿè´£ç®¡ç†å­—ä½“ (`TTF_Font`)

### ğŸ’¡ è®¾è®¡ä¼˜åŠ¿

è¿™ç§è®¾è®¡çš„ä¼˜åŠ¿åœ¨äºï¼Œå®¢æˆ·ç«¯ä»£ç ï¼ˆå¦‚æœªæ¥çš„`SpriteComponent`ï¼‰åªéœ€è¦ä¸`ResourceManager`æ‰“äº¤é“ï¼Œè€Œæ— éœ€å…³å¿ƒèƒŒåå¤æ‚çš„å®ç°ç»†èŠ‚ï¼Œä»è€Œå®ç°äº†é«˜åº¦è§£è€¦ã€‚

## ğŸ“ 2. æ–°çš„é¡¹ç›®ç»“æ„

æˆ‘ä»¬å°†åœ¨`src/engine/`ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„`resource`æ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜æ”¾æ‰€æœ‰ä¸èµ„æºç®¡ç†ç›¸å…³çš„ä»£ç ã€‚

```
â””â”€â”€ src/
    â””â”€â”€ engine/
        â”œâ”€â”€ core/
        â”‚   â”œâ”€â”€ game_app.h/.cpp
        â”‚   â””â”€â”€ time.h/.cpp
        â””â”€â”€ resource/
            â”œâ”€â”€ resource_manager.h/.cpp   (å¤–è§‚)
            â”œâ”€â”€ texture_manager.h/.cpp    (çº¹ç†)
            â”œâ”€â”€ audio_manager.h/.cpp      (éŸ³é¢‘)
            â””â”€â”€ font_manager.h/.cpp       (å­—ä½“)
```

## ğŸ”§ 3. æ ¸å¿ƒæŠ€æœ¯ï¼šRAIIä¸æ™ºèƒ½æŒ‡é’ˆè‡ªå®šä¹‰åˆ é™¤å™¨

åœ¨æ‰€æœ‰å­ç®¡ç†å™¨ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªç»Ÿä¸€ä¸”å¼ºå¤§çš„C++ç‰¹æ€§æ¥è‡ªåŠ¨åŒ–å†…å­˜ç®¡ç†ï¼š`std::unique_ptr`é…åˆ**è‡ªå®šä¹‰åˆ é™¤å™¨ (Custom Deleter)**ã€‚

### ğŸ” æŠ€æœ¯åŸç†

SDLåº“æä¾›çš„èµ„æºï¼ˆå¦‚`SDL_Texture*`ï¼‰æ˜¯Cé£æ ¼çš„è£¸æŒ‡é’ˆï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨å¯¹åº”çš„é”€æ¯å‡½æ•°ï¼ˆå¦‚`SDL_DestroyTexture`ï¼‰æ¥é‡Šæ”¾ã€‚ä¸ºäº†å°†å…¶çº³å…¥C++çš„**RAIIï¼ˆèµ„æºè·å–å³åˆå§‹åŒ–ï¼‰**ä½“ç³»ï¼Œæˆ‘ä»¬è¿™æ ·åšï¼š

#### ğŸ“‹ å®ç°æ­¥éª¤

1. ä¸ºæ¯ç§SDLèµ„æºç±»å‹åˆ›å»ºä¸€ä¸ªç»“æ„ä½“ï¼Œå…¶ä¸­é‡è½½`operator()`
2. è¿™ä¸ªæ“ä½œç¬¦æ¥æ”¶ä¸€ä¸ªå¯¹åº”ç±»å‹çš„è£¸æŒ‡é’ˆï¼Œå¹¶åœ¨å†…éƒ¨è°ƒç”¨SDLçš„é”€æ¯å‡½æ•°
3. åœ¨`std::unique_ptr`çš„æ¨¡æ¿å‚æ•°ä¸­ï¼Œå°†è¿™ä¸ªåˆ é™¤å™¨ç»“æ„ä½“ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥

#### ğŸ’» ä»£ç ç¤ºä¾‹

```cpp
// ä»¥Textureä¸ºä¾‹
struct SDLTextureDeleter {
    void operator()(SDL_Texture* texture) const {
        if (texture) {
            SDL_DestroyTexture(texture);
        }
    }
};

// ä½¿ç”¨
std::unique_ptr<SDL_Texture, SDLTextureDeleter> texture_ptr(raw_sdl_texture);
```

å½“`texture_ptr`ç¦»å¼€ä½œç”¨åŸŸæˆ–è¢«`reset()`æ—¶ï¼Œå®ƒæ‰€ç®¡ç†çš„`SDL_Texture`å°±ä¼šè¢«è‡ªåŠ¨ã€å®‰å…¨åœ°é”€æ¯ã€‚

## âš™ï¸ 4. å„ä¸ªç®¡ç†å™¨çš„å®ç°

æ‰€æœ‰å­ç®¡ç†å™¨éƒ½éµå¾ªä¸€ä¸ªå…±åŒçš„è®¾è®¡æ¨¡å¼ï¼š

### ğŸ”„ é€šç”¨è®¾è®¡æ¨¡å¼

1. **ç¼“å­˜æœºåˆ¶** - å†…éƒ¨ä½¿ç”¨`std::unordered_map`ä½œä¸ºç¼“å­˜ï¼Œå°†èµ„æºçš„æ–‡ä»¶è·¯å¾„æ˜ å°„åˆ°ç®¡ç†è¯¥èµ„æºçš„`std::unique_ptr`

2. **ç»Ÿä¸€æ¥å£** - æä¾›`get...()`æ–¹æ³•ï¼Œè¯¥æ–¹æ³•é¦–å…ˆæ£€æŸ¥ç¼“å­˜ã€‚å¦‚æœèµ„æºå·²åŠ è½½ï¼Œåˆ™ç›´æ¥è¿”å›æŒ‡é’ˆï¼›å¦‚æœæœªåŠ è½½ï¼Œåˆ™è°ƒç”¨`load...()`æ–¹æ³•ä»ç¡¬ç›˜åŠ è½½ï¼Œå­˜å…¥ç¼“å­˜ï¼Œç„¶åè¿”å›æŒ‡é’ˆ

3. **ç”Ÿå‘½å‘¨æœŸç®¡ç†** - æ„é€ å‡½æ•°è´Ÿè´£åˆå§‹åŒ–å¯¹åº”çš„SDLå­ç³»ç»Ÿï¼ˆå¦‚SDL_mixer, SDL_ttfï¼‰ï¼Œå¹¶åœ¨å¤±è´¥æ—¶æŠ›å‡º`std::runtime_error`å¼‚å¸¸ã€‚ææ„å‡½æ•°è´Ÿè´£æ¸…ç†èµ„æºå¹¶å…³é—­å­ç³»ç»Ÿ

### ğŸ“¦ å…·ä½“ç®¡ç†å™¨

#### ğŸ­ ResourceManager (å¤–è§‚ç±»)
è¿™ä¸ªç±»æ˜¯æ‰€æœ‰ç®¡ç†å™¨çš„"è€æ¿"ã€‚å®ƒæŒæœ‰æŒ‡å‘å„ä¸ªå­ç®¡ç†å™¨çš„`unique_ptr`ï¼Œå¹¶å°†æ‰€æœ‰å¤–éƒ¨è¯·æ±‚ï¼ˆå¦‚`getTexture`ï¼‰è½¬å‘ç»™æ­£ç¡®çš„å°å¼Ÿã€‚

```cpp
// resource_manager.h
#pragma once
#include <memory> // ç”¨äº std::unique_ptr
#include <string> // ç”¨äº std::string
#include <glm/glm.hpp>

// å‰å‘å£°æ˜ SDL ç±»å‹
struct SDL_Renderer;
struct SDL_Texture;
struct Mix_Chunk;
struct Mix_Music;
struct TTF_Font;

namespace engine::resource {

// å‰å‘å£°æ˜å†…éƒ¨ç®¡ç†å™¨
class TextureManager;
class AudioManager;
class FontManager;

/**
 * @brief ä½œä¸ºè®¿é—®å„ç§èµ„æºç®¡ç†å™¨çš„ä¸­å¤®æ§åˆ¶ç‚¹ï¼ˆå¤–è§‚æ¨¡å¼ Facadeï¼‰ã€‚
 * åœ¨æ„é€ æ—¶åˆå§‹åŒ–å…¶ç®¡ç†çš„å­ç³»ç»Ÿã€‚æ„é€ å¤±è´¥ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚
 */
class ResourceManager final{
private:
    // ä½¿ç”¨ unique_ptr ç¡®ä¿æ‰€æœ‰æƒå’Œè‡ªåŠ¨æ¸…ç†
    std::unique_ptr<TextureManager> texture_manager_;
    std::unique_ptr<AudioManager> audio_manager_;
    std::unique_ptr<FontManager> font_manager_;

public:
    /**
     * @brief æ„é€ å‡½æ•°ï¼Œæ‰§è¡Œåˆå§‹åŒ–ã€‚
     * @param renderer SDL_Renderer çš„æŒ‡é’ˆï¼Œä¼ é€’ç»™éœ€è¦å®ƒçš„å­ç®¡ç†å™¨ã€‚ä¸èƒ½ä¸ºç©ºã€‚
     */
    explicit ResourceManager(SDL_Renderer* renderer);       // explicit å…³é”®å­—ç”¨äºé˜²æ­¢éšå¼è½¬æ¢, å¯¹äºå•ä¸€å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œé€šå¸¸è€ƒè™‘æ·»åŠ 

    ~ResourceManager();  // æ˜¾å¼å£°æ˜ææ„å‡½æ•°ï¼Œè¿™æ˜¯ä¸ºäº†èƒ½è®©æ™ºèƒ½æŒ‡é’ˆæ­£ç¡®ç®¡ç†ä»…æœ‰å‰å‘å£°æ˜çš„ç±»

    void clear();        ///< @brief æ¸…ç©ºæ‰€æœ‰èµ„æº

    // å½“å‰è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªResourceManagerï¼Œæ‰€æœ‰æƒä¸å˜ï¼Œæ‰€ä»¥ä¸éœ€è¦æ‹·è´ã€ç§»åŠ¨ç›¸å…³æ„é€ åŠèµ‹å€¼è¿ç®—ç¬¦
    ResourceManager(const ResourceManager&) = delete;
    ResourceManager& operator=(const ResourceManager&) = delete;
    ResourceManager(ResourceManager&&) = delete;
    ResourceManager& operator=(ResourceManager&&) = delete;

    // --- ç»Ÿä¸€èµ„æºè®¿é—®æ¥å£ ---
    // -- Texture --
    SDL_Texture* loadTexture(const std::string& file_path);     ///< @brief è½½å…¥çº¹ç†èµ„æº
    SDL_Texture* getTexture(const std::string& file_path);      ///< @brief å°è¯•è·å–å·²åŠ è½½çº¹ç†çš„æŒ‡é’ˆï¼Œå¦‚æœæœªåŠ è½½åˆ™å°è¯•åŠ è½½
    void unloadTexture(const std::string& file_path);          ///< @brief å¸è½½æŒ‡å®šçš„çº¹ç†èµ„æº
    glm::vec2 getTextureSize(const std::string& file_path);    ///< @brief è·å–æŒ‡å®šçº¹ç†çš„å°ºå¯¸
    void clearTextures();                                      ///< @brief æ¸…ç©ºæ‰€æœ‰çº¹ç†èµ„æº

    // -- Sound Effects (Chunks) --
    Mix_Chunk* loadSound(const std::string& file_path);         ///< @brief è½½å…¥éŸ³æ•ˆèµ„æº
    Mix_Chunk* getSound(const std::string& file_path);          ///< @brief å°è¯•è·å–å·²åŠ è½½éŸ³æ•ˆçš„æŒ‡é’ˆï¼Œå¦‚æœæœªåŠ è½½åˆ™å°è¯•åŠ è½½
    void unloadSound(const std::string& file_path);             ///< @brief å¸è½½æŒ‡å®šçš„éŸ³æ•ˆèµ„æº
    void clearSounds();                                         ///< @brief æ¸…ç©ºæ‰€æœ‰éŸ³æ•ˆèµ„æº

    // -- Music --
    Mix_Music* loadMusic(const std::string& file_path);         ///< @brief è½½å…¥éŸ³ä¹èµ„æº
    Mix_Music* getMusic(const std::string& file_path);          ///< @brief å°è¯•è·å–å·²åŠ è½½éŸ³ä¹çš„æŒ‡é’ˆï¼Œå¦‚æœæœªåŠ è½½åˆ™å°è¯•åŠ è½½
    void unloadMusic(const std::string& file_path);             ///< @brief å¸è½½æŒ‡å®šçš„éŸ³ä¹èµ„æº
    void clearMusic();                                          ///< @brief æ¸…ç©ºæ‰€æœ‰éŸ³ä¹èµ„æº

    // -- Fonts --
    TTF_Font* loadFont(const std::string& file_path, int point_size);     ///< @brief è½½å…¥å­—ä½“èµ„æº
    TTF_Font* getFont(const std::string& file_path, int point_size);      ///< @brief å°è¯•è·å–å·²åŠ è½½å­—ä½“çš„æŒ‡é’ˆï¼Œå¦‚æœæœªåŠ è½½åˆ™å°è¯•åŠ è½½
    void unloadFont(const std::string& file_path, int point_size);        ///< @brief å¸è½½æŒ‡å®šçš„å­—ä½“èµ„æº
    void clearFonts();                                                  ///< @brief æ¸…ç©ºæ‰€æœ‰å­—ä½“èµ„æº
};

} // namespace engine::resource

// resource_manager.cpp
#include "resource_manager.h"
#include "texture_manager.h"
#include "audio_manager.h"
#include "font_manager.h" 
#include <SDL3_mixer/SDL_mixer.h>
#include <SDL3_ttf/SDL_ttf.h> 
#include <glm/glm.hpp>
#include <spdlog/spdlog.h>
 
namespace engine::resource {

ResourceManager::~ResourceManager() = default;

ResourceManager::ResourceManager(SDL_Renderer* renderer) {
    // --- åˆå§‹åŒ–å„ä¸ªå­ç³»ç»Ÿ --- (å¦‚æœå‡ºç°é”™è¯¯ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œç”±ä¸Šå±‚æ•è·)
    texture_manager_ = std::make_unique<TextureManager>(renderer);
    audio_manager_ = std::make_unique<AudioManager>();
    font_manager_ = std::make_unique<FontManager>();

    spdlog::trace("ResourceManager æ„é€ æˆåŠŸã€‚");
    // RAII: æ„é€ æˆåŠŸå³ä»£è¡¨èµ„æºç®¡ç†å™¨å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œæ— éœ€å†åˆå§‹åŒ–ï¼Œæ— éœ€æ£€æŸ¥æŒ‡é’ˆæ˜¯å¦ä¸ºç©º
}

void ResourceManager::clear() {
    font_manager_->clearFonts();
    audio_manager_->clearSounds();
    texture_manager_->clearTextures();
    spdlog::trace("ResourceManager ä¸­çš„èµ„æºé€šè¿‡ clear() æ¸…ç©ºã€‚");
}

// --- çº¹ç†æ¥å£å®ç° ---
SDL_Texture* ResourceManager::loadTexture(const std::string& file_path) {
    // æ„é€ å‡½æ•°å·²ç»ç¡®ä¿äº† texture_manager_ ä¸ä¸ºç©ºï¼Œå› æ­¤ä¸éœ€è¦å†è¿›è¡Œifæ£€æŸ¥ï¼Œä»¥å…æ€§èƒ½æµªè´¹
    return texture_manager_->loadTexture(file_path);
}

SDL_Texture* ResourceManager::getTexture(const std::string& file_path) {
    return texture_manager_->getTexture(file_path);
}

glm::vec2 ResourceManager::getTextureSize(const std::string& file_path) {
    return texture_manager_->getTextureSize(file_path);
}

void ResourceManager::unloadTexture(const std::string& file_path) {
    texture_manager_->unloadTexture(file_path);
}

void ResourceManager::clearTextures() {
    texture_manager_->clearTextures();
}

// --- éŸ³é¢‘æ¥å£å®ç° ---
Mix_Chunk* ResourceManager::loadSound(const std::string& file_path) {
    return audio_manager_->loadSound(file_path);
}

Mix_Chunk* ResourceManager::getSound(const std::string& file_path) {
    return audio_manager_->getSound(file_path);
}

void ResourceManager::unloadSound(const std::string& file_path) {
    audio_manager_->unloadSound(file_path);
}

void ResourceManager::clearSounds() {
    audio_manager_->clearSounds();
}

Mix_Music* ResourceManager::loadMusic(const std::string& file_path) {
    return audio_manager_->loadMusic(file_path);
}

Mix_Music* ResourceManager::getMusic(const std::string& file_path) {
    return audio_manager_->getMusic(file_path);
}

void ResourceManager::unloadMusic(const std::string& file_path) {
    audio_manager_->unloadMusic(file_path);
}

void ResourceManager::clearMusic() {
    audio_manager_->clearMusic();
}

// --- å­—ä½“æ¥å£å®ç° ---
TTF_Font* ResourceManager::loadFont(const std::string& file_path, int point_size) {
    return font_manager_->loadFont(file_path, point_size);
}

TTF_Font* ResourceManager::getFont(const std::string& file_path, int point_size) {
    return font_manager_->getFont(file_path, point_size);
}

void ResourceManager::unloadFont(const std::string& file_path, int point_size) {
    font_manager_->unloadFont(file_path, point_size);
}

void ResourceManager::clearFonts() {
    font_manager_->clearFonts();
}

} // namespace engine::resource

```

#### ğŸ–¼ï¸ TextureManager
æœ€åŸºç¡€çš„ç®¡ç†å™¨ï¼Œè´Ÿè´£åŠ è½½`SDL_Texture`ã€‚å®ƒéœ€è¦ä¸€ä¸ª`SDL_Renderer`æŒ‡é’ˆæ¥åˆ›å»ºçº¹ç†ã€‚

```cpp
// texture_manager.h
#pragma once
#include <memory>       // ç”¨äº std::unique_ptr
#include <stdexcept>    // ç”¨äº std::runtime_error
#include <string>       // ç”¨äº std::string
#include <unordered_map> // ç”¨äº std::unordered_map
#include <SDL3/SDL_render.h> // ç”¨äº SDL_Texture å’Œ SDL_Renderer
#include <glm/glm.hpp>

namespace engine::resource {

/**
 * @brief ç®¡ç† SDL_Texture èµ„æºçš„åŠ è½½ã€å­˜å‚¨å’Œæ£€ç´¢ã€‚
 *
 * åœ¨æ„é€ æ—¶åˆå§‹åŒ–ã€‚ä½¿ç”¨æ–‡ä»¶è·¯å¾„ä½œä¸ºé”®ï¼Œç¡®ä¿çº¹ç†åªåŠ è½½ä¸€æ¬¡å¹¶æ­£ç¡®é‡Šæ”¾ã€‚
 * ä¾èµ–äºä¸€ä¸ªæœ‰æ•ˆçš„ SDL_Rendererï¼Œæ„é€ å¤±è´¥ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚
 */
class TextureManager final{
    friend class ResourceManager;

private:
    // SDL_Texture çš„åˆ é™¤å™¨å‡½æ•°å¯¹è±¡ï¼Œç”¨äºæ™ºèƒ½æŒ‡é’ˆç®¡ç†
    struct SDLTextureDeleter {
        void operator()(SDL_Texture* texture) const {
            if (texture) {
                SDL_DestroyTexture(texture);
            }
        }
    };

    // å­˜å‚¨æ–‡ä»¶è·¯å¾„å’ŒæŒ‡å‘ç®¡ç†çº¹ç†çš„ unique_ptr çš„æ˜ å°„ã€‚
    std::unordered_map<std::string, std::unique_ptr<SDL_Texture, SDLTextureDeleter>> textures_;

    SDL_Renderer* renderer_ = nullptr; // æŒ‡å‘ä¸»æ¸²æŸ“å™¨çš„éæ‹¥æœ‰æŒ‡é’ˆ

public:
    /**
     * @brief æ„é€ å‡½æ•°ï¼Œæ‰§è¡Œåˆå§‹åŒ–ã€‚
     * @param renderer æŒ‡å‘æœ‰æ•ˆçš„ SDL_Renderer ä¸Šä¸‹æ–‡çš„æŒ‡é’ˆã€‚ä¸èƒ½ä¸ºç©ºã€‚
     * @throws std::runtime_error å¦‚æœ renderer ä¸º nullptr æˆ–åˆå§‹åŒ–å¤±è´¥ã€‚
     */
    explicit TextureManager(SDL_Renderer* renderer);

    // å½“å‰è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªTextureManagerï¼Œæ‰€æœ‰æƒä¸å˜ï¼Œæ‰€ä»¥ä¸éœ€è¦æ‹·è´ã€ç§»åŠ¨ç›¸å…³æ„é€ åŠèµ‹å€¼è¿ç®—ç¬¦
    TextureManager(const TextureManager&) = delete;
    TextureManager& operator=(const TextureManager&) = delete;
    TextureManager(TextureManager&&) = delete;
    TextureManager& operator=(TextureManager&&) = delete;

private: // ä»…ä¾› ResourceManager è®¿é—®çš„æ–¹æ³•

    SDL_Texture* loadTexture(const std::string& file_path);      ///< @brief ä»æ–‡ä»¶è·¯å¾„åŠ è½½çº¹ç†
    SDL_Texture* getTexture(const std::string& file_path);       ///< @brief å°è¯•è·å–å·²åŠ è½½çº¹ç†çš„æŒ‡é’ˆï¼Œå¦‚æœæœªåŠ è½½åˆ™å°è¯•åŠ è½½
    glm::vec2 getTextureSize(const std::string& file_path);      ///< @brief è·å–æŒ‡å®šçº¹ç†çš„å°ºå¯¸
    void unloadTexture(const std::string& file_path);            ///< @brief å¸è½½æŒ‡å®šçš„çº¹ç†èµ„æº
    void clearTextures();                                        ///< @brief æ¸…ç©ºæ‰€æœ‰çº¹ç†èµ„æº
};

} // namespace engine::resource

// texture_manager.cpp
#include "texture_manager.h"
#include <SDL3_image/SDL_image.h> // ç”¨äº IMG_LoadTexture, IMG_Init, IMG_Quit
#include <spdlog/spdlog.h>
#include <stdexcept>

namespace engine::resource {
TextureManager::TextureManager(SDL_Renderer* renderer) : renderer_(renderer) {
    if (!renderer_) {
        // å…³é”®é”™è¯¯ï¼Œæ— æ³•ç»§ç»­ï¼ŒæŠ›å‡ºå¼‚å¸¸ ï¼ˆå®ƒå°†ç”±catchè¯­å¥æ•è·ï¼ˆä½äºGameAppï¼‰ï¼Œå¹¶è¿›è¡Œå¤„ç†ï¼‰
        throw std::runtime_error("TextureManager æ„é€ å¤±è´¥: æ¸²æŸ“å™¨æŒ‡é’ˆä¸ºç©ºã€‚");
    }
    // SDL3ä¸­ä¸å†éœ€è¦æ‰‹åŠ¨è°ƒç”¨IMG_Init/IMG_Quit
    spdlog::trace("TextureManager æ„é€ æˆåŠŸã€‚");
}

SDL_Texture* TextureManager::loadTexture(const std::string& file_path) {
    // æ£€æŸ¥æ˜¯å¦å·²åŠ è½½
    auto it = textures_.find(file_path);
    if (it != textures_.end()) {
        return it->second.get();
    }

    // å¦‚æœæ²¡åŠ è½½åˆ™å°è¯•åŠ è½½çº¹ç†
    SDL_Texture* raw_texture = IMG_LoadTexture(renderer_, file_path.c_str());

    if (!raw_texture) {
        spdlog::error("åŠ è½½çº¹ç†å¤±è´¥: '{}': {}", file_path, SDL_GetError());
        return nullptr;
    }

    // ä½¿ç”¨å¸¦æœ‰è‡ªå®šä¹‰åˆ é™¤å™¨çš„ unique_ptr å­˜å‚¨åŠ è½½çš„çº¹ç†
    textures_.emplace(file_path, std::unique_ptr<SDL_Texture, SDLTextureDeleter>(raw_texture));
    spdlog::debug("æˆåŠŸåŠ è½½å¹¶ç¼“å­˜çº¹ç†: {}", file_path);

    return raw_texture;
}

SDL_Texture* TextureManager::getTexture(const std::string& file_path) {
    // æŸ¥æ‰¾ç°æœ‰çº¹ç†
    auto it = textures_.find(file_path);
    if (it != textures_.end()) {
        return it->second.get();
    }

    // å¦‚æœæœªæ‰¾åˆ°ï¼Œå°è¯•åŠ è½½å®ƒ
    spdlog::warn("çº¹ç† '{}' æœªæ‰¾åˆ°ç¼“å­˜ï¼Œå°è¯•åŠ è½½ã€‚", file_path);
    return loadTexture(file_path);
}

glm::vec2 TextureManager::getTextureSize(const std::string& file_path) {
    // è·å–çº¹ç†
    SDL_Texture* texture = getTexture(file_path);
    if (!texture) {
        spdlog::error("æ— æ³•è·å–çº¹ç†: {}", file_path);
        return glm::vec2(0);
    }

    // è·å–çº¹ç†å°ºå¯¸
    glm::vec2 size;
    if (!SDL_GetTextureSize(texture, &size.x, &size.y)) {
        spdlog::error("æ— æ³•æŸ¥è¯¢çº¹ç†å°ºå¯¸: {}", file_path);
        return glm::vec2(0);
    }
    return size;
}

void TextureManager::unloadTexture(const std::string& file_path) {
    auto it = textures_.find(file_path);
    if (it != textures_.end()) {
        spdlog::debug("å¸è½½çº¹ç†: {}", file_path);
        textures_.erase(it); // unique_ptr é€šè¿‡è‡ªå®šä¹‰åˆ é™¤å™¨å¤„ç†åˆ é™¤
    } else {
        spdlog::warn("å°è¯•å¸è½½ä¸å­˜åœ¨çš„çº¹ç†: {}", file_path);
    }
}

void TextureManager::clearTextures() {
    if (!textures_.empty()) {
        spdlog::debug("æ­£åœ¨æ¸…é™¤æ‰€æœ‰ {} ä¸ªç¼“å­˜çš„çº¹ç†ã€‚", textures_.size());
        textures_.clear(); // unique_ptr å¤„ç†æ‰€æœ‰å…ƒç´ çš„åˆ é™¤
    }
}

} // namespace engine::resource

```

#### ğŸ”Š AudioManager
è´Ÿè´£åˆå§‹åŒ–SDL_mixerï¼Œå¹¶åˆ†åˆ«ç®¡ç†`Mix_Chunk`ï¼ˆçŸ­éŸ³æ•ˆï¼‰å’Œ`Mix_Music`ï¼ˆé•¿éŸ³ä¹ï¼‰ä¸¤ç§èµ„æºã€‚

```cpp
// audio_manager.h
#pragma once
#include <memory>       // ç”¨äº std::unique_ptr
#include <stdexcept>    // ç”¨äº std::runtime_error
#include <string>       // ç”¨äº std::string
#include <unordered_map> // ç”¨äº std::unordered_map

#include <SDL3_mixer/SDL_mixer.h> // SDL_mixer ä¸»å¤´æ–‡ä»¶

namespace engine::resource {

/**
 * @brief ç®¡ç† SDL_mixer éŸ³æ•ˆ (Mix_Chunk) å’ŒéŸ³ä¹ (Mix_Music)ã€‚
 *
 * æä¾›éŸ³é¢‘èµ„æºçš„åŠ è½½å’Œç¼“å­˜åŠŸèƒ½ã€‚æ„é€ å¤±è´¥æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚
 * ä»…ä¾› ResourceManager å†…éƒ¨ä½¿ç”¨ã€‚
 */
class AudioManager final{
    friend class ResourceManager;

private:
    // Mix_Chunk çš„è‡ªå®šä¹‰åˆ é™¤å™¨
    struct SDLMixChunkDeleter {
        void operator()(Mix_Chunk* chunk) const {
            if (chunk) {
                Mix_FreeChunk(chunk);
            }
        }
    };

    // Mix_Music çš„è‡ªå®šä¹‰åˆ é™¤å™¨
    struct SDLMixMusicDeleter {
        void operator()(Mix_Music* music) const {
            if (music) {
                Mix_FreeMusic(music);
            }
        }
    };

    // éŸ³æ•ˆå­˜å‚¨ (æ–‡ä»¶è·¯å¾„ -> Mix_Chunk)
    std::unordered_map<std::string, std::unique_ptr<Mix_Chunk, SDLMixChunkDeleter>> sounds_;
    // éŸ³ä¹å­˜å‚¨ (æ–‡ä»¶è·¯å¾„ -> Mix_Music)
    std::unordered_map<std::string, std::unique_ptr<Mix_Music, SDLMixMusicDeleter>> music_;

public:
    /**
     * @brief æ„é€ å‡½æ•°ã€‚åˆå§‹åŒ– SDL_mixer å¹¶æ‰“å¼€éŸ³é¢‘è®¾å¤‡ã€‚
     * @throws std::runtime_error å¦‚æœ SDL_mixer åˆå§‹åŒ–æˆ–æ‰“å¼€éŸ³é¢‘è®¾å¤‡å¤±è´¥ã€‚
     */
    AudioManager();

    ~AudioManager();            ///< @brief éœ€è¦æ‰‹åŠ¨æ·»åŠ ææ„å‡½æ•°ï¼Œæ¸…ç†èµ„æºå¹¶å…³é—­ SDL_mixerã€‚

    // å½“å‰è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªAudioManagerï¼Œæ‰€æœ‰æƒä¸å˜ï¼Œæ‰€ä»¥ä¸éœ€è¦æ‹·è´ã€ç§»åŠ¨ç›¸å…³æ„é€ åŠèµ‹å€¼è¿ç®—ç¬¦
    AudioManager(const AudioManager&) = delete;
    AudioManager& operator=(const AudioManager&) = delete;
    AudioManager(AudioManager&&) = delete;
    AudioManager& operator=(AudioManager&&) = delete;

private:  // ä»…ä¾› ResourceManager è®¿é—®çš„æ–¹æ³•

    Mix_Chunk* loadSound(const std::string& file_path);     ///< @brief ä»æ–‡ä»¶è·¯å¾„åŠ è½½éŸ³æ•ˆ
    Mix_Chunk* getSound(const std::string& file_path);      ///< @brief å°è¯•è·å–å·²åŠ è½½éŸ³æ•ˆçš„æŒ‡é’ˆï¼Œå¦‚æœæœªåŠ è½½åˆ™å°è¯•åŠ è½½
    void unloadSound(const std::string& file_path);         ///< @brief å¸è½½æŒ‡å®šçš„éŸ³æ•ˆèµ„æº
    void clearSounds();                                      ///< @brief æ¸…ç©ºæ‰€æœ‰éŸ³æ•ˆèµ„æº

    Mix_Music* loadMusic(const std::string& file_path);     ///< @brief ä»æ–‡ä»¶è·¯å¾„åŠ è½½éŸ³ä¹
    Mix_Music* getMusic(const std::string& file_path);      ///< @brief å°è¯•è·å–å·²åŠ è½½éŸ³ä¹çš„æŒ‡é’ˆï¼Œå¦‚æœæœªåŠ è½½åˆ™å°è¯•åŠ è½½
    void unloadMusic(const std::string& file_path);         ///< @brief å¸è½½æŒ‡å®šçš„éŸ³ä¹èµ„æº
    void clearMusic();                                      ///< @brief æ¸…ç©ºæ‰€æœ‰éŸ³ä¹èµ„æº

    void clearAudio();                                      ///< @brief æ¸…ç©ºæ‰€æœ‰éŸ³é¢‘èµ„æº
};

} // namespace engine::resource

// audio_manager.cpp
#include "audio_manager.h"
#include <spdlog/spdlog.h>
#include <stdexcept>

namespace engine::resource {

// æ„é€ å‡½æ•°ï¼šåˆå§‹åŒ–SDL_mixer
AudioManager::AudioManager() {
    // ä½¿ç”¨æ‰€éœ€çš„æ ¼å¼åˆå§‹åŒ–SDL_mixerï¼ˆæ¨èOGGã€MP3ï¼‰
    MIX_InitFlags flags = MIX_INIT_OGG | MIX_INIT_MP3;
    if ((Mix_Init(flags) & flags) != flags) {
        throw std::runtime_error("AudioManager é”™è¯¯: Mix_Init å¤±è´¥: " + std::string(SDL_GetError()));
    }

    // SDL3æ‰“å¼€éŸ³é¢‘è®¾å¤‡çš„æ–¹æ³•ã€‚é»˜è®¤å€¼ï¼š44100 Hzï¼Œé»˜è®¤æ ¼å¼ï¼Œ2å£°é“ï¼ˆç«‹ä½“å£°ï¼‰ï¼Œ2048é‡‡æ ·å—å¤§å°
    if (!Mix_OpenAudio(0, nullptr)) {
        Mix_Quit(); // å¦‚æœOpenAudioå¤±è´¥ï¼Œå…ˆæ¸…ç†Mix_Initï¼Œå†æŠ›å‡ºå¼‚å¸¸
        throw std::runtime_error("AudioManager é”™è¯¯: Mix_OpenAudio å¤±è´¥: " + std::string(SDL_GetError()));
    }
    spdlog::trace("AudioManager æ„é€ æˆåŠŸã€‚");
}

AudioManager::~AudioManager()
{
    // ç«‹å³åœæ­¢æ‰€æœ‰éŸ³é¢‘æ’­æ”¾
    Mix_HaltChannel(-1); // åœæ­¢æ‰€æœ‰éŸ³æ•ˆ
    Mix_HaltMusic();     // åœæ­¢éŸ³ä¹

    // æ¸…ç†èµ„æºæ˜ å°„ï¼ˆunique_ptrsä¼šè°ƒç”¨åˆ é™¤å™¨ï¼‰
    clearSounds();
    clearMusic();

    // å…³é—­éŸ³é¢‘è®¾å¤‡
    Mix_CloseAudio();

    // é€€å‡ºSDL_mixerå­ç³»ç»Ÿ
    Mix_Quit();
    spdlog::trace("AudioManager ææ„æˆåŠŸã€‚");
}

// --- éŸ³æ•ˆç®¡ç† ---
Mix_Chunk* AudioManager::loadSound(const std::string& file_path) {
    // é¦–å…ˆæ£€æŸ¥ç¼“å­˜
    auto it = sounds_.find(file_path);
    if (it != sounds_.end()) {
        return it->second.get();
    }

    // åŠ è½½éŸ³æ•ˆå—
    spdlog::debug("åŠ è½½éŸ³æ•ˆ: {}", file_path);
    Mix_Chunk* raw_chunk = Mix_LoadWAV(file_path.c_str());
    if (!raw_chunk) {
        spdlog::error("åŠ è½½éŸ³æ•ˆå¤±è´¥: '{}': {}", file_path, SDL_GetError());
        return nullptr;
    }

    // ä½¿ç”¨unique_ptrå­˜å‚¨åœ¨ç¼“å­˜ä¸­
    sounds_.emplace(file_path, std::unique_ptr<Mix_Chunk, SDLMixChunkDeleter>(raw_chunk));
    spdlog::debug("æˆåŠŸåŠ è½½å¹¶ç¼“å­˜éŸ³æ•ˆ: {}", file_path);
    return raw_chunk;
}

Mix_Chunk* AudioManager::getSound(const std::string& file_path) {
    auto it = sounds_.find(file_path);
    if (it != sounds_.end()) {
        return it->second.get();
    }
    spdlog::warn("éŸ³æ•ˆ '{}' æœªæ‰¾åˆ°ç¼“å­˜ï¼Œå°è¯•åŠ è½½ã€‚", file_path);
    return loadSound(file_path);
}

void AudioManager::unloadSound(const std::string& file_path) {
    auto it = sounds_.find(file_path);
    if (it != sounds_.end()) {
        spdlog::debug("å¸è½½éŸ³æ•ˆ: {}", file_path);
        sounds_.erase(it);      // unique_ptrå¤„ç†Mix_FreeChunk
    } else {
        spdlog::warn("å°è¯•å¸è½½ä¸å­˜åœ¨çš„éŸ³æ•ˆ: {}", file_path);
    }
}

void AudioManager::clearSounds() {
    if (!sounds_.empty()) {
        spdlog::debug("æ­£åœ¨æ¸…é™¤æ‰€æœ‰ {} ä¸ªç¼“å­˜çš„éŸ³æ•ˆã€‚", sounds_.size());
        sounds_.clear(); // unique_ptrå¤„ç†åˆ é™¤
    }
}

// --- éŸ³ä¹ç®¡ç† ---
Mix_Music* AudioManager::loadMusic(const std::string& file_path) {
    // é¦–å…ˆæ£€æŸ¥ç¼“å­˜
    auto it = music_.find(file_path);
    if (it != music_.end()) {
        return it->second.get();
    }

    // åŠ è½½éŸ³ä¹
    spdlog::debug("åŠ è½½éŸ³ä¹: {}", file_path);
    Mix_Music* raw_music = Mix_LoadMUS(file_path.c_str());
    if (!raw_music) {
        spdlog::error("åŠ è½½éŸ³ä¹å¤±è´¥: '{}': {}", file_path, SDL_GetError());
        return nullptr;
    }

    // ä½¿ç”¨unique_ptrå­˜å‚¨åœ¨ç¼“å­˜ä¸­
    music_.emplace(file_path, std::unique_ptr<Mix_Music, SDLMixMusicDeleter>(raw_music));
    spdlog::debug("æˆåŠŸåŠ è½½å¹¶ç¼“å­˜éŸ³ä¹: {}", file_path);
    return raw_music;
}

Mix_Music* AudioManager::getMusic(const std::string& file_path) {
    auto it = music_.find(file_path);
    if (it != music_.end()) {
        return it->second.get();
    }
    spdlog::warn("éŸ³ä¹ '{}' æœªæ‰¾åˆ°ç¼“å­˜ï¼Œå°è¯•åŠ è½½ã€‚", file_path);
    return loadMusic(file_path);
}

void AudioManager::unloadMusic(const std::string& file_path) {
    auto it = music_.find(file_path);
    if (it != music_.end()) {
        spdlog::debug("å¸è½½éŸ³ä¹: {}", file_path);
        music_.erase(it); // unique_ptrå¤„ç†Mix_FreeMusic
    } else {
        spdlog::warn("å°è¯•å¸è½½ä¸å­˜åœ¨çš„éŸ³ä¹: {}", file_path);
    }
}

void AudioManager::clearMusic() {
    if (!music_.empty()) {
        spdlog::debug("æ­£åœ¨æ¸…é™¤æ‰€æœ‰ {} ä¸ªç¼“å­˜çš„éŸ³ä¹æ›²ç›®ã€‚", music_.size());
        music_.clear(); // unique_ptrå¤„ç†åˆ é™¤
    }
}

void AudioManager::clearAudio()
{
    clearSounds();
    clearMusic();
}

} // namespace engine::resource

```

#### ğŸ”¤ FontManager
è´Ÿè´£åˆå§‹åŒ–SDL_ttfã€‚å®ƒçš„ç¼“å­˜é”®ï¼ˆ`FontKey`ï¼‰æ¯”è¾ƒç‰¹æ®Šï¼Œæ˜¯ä¸€ä¸ª`std::pair<std::string, int>`ï¼Œå› ä¸ºåŒä¸€ä¸ªå­—ä½“æ–‡ä»¶å¯ä»¥ä»¥ä¸åŒçš„å­—å·åŠ è½½ï¼Œå®ƒä»¬æ˜¯ä¸åŒçš„èµ„æºã€‚ç”±äº`std::unordered_map`ä¸çŸ¥é“å¦‚ä½•å“ˆå¸Œä¸€ä¸ª`std::pair`ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æä¾›ä¸€ä¸ªè‡ªå®šä¹‰çš„å“ˆå¸Œå‡½æ•°`FontKeyHash`ã€‚ä¸ªé«˜æ•ˆã€å¥å£®çš„èµ„æºç®¡ç†ç³»ç»Ÿã€‚

```cpp
// font_manager.h
#pragma once
#include <memory>       // ç”¨äº std::unique_ptr
#include <stdexcept>    // ç”¨äº std::runtime_error
#include <string>       // ç”¨äº std::string
#include <unordered_map> // ç”¨äº std::unordered_map
#include <utility>      // ç”¨äº std::pair
#include <functional>   // ç”¨äº std::hash

#include <SDL3_ttf/SDL_ttf.h> // SDL_ttf ä¸»å¤´æ–‡ä»¶

namespace engine::resource {

// å®šä¹‰å­—ä½“é”®ç±»å‹ï¼ˆè·¯å¾„ + å¤§å°ï¼‰
using FontKey = std::pair<std::string, int>;        // std::pair æ˜¯æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªç±»æ¨¡æ¿ï¼Œç”¨äºå°†ä¸¤ä¸ªå€¼ç»„åˆæˆä¸€ä¸ªå•å…ƒ

// FontKey çš„è‡ªå®šä¹‰å“ˆå¸Œå‡½æ•°ï¼ˆstd::pair<std::string, int>ï¼‰ï¼Œç”¨äº std::unordered_map
struct FontKeyHash {
    std::size_t operator()(const FontKey& key) const {
        std::hash<std::string> string_hasher;
        std::hash<int> int_hasher;
        return string_hasher(key.first) ^ int_hasher(key.second);       // å¼‚æˆ–è¿ç®—ç¬¦ ^ æŒ‰ä½è®¡ç®—ï¼Œæ¯ä¸€ä½çš„ä¸¤ä¸ªå€¼ä¸åŒä¸º1ï¼Œç›¸åŒä¸º0ï¼Œè¿™æ˜¯åˆå¹¶ä¸¤ä¸ªå“ˆå¸Œå€¼çš„ç®€å•æ–¹æ³•
    }
};

/**
 * @brief ç®¡ç† SDL_ttf å­—ä½“èµ„æºï¼ˆTTF_Fontï¼‰ã€‚
 *
 * æä¾›å­—ä½“çš„åŠ è½½å’Œç¼“å­˜åŠŸèƒ½ï¼Œé€šè¿‡æ–‡ä»¶è·¯å¾„å’Œç‚¹å¤§å°æ¥æ ‡è¯†ã€‚
 * æ„é€ å¤±è´¥ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ä»…ä¾› ResourceManager å†…éƒ¨ä½¿ç”¨ã€‚
 */
class FontManager final{
    friend class ResourceManager;

private:
    // TTF_Font çš„è‡ªå®šä¹‰åˆ é™¤å™¨
    struct SDLFontDeleter {
        void operator()(TTF_Font* font) const {
            if (font) {
                TTF_CloseFont(font);
            }
        }
    };

    // å­—ä½“å­˜å‚¨ï¼ˆFontKey -> TTF_Fontï¼‰ã€‚  
    // unordered_map çš„é”®éœ€è¦èƒ½è½¬æ¢ä¸ºå“ˆå¸Œå€¼ï¼Œå¯¹äºåŸºç¡€æ•°æ®ç±»å‹ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è½¬æ¢
    // ä½†æ˜¯å¯¹äºå¯¹äºè‡ªå®šä¹‰ç±»å‹ï¼ˆç³»ç»Ÿæ— æ³•è‡ªåŠ¨è½¬åŒ–ï¼‰ï¼Œåˆ™éœ€è¦æä¾›è‡ªå®šä¹‰å“ˆå¸Œå‡½æ•°ï¼ˆç¬¬ä¸‰ä¸ªæ¨¡ç‰ˆå‚æ•°ï¼‰
    std::unordered_map<FontKey, std::unique_ptr<TTF_Font, SDLFontDeleter>, FontKeyHash> fonts_;

public:
    /**
     * @brief æ„é€ å‡½æ•°ã€‚åˆå§‹åŒ– SDL_ttfã€‚
     * @throws std::runtime_error å¦‚æœ SDL_ttf åˆå§‹åŒ–å¤±è´¥ã€‚
     */
    FontManager();
    
    ~FontManager();            ///< @brief éœ€è¦æ‰‹åŠ¨æ·»åŠ ææ„å‡½æ•°ï¼Œæ¸…ç†èµ„æºå¹¶å…³é—­ SDL_ttfã€‚

    // å½“å‰è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªFontManagerï¼Œæ‰€æœ‰æƒä¸å˜ï¼Œæ‰€ä»¥ä¸éœ€è¦æ‹·è´ã€ç§»åŠ¨ç›¸å…³æ„é€ åŠèµ‹å€¼è¿ç®—ç¬¦
    FontManager(const FontManager&) = delete;
    FontManager& operator=(const FontManager&) = delete;
    FontManager(FontManager&&) = delete;
    FontManager& operator=(FontManager&&) = delete;

private: // ä»…ç”± ResourceManagerï¼ˆå’Œå†…éƒ¨ï¼‰è®¿é—®çš„æ–¹æ³•

    TTF_Font* loadFont(const std::string& file_path, int point_size);     ///< @brief ä»æ–‡ä»¶è·¯å¾„åŠ è½½æŒ‡å®šç‚¹å¤§å°çš„å­—ä½“
    TTF_Font* getFont(const std::string& file_path, int point_size);      ///< @brief å°è¯•è·å–å·²åŠ è½½å­—ä½“çš„æŒ‡é’ˆï¼Œå¦‚æœæœªåŠ è½½åˆ™å°è¯•åŠ è½½
    void unloadFont(const std::string& file_path, int point_size);        ///< @brief å¸è½½ç‰¹å®šå­—ä½“ï¼ˆé€šè¿‡è·¯å¾„å’Œå¤§å°æ ‡è¯†ï¼‰
    void clearFonts();                                                    ///< @brief æ¸…ç©ºæ‰€æœ‰ç¼“å­˜çš„å­—ä½“
};

} // namespace engine::resource

// font_manager.cpp
#include "font_manager.h"
#include <spdlog/spdlog.h>
#include <stdexcept>

namespace engine::resource {

FontManager::FontManager() {
    if (!TTF_WasInit() && !TTF_Init()) {
        throw std::runtime_error("FontManager é”™è¯¯: TTF_Init å¤±è´¥ï¼š" + std::string(SDL_GetError()));
    }
    spdlog::trace("FontManager æ„é€ æˆåŠŸã€‚");
}

FontManager::~FontManager() {
    if (!fonts_.empty()) {
        spdlog::debug("FontManager ä¸ä¸ºç©ºï¼Œè°ƒç”¨ clearFonts å¤„ç†æ¸…ç†é€»è¾‘ã€‚");
        clearFonts();       // è°ƒç”¨ clearFonts å¤„ç†æ¸…ç†é€»è¾‘
    }
    TTF_Quit();
    spdlog::trace("FontManager ææ„æˆåŠŸã€‚");
}

TTF_Font* FontManager::loadFont(const std::string& file_path, int point_size) {
    // æ£€æŸ¥ç‚¹å¤§å°æ˜¯å¦æœ‰æ•ˆ
    if (point_size <= 0) {
        spdlog::error("æ— æ³•åŠ è½½å­—ä½“ '{}'ï¼šæ— æ•ˆçš„ç‚¹å¤§å° {}ã€‚", file_path, point_size);
        return nullptr;
    }

    // åˆ›å»ºæ˜ å°„è¡¨çš„é”®
    FontKey key = {file_path, point_size};

    // é¦–å…ˆæ£€æŸ¥ç¼“å­˜
    auto it = fonts_.find(key);
    if (it != fonts_.end()) {
        return it->second.get();
    }

    // ç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼Œåˆ™åŠ è½½å­—ä½“
    spdlog::debug("æ­£åœ¨åŠ è½½å­—ä½“ï¼š{} ({}pt)", file_path, point_size);
    TTF_Font* raw_font = TTF_OpenFont(file_path.c_str(), point_size);
    if (!raw_font) {
        spdlog::error("åŠ è½½å­—ä½“ '{}' ({}pt) å¤±è´¥ï¼š{}", file_path, point_size, SDL_GetError());
        return nullptr;
    }

    // ä½¿ç”¨ unique_ptr å­˜å‚¨åˆ°ç¼“å­˜ä¸­
    fonts_.emplace(key, std::unique_ptr<TTF_Font, SDLFontDeleter>(raw_font));
    spdlog::debug("æˆåŠŸåŠ è½½å¹¶ç¼“å­˜å­—ä½“ï¼š{} ({}pt)", file_path, point_size);
    return raw_font;
}

TTF_Font* FontManager::getFont(const std::string& file_path, int point_size) {
    FontKey key = {file_path, point_size};
    auto it = fonts_.find(key);
    if (it != fonts_.end()) {
        return it->second.get();
    }

    spdlog::warn("å­—ä½“ '{}' ({}pt) ä¸åœ¨ç¼“å­˜ä¸­ï¼Œå°è¯•åŠ è½½ã€‚", file_path, point_size);
    return loadFont(file_path, point_size);
}

void FontManager::unloadFont(const std::string& file_path, int point_size) {
    FontKey key = {file_path, point_size};
    auto it = fonts_.find(key);
    if (it != fonts_.end()) {
        spdlog::debug("å¸è½½å­—ä½“ï¼š{} ({}pt)", file_path, point_size);
        fonts_.erase(it);       // unique_ptr ä¼šå¤„ç† TTF_CloseFont
    } else {
        spdlog::warn("å°è¯•å¸è½½ä¸å­˜åœ¨çš„å­—ä½“ï¼š{} ({}pt)", file_path, point_size);
    }
}

void FontManager::clearFonts() {
    if (!fonts_.empty()) {
        spdlog::debug("æ­£åœ¨æ¸…ç†æ‰€æœ‰ {} ä¸ªç¼“å­˜çš„å­—ä½“ã€‚", fonts_.size());
        fonts_.clear();         // unique_ptr ä¼šå¤„ç†åˆ é™¤
    }
}

} // namespace engine::resource
```

## ğŸ”Œ 5. é›†æˆåˆ°GameApp

ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªå…¨æ–°çš„èµ„æºæ¨¡å—é›†æˆåˆ°æˆ‘ä»¬çš„ä¸»åº”ç”¨`GameApp`ä¸­ã€‚

```cpp
// game_app.h
// ...
namespace engine::resource {
class ResourceManager;
}

class GameApp final {   // final è¡¨ç¤ºè¯¥ç±»ä¸èƒ½è¢«ç»§æ‰¿
    // ...

    std::unique_ptr<engine::resource::ResourceManager> resource_manager_;

private:
    // ...

    // å„æ¨¡å—çš„åˆå§‹åŒ–/åˆ›å»ºå‡½æ•°ï¼Œåœ¨init()ä¸­è°ƒç”¨
    bool initSDL();
    bool initTime();
    bool initResourceManager();

    // æµ‹è¯•ç”¨å‡½æ•°
    void testResourceManager();
};

// game_app.cpp
// ...

bool GameApp::init() {
    spdlog::trace("åˆå§‹åŒ– GameApp ...");
    if (!initSDL())  return false;
    if (!initTime()) return false;
    if (!initResourceManager()) return false;

    // æµ‹è¯•èµ„æºç®¡ç†å™¨
    testResourceManager();

    is_running_ = true;
    spdlog::trace("GameApp åˆå§‹åŒ–æˆåŠŸã€‚");
    return true;
}

// ...

void GameApp::close() {
    spdlog::trace("å…³é—­ GameApp ...");

    // ä¸ºäº†ç¡®ä¿æ­£ç¡®çš„é”€æ¯é¡ºåºï¼Œæœ‰äº›æ™ºèƒ½æŒ‡é’ˆå¯¹è±¡ä¹Ÿéœ€è¦æ‰‹åŠ¨ç®¡ç†
    resource_manager_.reset();

    // SDLç›¸å…³æ¸…ç†...
}

// ...

bool GameApp::initSDL() {
    if (!SDL_Init(SDL_INIT_VIDEO | SDL_INIT_AUDIO)) {
        spdlog::error("SDL åˆå§‹åŒ–å¤±è´¥! SDLé”™è¯¯: {}", SDL_GetError());
        return false;
    }

    window_ = SDL_CreateWindow("SunnyLand", 1280, 720, SDL_WINDOW_RESIZABLE);
    if (window_ == nullptr) {
        spdlog::error("æ— æ³•åˆ›å»ºçª—å£! SDLé”™è¯¯: {}", SDL_GetError());
        return false;
    }

    sdl_renderer_ = SDL_CreateRenderer(window_, nullptr);
    if (sdl_renderer_ == nullptr) {
        spdlog::error("æ— æ³•åˆ›å»ºæ¸²æŸ“å™¨! SDLé”™è¯¯: {}", SDL_GetError());
        return false;
    }
    spdlog::trace("SDL åˆå§‹åŒ–æˆåŠŸã€‚");
    return true;
}

bool GameApp::initTime() {
    try {
        time_ = std::make_unique<Time>();
    } catch (const std::exception& e) {
        spdlog::error("åˆå§‹åŒ–æ—¶é—´ç®¡ç†å¤±è´¥: {}", e.what());
        return false;
    }
    spdlog::trace("æ—¶é—´ç®¡ç†åˆå§‹åŒ–æˆåŠŸã€‚");
    return true;
}

bool GameApp::initResourceManager() {
    try {
        resource_manager_ = std::make_unique<engine::resource::ResourceManager>(sdl_renderer_);
    } catch (const std::exception& e) {
        spdlog::error("åˆå§‹åŒ–èµ„æºç®¡ç†å™¨å¤±è´¥: {}", e.what());
        return false;
    }
    spdlog::trace("èµ„æºç®¡ç†å™¨åˆå§‹åŒ–æˆåŠŸã€‚");
    return true;
}

void GameApp::testResourceManager()
{
    resource_manager_->getTexture("assets/textures/Actors/eagle-attack.png");
    resource_manager_->getFont("assets/fonts/VonwaonBitmap-16px.ttf", 16);
    resource_manager_->getSound("assets/audio/button_click.wav");

    resource_manager_->unloadTexture("assets/textures/Actors/eagle-attack.png");
    resource_manager_->unloadFont("assets/fonts/VonwaonBitmap-16px.ttf", 16);
    resource_manager_->unloadSound("assets/audio/button_click.wav");
}
```

### ğŸ”„ é‡æ„init()
åŸæ¥çš„`init()`å‡½æ•°å˜å¾—è‡ƒè‚¿ã€‚æˆ‘ä»¬å°†å…¶æ‹†åˆ†ä¸º`initSDL()`, `initTime()`, `initResourceManager()`ç­‰å¤šä¸ªç‹¬ç«‹çš„åˆå§‹åŒ–å‡½æ•°ï¼Œä½¿é€»è¾‘æ›´æ¸…æ™°ã€‚

### ğŸ—ï¸ åˆ›å»ºResourceManagerå®ä¾‹
åœ¨`GameApp`ä¸­å¢åŠ ä¸€ä¸ª`std::unique_ptr<ResourceManager>`æˆå‘˜ï¼Œå¹¶åœ¨`initResourceManager()`ä¸­åˆ›å»ºå®ƒçš„å®ä¾‹ã€‚åˆ›å»ºè¿‡ç¨‹è¢«åŒ…è£¹åœ¨`try-catch`å—ä¸­ï¼Œä»¥æ•è·ä»»ä½•å¯èƒ½åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­æŠ›å‡ºçš„å¼‚å¸¸ã€‚

### ğŸ—‘ï¸ ç¡®ä¿æ­£ç¡®çš„é”€æ¯é¡ºåº
åœ¨`GameApp::close()`ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨å…³é—­SDLå­ç³»ç»Ÿä¹‹å‰å…ˆé”€æ¯èµ„æºç®¡ç†å™¨ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ‰‹åŠ¨è°ƒç”¨`resource_manager_.reset()`æ¥ç¡®ä¿æ‰€æœ‰`unique_ptr`ç®¡ç†çš„èµ„æºï¼ˆçº¹ç†ã€éŸ³é¢‘ç­‰ï¼‰è¢«æ­£ç¡®é‡Šæ”¾ã€‚

### ğŸ§ª æ·»åŠ æµ‹è¯•ä»£ç 
æˆ‘ä»¬åœ¨`GameApp`ä¸­æ·»åŠ äº†ä¸€ä¸ª`testResourceManager()`å‡½æ•°ï¼Œå¹¶åœ¨åˆå§‹åŒ–æˆåŠŸåè°ƒç”¨å®ƒã€‚è¿™ä¸ªå‡½æ•°ä¼šå°è¯•åŠ è½½å’Œå¸è½½å„ç§ç±»å‹çš„èµ„æºï¼Œä»¥éªŒè¯æˆ‘ä»¬çš„æ–°æ¨¡å—æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚

## ğŸ”¨ 6. ç¼–è¯‘ä¸æµ‹è¯•

### ğŸ“‹ ç¼–è¯‘å‰å‡†å¤‡

åœ¨ç¼–è¯‘ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ å·²ç»ï¼š

1. **æ›´æ–°CMakeLists.txt** - å°†æ‰€æœ‰æ–°çš„`.cpp`æ–‡ä»¶æ·»åŠ åˆ°äº†`CMakeLists.txt`ä¸­

```cmake
# æ·»åŠ å¯æ‰§è¡Œæ–‡ä»¶
add_executable(${TARGET} 
                src/main.cpp
                src/engine/core/game_app.cpp
                src/engine/core/time.cpp
                src/engine/resource/resource_manager.cpp
                src/engine/resource/texture_manager.cpp
                src/engine/resource/audio_manager.cpp
                src/engine/resource/font_manager.cpp
                )
```

2. **å‡†å¤‡èµ„æºæ–‡ä»¶** - åœ¨ä½ çš„é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºäº†`assets`æ–‡ä»¶å¤¹ï¼Œå¹¶åŒ…å«ä»¥ä¸‹å­ç›®å½•å’Œç›¸åº”çš„èµ„æºæ–‡ä»¶ï¼Œä»¥ä¾›`testResourceManager()`å‡½æ•°ä½¿ç”¨ï¼š

```
assets/
â”œâ”€â”€ textures/
â”‚   â””â”€â”€ Actors/
â”‚       â””â”€â”€ eagle-attack.png
â”œâ”€â”€ fonts/
â”‚   â””â”€â”€ VonwaonBitmap-16px.ttf
â””â”€â”€ audio/
    â””â”€â”€ button_click.wav
```

> ğŸ’¡ **æç¤º**ï¼šè¿™äº›èµ„æºå¯ä»¥ä»è¯¾ç¨‹çš„èµ„æºåŒ…ä¸­æ‰¾åˆ°

### ğŸš€ è¿è¡Œæµ‹è¯•

ç°åœ¨ï¼Œç¼–è¯‘å¹¶è¿è¡Œä½ çš„ç¨‹åºã€‚æ‰“å¼€æ§åˆ¶å°ï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ°æ¥è‡ª`spdlog`çš„è¯¦ç»†æ—¥å¿—ï¼Œæ˜¾ç¤ºï¼š

- âœ… å„ä¸ªç®¡ç†å™¨çš„æ„é€ 
- ğŸ“ èµ„æºçš„åŠ è½½å’Œå¸è½½ä¿¡æ¯  
- ğŸ—‘ï¸ å„ä¸ªç®¡ç†å™¨çš„ææ„ä¿¡æ¯

è¿™è¡¨æ˜æˆ‘ä»¬çš„èµ„æºç®¡ç†ç³»ç»Ÿå·²ç»æˆåŠŸè¿è¡Œèµ·æ¥äº†ï¼

### ğŸ‰ æˆæœ

æ­å–œï¼ä½ å·²ç»æˆåŠŸæ„å»ºäº†ä¸€ä¸ªå®Œæ•´çš„èµ„æºç®¡ç†æ¨¡å—ã€‚è¿™ä¸ªæ¨¡å—å°†æˆä¸ºæˆ‘ä»¬æ¸¸æˆå¼•æ“çš„é‡è¦åŸºç¡€è®¾æ–½ï¼Œä¸ºåç»­çš„å›¾å½¢æ¸²æŸ“ã€éŸ³é¢‘æ’­æ”¾ç­‰åŠŸèƒ½æä¾›å¼ºæœ‰åŠ›çš„æ”¯æŒã€‚