# ç”Ÿå‘½ç»„ä»¶ä¸æ­»ä¼¤çŠ¶æ€

<div class="video-container">
  <div id="bilibili" class="video-content">
    <!-- Bç«™åµŒå…¥ï¼šä½¿ç”¨ https æ˜ç¡®åè®®ï¼ˆé¿å… file:// æˆ– http å¯¼è‡´è¢«æµè§ˆå™¨æ‹¦æˆªï¼‰ -->
    <iframe
      class="video-frame"
      src="https://player.bilibili.com/player.html?bvid=BV1Qo8fzVEc3&page=1&autoplay=0&danmaku=0&high_quality=1"
      width="100%"
      height="480"
      scrolling="no"
      frameborder="0"
      allowfullscreen>
    </iframe>
  </div>
</div>

[åœ¨ Bilibili ä¸Šè§‚çœ‹](https://www.bilibili.com/video/BV1Qo8fzVEc3)

## ğŸ“Œ é—®é¢˜èƒŒæ™¯

æˆ‘ä»¬å·²ç»å®ç°äº†å®Œæ•´çš„åŠ¨ç”»ç³»ç»Ÿï¼Œè§’è‰²å¯ä»¥æµç•…åœ°æ’­æ”¾å„ç§åŠ¨ç”»ã€‚ä½†ç›®å‰æ¸¸æˆä¸­çš„è§’è‰²éƒ½æ˜¯"ä¸æ­»ä¹‹èº«"â€”â€”æ— è®ºç©å®¶è¿˜æ˜¯æ•Œäººï¼Œéƒ½æ²¡æœ‰ç”Ÿå‘½å€¼ç³»ç»Ÿï¼Œä¹Ÿæ— æ³•å—ä¼¤æˆ–æ­»äº¡ã€‚

### âš ï¸ å½“å‰çš„é—®é¢˜

```
ç¼ºå°‘ç”Ÿå‘½ç³»ç»Ÿï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ‘¤ ç©å®¶               â”‚
â”‚    â†“ ç¢°åˆ°æ•Œäºº           â”‚
â”‚   ğŸ¸ æ•Œäºº               â”‚
â”‚                          â”‚
â”‚ âŒ æ²¡æœ‰ä¼¤å®³åˆ¤å®š          â”‚
â”‚ âŒ æ— æ³•å—ä¼¤æˆ–æ­»äº¡        â”‚
â”‚ âŒ ç¼ºå°‘æ¸¸æˆæŒ‘æˆ˜æ€§        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| é—®é¢˜ | è¯´æ˜ | å½±å“ |
|------|------|------|
| **æ— ä¼¤å®³ç³»ç»Ÿ** | è§’è‰²æ— æ³•å—ä¼¤ | æ²¡æœ‰æŒ‘æˆ˜æ€§ |
| **æ— ç”Ÿå‘½å€¼** | æ— æ³•åˆ¤æ–­å­˜æ´»çŠ¶æ€ | ç¼ºå°‘æ ¸å¿ƒç©æ³• |
| **æ— çŠ¶æ€åé¦ˆ** | å—ä¼¤æ— åé¦ˆ | ä½“éªŒä¸ä½³ |
| **æ•°æ®ç¡¬ç¼–ç ** | ç”Ÿå‘½å€¼å†™åœ¨ä»£ç ä¸­ | éš¾ä»¥è°ƒæ•´å¹³è¡¡æ€§ |

### ğŸ’¡ è§£å†³æ–¹æ¡ˆï¼šé€šç”¨ç”Ÿå‘½ç³»ç»Ÿ

**æ ¸å¿ƒæ€æƒ³**ï¼š
1. åˆ›å»ºé€šç”¨çš„ `HealthComponent` ç»„ä»¶
2. åœ¨ Tiled ä¸­å®šä¹‰åˆå§‹ç”Ÿå‘½å€¼
3. æ·»åŠ å—ä¼¤ï¼ˆHurtï¼‰å’Œæ­»äº¡ï¼ˆDeadï¼‰çŠ¶æ€
4. å®ç°æ— æ•Œå¸§æœºåˆ¶

```
ç”Ÿå‘½ç³»ç»Ÿæ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tiled ç¼–è¾‘å™¨ â”‚ â† å®šä¹‰ health å±æ€§
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LevelLoader  â”‚ â† è‡ªåŠ¨æ·»åŠ  HealthComponent
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HealthComponent  â”‚ â† ç®¡ç†ç”Ÿå‘½å€¼å’Œæ— æ•Œå¸§
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PlayerComponent  â”‚ â† æ ¹æ®ç”Ÿå‘½å€¼åˆ‡æ¢çŠ¶æ€
â”‚   â”œâ”€ HurtState   â”‚
â”‚   â””â”€ DeadState   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ¯ æœ¬è¯¾ç›®æ ‡

| ç›®æ ‡ | è¯´æ˜ |
|------|------|
| **æ„å»ºé€šç”¨ HealthComponent** | å¯å¤ç”¨çš„ç”Ÿå‘½ç»„ä»¶ï¼Œç®¡ç†ç”Ÿå‘½å€¼å’Œæ— æ•Œå¸§ |
| **æ•°æ®é©±åŠ¨ç”Ÿå‘½å€¼** | åœ¨ Tiled ä¸­è®¾ç½®åˆå§‹ç”Ÿå‘½å€¼ |
| **å®ç°å—ä¼¤çŠ¶æ€** | å‡»é€€ã€ç¡¬ç›´ï¼ˆStunï¼‰ã€å—ä¼¤åŠ¨ç”» |
| **å®ç°æ­»äº¡çŠ¶æ€** | æ­»äº¡åŠ¨ç”»ã€ç¦ç”¨ç¢°æ’ã€æ‰å‡ºå±å¹• |
| **è¿æ¥ä¼¤å®³ä¸çŠ¶æ€** | ä¼¤å®³äº‹ä»¶è§¦å‘çŠ¶æ€åˆ‡æ¢ |

---

## 1. å¼•æ“æ ¸å¿ƒï¼šé€šç”¨çš„ HealthComponent

ç”Ÿå‘½å€¼æ˜¯å‡ ä¹æ‰€æœ‰æ¸¸æˆä¸­éƒ½å­˜åœ¨çš„æ¦‚å¿µã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸åº”è¯¥åªä¸ºç©å®¶å•ç‹¬å®ç°ä¸€å¥—ç”Ÿå‘½é€»è¾‘ï¼Œè€Œæ˜¯åº”è¯¥åœ¨ **å¼•æ“å±‚** åˆ›å»ºä¸€ä¸ªé€šç”¨çš„ `HealthComponent`ï¼Œå®ƒå¯ä»¥è¢«é™„åŠ åˆ°ä»»ä½•éœ€è¦ç”Ÿå‘½å€¼çš„å¯¹è±¡ä¸Šï¼ˆç©å®¶ã€æ•Œäººã€å¯ç ´åçš„ç®±å­ç­‰ï¼‰ã€‚

### ğŸ’¡ è®¾è®¡æ€æƒ³

```
é€šç”¨ç»„ä»¶è®¾è®¡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HealthComponent  â”‚ â† å¼•æ“å±‚é€šç”¨ç»„ä»¶
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - max_health_    â”‚
â”‚ - current_health_â”‚
â”‚ - is_invincible_ â”‚
â”‚ - invincibility_ â”‚
â”‚   timer_         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“ å¯è¢«ä»»ä½•å¯¹è±¡ä½¿ç”¨
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚ç©å®¶ â”‚æ•Œäºº  â”‚ç®±å­  â”‚NPC   â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | è¯´æ˜ | ç”¨é€” |
|------|------|------|
| **ç”Ÿå‘½å€¼ç®¡ç†** | å½“å‰å€¼å’Œæœ€å¤§å€¼ | åˆ¤æ–­å­˜æ´»çŠ¶æ€ |
| **å—ä¼¤å¤„ç†** | `takeDamage()` | æ‰£é™¤ç”Ÿå‘½å€¼ |
| **æ²»ç–—å¤„ç†** | `heal()` | æ¢å¤ç”Ÿå‘½å€¼ |
| **æ— æ•Œå¸§** | å—ä¼¤åçŸ­æ—¶é—´æ— æ•Œ | é˜²æ­¢è¿ç»­å—ä¼¤ |

---

### src/engine/component/health_component.hï¼ˆæ–°å»ºæ–‡ä»¶ï¼‰

```cpp
#pragma once
#include "../../engine/component/component.h"

namespace engine::component {

/**
 * @brief ç®¡ç† GameObject çš„ç”Ÿå‘½å€¼ï¼Œå¤„ç†ä¼¤å®³ã€æ²»ç–—ï¼Œå¹¶æä¾›æ— æ•Œå¸§åŠŸèƒ½ã€‚
 */
class HealthComponent final : public engine::component::Component {
    friend class engine::object::GameObject;
private:
    int max_health_ = 1;
    int current_health_ = 1;
    bool is_invincible_ = false;            ///< @brief æ˜¯å¦å¤„äºæ— æ•ŒçŠ¶æ€
    float invincibility_duration_ = 2.0f;   ///< @brief å—ä¼¤åæ— æ•Œçš„æ€»æ—¶é•¿ï¼ˆç§’ï¼‰
    float invincibility_timer_ = 0.0f;      ///< @brief æ— æ•Œæ—¶é—´è®¡æ—¶å™¨ï¼ˆç§’ï¼‰

public:
    explicit HealthComponent(int max_health = 1, float invincibility_duration = 2.0f);
    ~HealthComponent() override = default;

    /**
     * @brief å¯¹ GameObject æ–½åŠ ä¼¤å®³ã€‚
     * @param damage_amount é€ æˆçš„ä¼¤å®³é‡ï¼ˆåº”ä¸ºæ­£æ•°ï¼‰ã€‚
     * @return bool å¦‚æœæˆåŠŸé€ æˆä¼¤å®³ï¼Œåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚
     */
    bool takeDamage(int damage_amount);
    void heal(int heal_amount);

    // --- Getters and Setters ---
    bool isAlive() const { return current_health_ > 0; }
    // ... å…¶ä»– Getters å’Œ Setters ...

protected:
    void update(float, engine::core::Context&) override;
};

} // namespace engine::component
```

### src/engine/component/health_component.cppï¼ˆæ–°å»ºæ–‡ä»¶ï¼‰

```cpp
#include "health_component.h"
#include "../../engine/object/game_object.h"
#include <spdlog/spdlog.h>
#include <glm/common.hpp>

namespace engine::component {

// ... æ„é€ å‡½æ•° ...

void HealthComponent::update(float delta_time, engine::core::Context&) {
    // æ›´æ–°æ— æ•ŒçŠ¶æ€è®¡æ—¶å™¨
    if (is_invincible_) {
        invincibility_timer_ -= delta_time;
        if (invincibility_timer_ <= 0.0f) {
            is_invincible_ = false;
            invincibility_timer_ = 0.0f;
        }
    }
}

bool HealthComponent::takeDamage(int damage_amount) {
    if (damage_amount <= 0 || !isAlive() || is_invincible_) {
        return false; // ä¸é€ æˆä¼¤å®³ã€å·²æ­»äº¡æˆ–å¤„äºæ— æ•ŒçŠ¶æ€
    }

    // --- ç¡®å®é€ æˆä¼¤å®³äº† ---
    current_health_ -= damage_amount;
    current_health_ = glm::max(0, current_health_); // é˜²æ­¢ç”Ÿå‘½å€¼å˜ä¸ºè´Ÿæ•°
    
    // å¦‚æœå—ä¼¤ä½†æ²¡æ­»ï¼Œå¹¶ä¸”è®¾ç½®äº†æ— æ•Œæ—¶é—´ï¼Œåˆ™è§¦å‘æ— æ•Œ
    if (isAlive() && invincibility_duration_ > 0.0f) {
        setInvincible(invincibility_duration_);
    }
    
    spdlog::debug("æ¸¸æˆå¯¹è±¡ '{}' å—åˆ°äº† {} ç‚¹ä¼¤å®³ï¼Œå½“å‰ç”Ÿå‘½å€¼: {}/{}ã€‚",
                  owner_ ? owner_->getName() : "Unknown", damage_amount, current_health_, max_health_);
    return true;        // é€ æˆä¼¤å®³ï¼Œè¿”å›true
}

// ... heal() å’Œå…¶ä»– setter å‡½æ•°çš„å®ç° ...

void HealthComponent::setInvincible(float duration)
{
    if (duration > 0.0f) {
        is_invincible_ = true;
        invincibility_timer_ = duration;
    }
}
} // namespace engine::component
```

### ç»„ä»¶è®¾è®¡è¯¦è§£

#### æ ¸å¿ƒæˆå‘˜å˜é‡

| æˆå‘˜å˜é‡ | ç±»å‹ | è¯´æ˜ |
|---------|------|------|
| `max_health_` | `int` | æœ€å¤§ç”Ÿå‘½å€¼ |
| `current_health_` | `int` | å½“å‰ç”Ÿå‘½å€¼ |
| `is_invincible_` | `bool` | æ˜¯å¦å¤„äºæ— æ•ŒçŠ¶æ€ |
| `invincibility_duration_` | `float` | æ— æ•Œæ€»æ—¶é•¿ï¼ˆç§’ï¼‰ |
| `invincibility_timer_` | `float` | æ— æ•Œå‰©ä½™æ—¶é—´ï¼ˆç§’ï¼‰ |

#### takeDamage() æµç¨‹

<img src="https://theorhythm.top/gamedev/SL/SL.070.webp" alt="ç”Ÿå‘½ç»„ä»¶" style="display: block; margin: auto; width: 700px;" />

```
takeDamage() æ‰§è¡Œæµç¨‹ï¼š
    â†“
1. æ£€æŸ¥ä¼¤å®³å€¼æ˜¯å¦æœ‰æ•ˆ (> 0)
    â†“
2. æ£€æŸ¥æ˜¯å¦å·²æ­»äº¡ (!isAlive())
    â†“
3. æ£€æŸ¥æ˜¯å¦æ— æ•Œ (is_invincible_)
    â†“ ä»¥ä¸Šéƒ½é€šè¿‡
4. æ‰£é™¤ç”Ÿå‘½å€¼
    current_health_ -= damage_amount
    â†“
5. é˜²æ­¢è´Ÿæ•°
    current_health_ = max(0, current_health_)
    â†“
6. å¦‚æœè¿˜æ´»ç€ï¼Œè§¦å‘æ— æ•Œå¸§
    setInvincible(duration)
    â†“
7. è®°å½•æ—¥å¿—
    â†“
8. è¿”å› trueï¼ˆæˆåŠŸé€ æˆä¼¤å®³ï¼‰
```

#### æ— æ•Œå¸§æœºåˆ¶

```
æ— æ•Œå¸§å·¥ä½œåŸç†ï¼š
æ—¶é—´è½´ï¼š
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
å—ä¼¤    æ— æ•ŒæœŸï¼ˆ2ç§’ï¼‰      å¯å†æ¬¡å—ä¼¤
 â†“      â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’         â†“
 ğŸ’¥     ğŸ›¡ï¸ğŸ›¡ï¸ğŸ›¡ï¸ğŸ›¡ï¸          ğŸ’¥
 
æ¯å¸§ update():
invincibility_timer_ -= delta_time
å½“ timer <= 0 æ—¶ï¼Œis_invincible_ = false
```

### è®¾è®¡ä¼˜åŠ¿

| ç‰¹æ€§ | è¯´æ˜ | ä¼˜åŠ¿ |
|------|------|------|
| **é€šç”¨æ€§** | ä¸ä¾èµ–å…·ä½“å¯¹è±¡ç±»å‹ | å¯ç”¨äºä»»ä½•éœ€è¦ç”Ÿå‘½çš„å¯¹è±¡ |
| **æ•°æ®å°è£…** | åªç®¡ç†æ•°å€¼å’Œé€»è¾‘ | ä¸æ¶‰åŠè¡¨ç°ï¼ˆéŸ³æ•ˆã€ç‰¹æ•ˆï¼‰ |
| **æ— æ•Œå¸§** | é˜²æ­¢è¿ç»­ä¼¤å®³ | å¹³å°æ¸¸æˆå¿…å¤‡æœºåˆ¶ |
| **å®‰å…¨æ£€æŸ¥** | å¤šé‡æ¡ä»¶åˆ¤æ–­ | é˜²æ­¢å¼‚å¸¸ä¼¤å®³ |

---

## 2. æ•°æ®é©±åŠ¨ç”Ÿå‘½å€¼

å’ŒåŠ¨ç”»ä¸€æ ·ï¼Œæˆ‘ä»¬æŠŠç”Ÿå‘½å€¼çš„è®¾å®šä¹Ÿäº¤ç»™ Tiled ç¼–è¾‘å™¨ã€‚æˆ‘ä»¬å†æ¬¡æ‰“å¼€ `assets/maps/actor.tsj` å›¾å—é›†æ–‡ä»¶ï¼Œä¸ºç©å®¶å’Œæ‰€æœ‰æ•Œäººæ·»åŠ ä¸€ä¸ªåä¸º `health` çš„è‡ªå®šä¹‰å±æ€§ï¼Œç±»å‹ä¸ºæ•´æ•°ã€‚

### Tiled å±æ€§è®¾ç½®

#### assets/maps/actor.tsjï¼ˆä¸ºç©å®¶ player_sheet æ·»åŠ çš„å±æ€§ï¼‰

```json
{
 "name":"health",
 "type":"int",
 "value":3
}
```

### è§’è‰²ç”Ÿå‘½å€¼é…ç½®

| è§’è‰² | ç”Ÿå‘½å€¼ | è¯´æ˜ |
|------|--------|------|
| **ç©å®¶ï¼ˆplayerï¼‰** | 3 | å¯æ‰¿å—3æ¬¡ä¼¤å®³ |
| **é’è›™ï¼ˆfrogï¼‰** | 1 | ä¸€å‡»å³æ­» |
| **è€é¹°ï¼ˆeagleï¼‰** | 1 | ä¸€å‡»å³æ­» |
| **è´Ÿé¼ ï¼ˆopossumï¼‰** | 1 | ä¸€å‡»å³æ­» |

### ğŸ’¡ æ•°æ®é©±åŠ¨çš„ä¼˜åŠ¿

```
é…ç½®ç”Ÿå‘½å€¼ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tiled ç¼–è¾‘å™¨        â”‚
â”‚ player: health=3    â”‚
â”‚ frog: health=1      â”‚
â”‚ eagle: health=2     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ å¿«é€Ÿè°ƒæ•´å¹³è¡¡æ€§
          â†“
    æ— éœ€é‡æ–°ç¼–è¯‘
```

---

### LevelLoader å‡çº§

æ¥ç€ï¼Œæˆ‘ä»¬å‡çº§ `LevelLoader`ï¼Œè®©å®ƒèƒ½å¤Ÿè¯»å–è¿™ä¸ªå±æ€§å¹¶è‡ªåŠ¨æ·»åŠ  `HealthComponent`ã€‚

#### src/engine/scene/level_loader.cppï¼ˆæ›´æ–°ï¼‰

```cpp
void LevelLoader::loadObjectLayer(const nlohmann::json& layer_json, Scene& scene)
{
    // ...
    // éå†å¯¹è±¡æ•°æ®
    for (const auto& object : objects) {
        // è·å–å¯¹è±¡gid
        auto gid = object.value("gid", 0);
        if (gid == 0) {  // å¦‚æœgidä¸º0 (å³ä¸å­˜åœ¨)ï¼Œåˆ™ä»£è¡¨è‡ªå·±ç»˜åˆ¶çš„å½¢çŠ¶ï¼ˆå¯èƒ½æ˜¯ç¢°æ’ç›’ã€è§¦å‘å™¨ç­‰ï¼Œæœªæ¥æŒ‰éœ€å¤„ç†ï¼‰
            // TODO

        } else {        // å¦‚æœgidå­˜åœ¨ï¼Œåˆ™æŒ‰ç…§å›¾ç‰‡è§£ææµç¨‹
            // ...
            // è·å–åŠ¨ç”»ä¿¡æ¯å¹¶è®¾ç½® ...

            // è·å–ç”Ÿå‘½å€¼ä¿¡æ¯å¹¶è®¾ç½®
            auto health = getTileProperty<int>(tile_json, "health");
            if (health) {
                // æ·»åŠ  HealthComponent
                game_object->addComponent<engine::component::HealthComponent>(health.value());
            }

            // æ·»åŠ åˆ°åœºæ™¯ä¸­ ...
        }
    }
}
```

### è‡ªåŠ¨é…ç½®æµç¨‹

```
LevelLoader å¤„ç†ç”Ÿå‘½å€¼ï¼š
    â†“
1. è¯»å–å¯¹è±¡çš„ gid
    â†“
2. è·å–å¯¹åº”çš„ tile_json
    â†“
3. è°ƒç”¨ getTileProperty<int>("health")
    â†“
4. å¦‚æœå­˜åœ¨ health å±æ€§
    â†“
5. addComponent<HealthComponent>(health.value())
    â†“
6. ç»„ä»¶è‡ªåŠ¨é…ç½®å®Œæˆ
```

ç°åœ¨ï¼Œ`LevelLoader` åœ¨åˆ›å»ºæ¸¸æˆå¯¹è±¡æ—¶ï¼Œä¼š **è‡ªåŠ¨æ£€æŸ¥** å¹¶ä¸ºå…¶é™„åŠ ä¸€ä¸ªé…ç½®å¥½æœ€å¤§ç”Ÿå‘½å€¼çš„ `HealthComponent`ã€‚

---

## 3. ç©å®¶æ–°çŠ¶æ€ï¼šå—ä¼¤ä¸æ­»äº¡

å½“ç©å®¶å—åˆ°ä¼¤å®³æ—¶ï¼Œä»…ä»…æ‰£ç‚¹è¡€æ˜¯ä¸å¤Ÿçš„ï¼Œè¿˜éœ€è¦æœ‰ç›¸åº”çš„åé¦ˆï¼š
- ğŸ’¥ è¢«å‡»é€€
- â¸ï¸ çŸ­æ—¶é—´å†…æ— æ³•æ“ä½œï¼ˆç¡¬ç›´ï¼‰
- ğŸ¬ æ’­æ”¾å—ä¼¤åŠ¨ç”»

è¿™æ­£æ˜¯ **çŠ¶æ€æœºå¤§æ˜¾èº«æ‰‹** çš„æ—¶å€™ã€‚

### çŠ¶æ€è½¬æ¢å›¾

```
çŠ¶æ€æœºæ‰©å±•ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Idle   â”‚
â”‚  Walk   â”‚ â† ä¹‹å‰å·²æœ‰çš„çŠ¶æ€
â”‚  Jump   â”‚
â”‚  Fall   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ å—åˆ°ä¼¤å®³
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hurt   â”‚ â† æ–°å¢ï¼šå—ä¼¤çŠ¶æ€
â”‚         â”‚    - å‡»é€€
â”‚         â”‚    - ç¡¬ç›´
â”‚         â”‚    - æ— æ³•æ“ä½œ
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ ç”Ÿå‘½è€—å°½
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dead   â”‚ â† æ–°å¢ï¼šæ­»äº¡çŠ¶æ€
â”‚         â”‚    - ç¦ç”¨ç¢°æ’
â”‚         â”‚    - æ‰å‡ºå±å¹•
â”‚         â”‚    - ç»ˆç»“çŠ¶æ€
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3.1 å—ä¼¤çŠ¶æ€ HurtState

è¿™ä¸ªçŠ¶æ€æ¨¡æ‹Ÿäº†ç©å®¶è¢«æ”»å‡»åçš„çŸ­æš‚å¤±æ§ã€‚

#### src/game/component/state/hurt_state.hï¼ˆæ–°å»ºæ–‡ä»¶ï¼‰

```cpp
#pragma once
#include "player_state.h"

namespace game::component::state {

class HurtState final : public PlayerState {
    friend class game::component::PlayerComponent;
private:
    float stunned_timer_ = 0.0f;  ///< @brief ç¡¬ç›´è®¡æ—¶å™¨ï¼Œå•ä½ä¸ºç§’
    
public:
    HurtState(PlayerComponent* player_component) : PlayerState(player_component) {}
    // ...
private:
    void enter() override;
    void exit() override;
    std::unique_ptr<PlayerState> handleInput(engine::core::Context&) override;
    std::unique_ptr<PlayerState> update(float delta_time, engine::core::Context&) override;
};

} // namespace game::component::state
```

#### src/game/component/state/hurt_state.cppï¼ˆæ–°å»ºæ–‡ä»¶ï¼‰

```cpp
#include "hurt_state.h"
#include "idle_state.h"
#include "fall_state.h"
#include "../player_component.h"
// ...

namespace game::component::state {

void HurtState::enter() {
    playAnimation("hurt");  // æ’­æ”¾å—ä¼¤åŠ¨ç”»
    // --- é€ æˆå‡»é€€æ•ˆæœ ---
    auto physics_component = player_component_->getPhysicsComponent();
    auto sprite_component = player_component_->getSpriteComponent();
    auto knockback_velocity = glm::vec2(-100.0f, -150.0f); // é»˜è®¤å·¦ä¸Šæ–¹å‡»é€€
    // æ ¹æ®å½“å‰ç²¾çµçš„æœå‘çŠ¶æ€å†³å®šæ˜¯å¦æ”¹æˆå³ä¸Šæ–¹
    if (sprite_component->isFlipped()) {
        knockback_velocity.x = -knockback_velocity.x;  // å˜æˆå‘å³
    }
    physics_component->velocity_ = knockback_velocity;
}

std::unique_ptr<PlayerState> HurtState::handleInput(engine::core::Context&){
    // ç¡¬ç›´æœŸä¸èƒ½è¿›è¡Œä»»ä½•æ“æ§
    return nullptr;
}

std::unique_ptr<PlayerState> HurtState::update(float delta_time, engine::core::Context&){
    stunned_timer_ += delta_time;
    // --- ä¸¤ç§æƒ…å†µç¦»å¼€å—ä¼¤ï¼ˆç¡¬ç›´ï¼‰çŠ¶æ€ï¼š---
    // 1. è½åœ°
    auto physics_component = player_component_->getPhysicsComponent();
    if (physics_component->hasCollidedBelow()) {
        return std::make_unique<IdleState>(player_component_);
    }
    // 2. ç¡¬ç›´æ—¶é—´ç»“æŸ (èƒ½èµ°åˆ°è¿™é‡Œè¯´æ˜æ²¡æœ‰è½åœ°ï¼Œç›´æ¥åˆ‡æ¢åˆ° FallState)
    if (stunned_timer_ > player_component_->getStunnedDuration()){
        return std::make_unique<FallState>(player_component_);
    }
    return nullptr;
}
}
```

### HurtState é€»è¾‘è¯¦è§£

| é˜¶æ®µ | æ“ä½œ | è¯´æ˜ |
|------|------|------|
| **enter()** | æ’­æ”¾ `"hurt"` åŠ¨ç”» | è§†è§‰åé¦ˆ |
| | è®¡ç®—å‡»é€€æ–¹å‘ | æ ¹æ®æœå‘å†³å®š |
| | è®¾ç½®å‡»é€€é€Ÿåº¦ | æ–œå‘ä¸Šå¼¹å¼€ |
| **handleInput()** | è¿”å› `nullptr` | **ç¡¬ç›´æœŸæ— æ³•æ“ä½œ** |
| **update()** | ç´¯åŠ ç¡¬ç›´è®¡æ—¶å™¨ | è®°å½•ç¡¬ç›´æ—¶é—´ |
| | æ£€æŸ¥æ˜¯å¦è½åœ° | è½åœ° â†’ `IdleState` |
| | æ£€æŸ¥ç¡¬ç›´æ˜¯å¦ç»“æŸ | è¶…æ—¶ â†’ `FallState` |

### å‡»é€€æ•ˆæœ

```
å‡»é€€æ–¹å‘è®¡ç®—ï¼š
ç©å®¶æœå‘å³ï¼š
    å‡»é€€ = (-100, -150)  â† å‘å·¦ä¸Š
    
ç©å®¶æœå‘å·¦ï¼š
    isFlipped() = true
    å‡»é€€ = (100, -150)   â† å‘å³ä¸Š

æ•ˆæœå›¾ï¼š
     â†–ï¸ å‡»é€€
    ğŸ‘¤
   ğŸ¸ æ•Œäºº
```

### ç¡¬ç›´æœºåˆ¶

```
ç¡¬ç›´ï¼ˆStunï¼‰æ—¶é—´è½´ï¼š
å—ä¼¤
 â†“
0.0s â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º 0.4s
 â”‚    ç¡¬ç›´æœŸ       â”‚
 â”‚  æ— æ³•æ“ä½œ       â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    æ¢å¤æ§åˆ¶
```

### é€€å‡ºæ¡ä»¶

| æ¡ä»¶ | ä¼˜å…ˆçº§ | åˆ‡æ¢åˆ° | è¯´æ˜ |
|------|--------|--------|------|
| **è½åœ°** | é«˜ | `IdleState` | ç«‹å³æ¢å¤ç«™ç«‹ |
| **è¶…æ—¶** | ä½ | `FallState` | åœ¨ç©ºä¸­ç»§ç»­ä¸‹è½ |

---

### 3.2 æ­»äº¡çŠ¶æ€ DeadState

è¿™æ˜¯ä¸€ä¸ª **ç»ˆç»“çŠ¶æ€**ï¼Œä¸€æ—¦è¿›å…¥ï¼Œç©å®¶å°±å½»åº•å¤±å»æ§åˆ¶ã€‚

#### src/game/component/state/dead_state.cppï¼ˆæ–°å»ºæ–‡ä»¶ï¼‰

```cpp
#include "dead_state.h"
#include "../player_component.h"
#include "../../../engine/object/game_object.h"
#include "../../../engine/component/collider_component.h"
//...

namespace game::component::state {

void DeadState::enter() {
    spdlog::debug("ç©å®¶è¿›å…¥æ­»äº¡çŠ¶æ€ã€‚");
    playAnimation("hurt");  // æ’­æ”¾æ­»äº¡(å—ä¼¤)åŠ¨ç”»

    // åº”ç”¨å‡»é€€åŠ›ï¼ˆåªå‘ä¸Šï¼‰
    auto physics_component = player_component_->getPhysicsComponent();
    physics_component->velocity_ = glm::vec2(0.0f, -200.0f);  // å‘ä¸Šå¼¹èµ·

    // ç¦ç”¨ç¢°æ’(ä½¿å…¶å¯ä»¥æ‰å‡ºå±å¹•)
    auto collider_component = player_component_->getOwner()->getComponent<engine::component::ColliderComponent>();
    if (collider_component) {
        collider_component->setActive(false);
    }
}
//...
std::unique_ptr<PlayerState> DeadState::handleInput(engine::core::Context&){
    // æ­»äº¡çŠ¶æ€ä¸‹ä¸å¤„ç†è¾“å…¥
    return nullptr;
}

std::unique_ptr<PlayerState> DeadState::update(float, engine::core::Context&){
    // æ­»äº¡çŠ¶æ€ä¸‹ä¸æ›´æ–°çŠ¶æ€
    return nullptr;
}
}
```

### DeadState é€»è¾‘è¯¦è§£

| é˜¶æ®µ | æ“ä½œ | è¯´æ˜ |
|------|------|------|
| **enter()** | æ’­æ”¾æ­»äº¡åŠ¨ç”» | è§†è§‰åé¦ˆ |
| | å‘ä¸Šå¼¹è·³ | `velocity = (0, -200)` |
| | **ç¦ç”¨ç¢°æ’å™¨** | `setActive(false)` |
| **handleInput()** | è¿”å› `nullptr` | æ— æ³•æ“ä½œ |
| **update()** | è¿”å› `nullptr` | **ç»ˆç»“çŠ¶æ€** |

### æ­»äº¡æ•ˆæœ

```
æ­»äº¡åŠ¨ç”»æ•ˆæœï¼š
    â†‘ å¼¹èµ·
   ğŸ‘¤
  â”€â”€â”€â”€â”€â”€ åœ°é¢
   
   â†“ é‡åŠ›
  ğŸ‘¤
  â”€â”€â”€â”€â”€â”€ ç©¿è¿‡ï¼ˆç¢°æ’å·²ç¦ç”¨ï¼‰
   
   â†“ ç»§ç»­ä¸‹è½
  
  ğŸ‘¤
  â”€â”€â”€â”€â”€â”€
   â†“
   æ‰å‡ºå±å¹•
```

### ğŸ’¡ å…³é”®è®¾è®¡ï¼šç¦ç”¨ç¢°æ’

**ä¸ºä»€ä¹ˆç¦ç”¨ç¢°æ’ï¼Ÿ**
- è®©ç©å®¶å¯ä»¥ç©¿è¿‡åœ°é¢
- è‡ªç„¶åœ°æ‰å‡ºå±å¹•
- è¥é€ "å¤±è´¥"çš„æ„Ÿè§‰

---

### ç‰©ç†å¼•æ“é€‚é…

ä¸ºäº†è®©"ç¦ç”¨ç¢°æ’å™¨"åè§’è‰²èƒ½æ­£å¸¸æ‰å‡ºå±å¹•ï¼Œæˆ‘ä»¬å¯¹ç‰©ç†å¼•æ“åšä¸€ä¸ªå¾®å°çš„è°ƒæ•´ï¼š

#### src/engine/physics/physics_engine.cppï¼ˆæ›´æ–°ï¼‰

```cpp
void PhysicsEngine::resolveTileCollisions(engine::component::PhysicsComponent* pc, float delta_time) {
    // æ£€æŸ¥ç»„ä»¶æ˜¯å¦æœ‰æ•ˆ
    auto* obj = pc->getOwner();
    if (!obj) return;
    auto* tc = obj->getComponent<engine::component::TransformComponent>();
    auto* cc = obj->getComponent<engine::component::ColliderComponent>();
    if (!tc || !cc || cc->isTrigger()) return;
    // ...

    if (!cc->isActive()) {  // å¦‚æœç¢°æ’å™¨æœªæ¿€æ´»ï¼Œç›´æ¥è®©ç‰©ä½“æ­£å¸¸ç§»åŠ¨ï¼Œç„¶åè¿”å›ã€‚
        tc->translate(ds);
        pc->velocity_ = glm::clamp(pc->velocity_, -max_speed_, max_speed_);
        return;
    }
    // ...
}
```

### ç¢°æ’æ£€æµ‹æµç¨‹æ›´æ–°

```
resolveTileCollisions() æµç¨‹ï¼š
    â†“
1. æ£€æŸ¥ç»„ä»¶æœ‰æ•ˆæ€§
    â†“
2. æ£€æŸ¥æ˜¯å¦ä¸º Trigger
    â†“
3. æ£€æŸ¥ç¢°æ’å™¨æ˜¯å¦æ¿€æ´»  â† æ–°å¢
    â†“ isActive() == false
    ç›´æ¥æ›´æ–°ä½ç½®ï¼Œè·³è¿‡ç¢°æ’æ£€æµ‹
    â†“
    ç‰©ä½“è‡ªç”±ä¸‹è½
```

ç°åœ¨ï¼Œå¦‚æœä¸€ä¸ªç‰©ä½“çš„ç¢°æ’å™¨è¢«ç¦ç”¨äº†ï¼Œç‰©ç†å¼•æ“å°† **ä¸å†ä¸ºå®ƒåšä»»ä½•ç¢°æ’è§£æ**ï¼Œåªä¼šå•çº¯åœ°æ ¹æ®é€Ÿåº¦æ›´æ–°å®ƒçš„ä½ç½®ï¼Œè¿™æ ·ç©å®¶æ­»äº¡åå°±èƒ½ä¼˜é›…åœ°æ‰å‡ºä¸–ç•Œè¾¹ç•Œäº†ã€‚

---

## 4. è¿æ¥ PlayerComponent å’Œæ–°çŠ¶æ€

æœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ `PlayerComponent` ä¸­åˆ›å»ºä¸€ä¸ªæ¡¥æ¢ï¼Œå½“ `HealthComponent` æŠ¥å‘Šå—ä¼¤æ—¶ï¼Œç”± `PlayerComponent` å†³å®šåˆ‡æ¢åˆ° `HurtState` è¿˜æ˜¯ `DeadState`ã€‚

### æ¶æ„è®¾è®¡

```
ä¼¤å®³å¤„ç†æµç¨‹ï¼š
å¤–éƒ¨è°ƒç”¨
    â†“
PlayerComponent::takeDamage()
    â†“ å§”æ‰˜
HealthComponent::takeDamage()
    â†“ è¿”å›æ˜¯å¦æˆåŠŸ
PlayerComponent æ£€æŸ¥ç»“æœ
    â†“ æˆåŠŸé€ æˆä¼¤å®³
æ£€æŸ¥æ˜¯å¦å­˜æ´»
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                â”‚
â”‚ è¿˜æ´»ç€         â”‚ å·²æ­»äº¡
â†“                â†“
HurtState        DeadState
```

---

### src/game/component/player_component.hï¼ˆæ›´æ–°ï¼‰

```cpp
class PlayerComponent final : public engine::component::Component {
private:
    // ...
    engine::component::HealthComponent* health_component_ = nullptr;
    // ...

    // --- å±æ€§ç›¸å…³å‚æ•° ---
    float stunned_duration_ = 0.4f;     ///< @brief ç©å®¶è¢«å‡»ä¸­åçš„ç¡¬ç›´æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰

public:
    // ...

    bool takeDamage(int damage);        ///< @brief è¯•å›¾é€ æˆä¼¤å®³ï¼Œè¿”å›æ˜¯å¦æˆåŠŸ

    // setters and getters
    // ...
    engine::component::HealthComponent* getHealthComponent() const { return health_component_; }

    // ...
    float getJumpForce() const { return jump_force_; }                  ///< @brief è·å–è·³è·ƒåŠ›
    void setStunnedDuration(float duration) { stunned_duration_ = duration; }  ///< @brief è®¾ç½®ç¡¬ç›´æ—¶é—´
    float getStunnedDuration() const { return stunned_duration_; }       ///< @brief è·å–ç¡¬ç›´æ—¶é—´

    // ...
};
```

### src/game/component/player_component.cppï¼ˆæ›´æ–°ï¼‰

```cpp
// ... includes for new states and health component
namespace game::component {

void PlayerComponent::init() {
    // ...
    health_component_ = owner_->getComponent<engine::component::HealthComponent>();
    if (/*... ||*/ !health_component_) {
        spdlog::error("Player å¯¹è±¡ç¼ºå°‘å¿…è¦ç»„ä»¶ï¼");
    }
    // ...
}

bool PlayerComponent::takeDamage(int damage) {
    if (is_dead_ || !health_component_ || damage <= 0) {
        return false;
    }

    bool success = health_component_->takeDamage(damage);
    if (!success) return false;
    
    // --- æˆåŠŸé€ æˆä¼¤å®³äº†ï¼Œæ ¹æ®æ˜¯å¦å­˜æ´»å†³å®šçŠ¶æ€åˆ‡æ¢
    if (health_component_->isAlive()) {
        // åˆ‡æ¢åˆ°å—ä¼¤çŠ¶æ€
        setState(std::make_unique<state::HurtState>(this));
    } else {
        is_dead_ = true;
        // åˆ‡æ¢åˆ°æ­»äº¡çŠ¶æ€
        setState(std::make_unique<state::DeadState>(this));
    }
    return true;
}
//...
}
```

### takeDamage() æ–¹æ³•è¯¦è§£

| æ­¥éª¤ | æ“ä½œ | è¯´æ˜ |
|------|------|------|
| **1. å®‰å…¨æ£€æŸ¥** | æ£€æŸ¥æ˜¯å¦å·²æ­»ã€ç»„ä»¶å­˜åœ¨ã€ä¼¤å®³æœ‰æ•ˆ | é˜²æ­¢å¼‚å¸¸è°ƒç”¨ |
| **2. å§”æ‰˜å¤„ç†** | `health_component_->takeDamage()` | çœŸæ­£çš„æ•°å€¼å¤„ç† |
| **3. æ£€æŸ¥ç»“æœ** | æ˜¯å¦æˆåŠŸé€ æˆä¼¤å®³ | å¯èƒ½è¢«æ— æ•Œå¸§é˜»æ­¢ |
| **4. åˆ¤æ–­å­˜æ´»** | `isAlive()` | å†³å®šåˆ‡æ¢åˆ°å“ªä¸ªçŠ¶æ€ |
| **5. åˆ‡æ¢çŠ¶æ€** | åˆ›å»ºå¹¶è®¾ç½®æ–°çŠ¶æ€ | `HurtState` æˆ– `DeadState` |
| **6. è¿”å›ç»“æœ** | `return true/false` | å‘ŠçŸ¥è°ƒç”¨è€…æ˜¯å¦æˆåŠŸ |

### ç»„ä»¶ä¾èµ–å…³ç³»

```
PlayerComponent å®Œæ•´ä¾èµ–ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PlayerComponent  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â†’ TransformComponent*
â”‚ â†’ PhysicsComponent*
â”‚ â†’ SpriteComponent*
â”‚ â†’ AnimationComponent*
â”‚ â†’ HealthComponent*      â† æ–°å¢
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ’¡ è®¾è®¡äº®ç‚¹

**å¤–éƒ¨æ¥å£å”¯ä¸€æ€§**ï¼š
- å¤–éƒ¨åªèƒ½é€šè¿‡ `PlayerComponent::takeDamage()` é€ æˆä¼¤å®³
- å†…éƒ¨é€»è¾‘å®Œå…¨å°è£…
- çŠ¶æ€åˆ‡æ¢è‡ªåŠ¨å¤„ç†

---

## 5. æµ‹è¯•

ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæˆ‘ä»¬åœ¨ `GameScene` ä¸­æ·»åŠ ä¸€ä¸ªä¸´æ—¶çš„æµ‹è¯•å‡½æ•°ï¼Œè®©æˆ‘ä»¬æŒ‰ä¸‹ `"attack"` é”®ï¼ˆé»˜è®¤ä¸º Jï¼‰æ—¶ï¼Œç©å®¶ä¼šè‡ªå·±å—åˆ° 1 ç‚¹ä¼¤å®³ã€‚

### src/game/scene/game_scene.cppï¼ˆæ›´æ–°ï¼‰

```cpp
void GameScene::handleInput() {
    Scene::handleInput();
    testHealth();  // æµ‹è¯•ç”Ÿå‘½å€¼ç»„ä»¶
}
// ...
void GameScene::testHealth()
{
    auto input_manager = context_.getInputManager();
    if (input_manager.isActionPressed("attack")) {
        player_->getComponent<game::component::PlayerComponent>()->takeDamage(1);
    }
}
```

### æµ‹è¯•æ­¥éª¤

| æ“ä½œ | é¢„æœŸæ•ˆæœ | çŠ¶æ€ |
|------|---------|------|
| **ç¬¬1æ¬¡æŒ‰ J** | å—ä¼¤åŠ¨ç”» + å‡»é€€ + ç¡¬ç›´ | ç”Ÿå‘½å€¼ 3 â†’ 2 |
| **ç¬¬2æ¬¡æŒ‰ J** | å—ä¼¤åŠ¨ç”» + å‡»é€€ + ç¡¬ç›´ | ç”Ÿå‘½å€¼ 2 â†’ 1 |
| **ç¬¬3æ¬¡æŒ‰ J** | æ­»äº¡åŠ¨ç”» + å‘ä¸Šå¼¹èµ· + æ‰å‡ºå±å¹• | ç”Ÿå‘½å€¼ 1 â†’ 0 |

---

## âœ… ç¼–è¯‘ä¸è¿è¡Œ

ç°åœ¨ç¼–è¯‘å¹¶è¿è¡Œæ¸¸æˆã€‚å°è¯•æŒ‰ **J** é”®ï¼š

```
æµ‹è¯•æ•ˆæœï¼š
ç¬¬1æ¬¡å’Œç¬¬2æ¬¡æŒ‰ Jï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ğŸ‘¤ â† å—ä¼¤            â”‚
â”‚    â†–ï¸  å‡»é€€             â”‚
â”‚   â”â”â”â”â”â”â”â”â”            â”‚
â”‚   ğŸ’¥ çŸ­æš‚ç¡¬ç›´           â”‚
â”‚   â¸ï¸  æ— æ³•æ“ä½œ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬3æ¬¡æŒ‰ Jï¼ˆç”Ÿå‘½è€—å°½ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      â†‘                   â”‚
â”‚     ğŸ‘¤ å‘ä¸Šå¼¹èµ·          â”‚
â”‚   â”â”â”â”â”â”â”â”â”            â”‚
â”‚      â†“                   â”‚
â”‚     ğŸ‘¤ ç©¿è¿‡åœ°é¢          â”‚
â”‚   â”â”â”â”â”â”â”â”â”            â”‚
â”‚      â†“                   â”‚
â”‚     ğŸ‘¤ æ‰å‡ºå±å¹•          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä½ ä¼šçœ‹åˆ°ï¼š**
- âœ… ç¬¬1ã€2æ¬¡å—ä¼¤ï¼šæ’­æ”¾å—ä¼¤åŠ¨ç”»ï¼Œè¢«å‡»é€€ï¼ŒçŸ­æš‚æ— æ³•æ“ä½œ
- âœ… å—ä¼¤åæœ‰æ— æ•Œå¸§ï¼ŒçŸ­æ—¶é—´å†…æ— æ³•å†æ¬¡å—ä¼¤
- âœ… ç¬¬3æ¬¡å—ä¼¤ï¼šç”Ÿå‘½è€—å°½ï¼Œå‘ä¸Šå¼¹èµ·
- âœ… æ­»äº¡åæ— è§†åœ°å½¢ï¼Œç›´æ¥æ‰å‡ºå±å¹•
- âœ… çŠ¶æ€æœºè‡ªåŠ¨ç®¡ç†æ•´ä¸ªè¿‡ç¨‹

---

## ğŸ¯ ç³»ç»Ÿæ¶æ„æ€»ç»“

### å®Œæ•´çš„ç”Ÿå‘½ç³»ç»Ÿæµç¨‹

```
1. Tiled ç¼–è¾‘å™¨
   â†“ å®šä¹‰ health å±æ€§
2. å›¾å—é›† .tsj æ–‡ä»¶
   â†“ å­˜å‚¨ç”Ÿå‘½å€¼
3. LevelLoader
   â†“ è§£æ health å±æ€§
   â†“ åˆ›å»º HealthComponent
4. GameObject
   â†“ æŒæœ‰ HealthComponent
5. å¤–éƒ¨è°ƒç”¨
   â†“ PlayerComponent::takeDamage()
6. HealthComponent
   â†“ å¤„ç†æ•°å€¼å’Œæ— æ•Œå¸§
   â†“ è¿”å›æ˜¯å¦æˆåŠŸ
7. PlayerComponent
   â†“ æ£€æŸ¥æ˜¯å¦å­˜æ´»
   â†“ å†³å®šçŠ¶æ€åˆ‡æ¢
8. çŠ¶æ€æœº
   â†“ HurtState æˆ– DeadState
9. è§†è§‰åé¦ˆ
   â†’ åŠ¨ç”» + å‡»é€€ + ç¡¬ç›´
```

### æ ¸å¿ƒæˆå°±

æˆ‘ä»¬æˆåŠŸåœ°ï¼š

1. âœ… **é€šç”¨ HealthComponent**ï¼šå¯å¤ç”¨çš„ç”Ÿå‘½ç®¡ç†ç»„ä»¶
2. âœ… **æ•°æ®é©±åŠ¨é…ç½®**ï¼šåœ¨ Tiled ä¸­è®¾ç½®ç”Ÿå‘½å€¼
3. âœ… **æ— æ•Œå¸§æœºåˆ¶**ï¼šé˜²æ­¢è¿ç»­ä¼¤å®³
4. âœ… **å—ä¼¤çŠ¶æ€**ï¼šå‡»é€€ã€ç¡¬ç›´ã€åŠ¨ç”»åé¦ˆ
5. âœ… **æ­»äº¡çŠ¶æ€**ï¼šç¦ç”¨ç¢°æ’ã€æ‰å‡ºå±å¹•
6. âœ… **çŠ¶æ€è”åŠ¨**ï¼šä¼¤å®³è‡ªåŠ¨è§¦å‘çŠ¶æ€åˆ‡æ¢

### çŠ¶æ€æœºå®Œæ•´å›¾

```
ç©å®¶çŠ¶æ€æœºï¼ˆå®Œæ•´ç‰ˆï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Idle   â”‚ â†â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â”‚
     â”‚ ç§»åŠ¨       â”‚ è½åœ°
     â†“            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  Walk   â”‚ â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ è·³è·ƒ
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Jump   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ å‘ä¸‹
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Fall   â”‚ â†â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â”‚
     â”‚ è½åœ°       â”‚ ç¡¬ç›´ç»“æŸ
     â”‚            â”‚
     â”‚ å—ä¼¤       â”‚
     â†“            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  Hurt   â”‚ â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ æ­»äº¡
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dead   â”‚ â† ç»ˆç»“çŠ¶æ€
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç»„ä»¶åä½œå…³ç³»

```
ç»„ä»¶åä½œå›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HealthComponent  â”‚ â† ç®¡ç†ç”Ÿå‘½å€¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ æŠ¥å‘Šä¼¤å®³
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PlayerComponent  â”‚ â† å†³ç­–ä¸­å¿ƒ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ åˆ‡æ¢çŠ¶æ€
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PlayerState      â”‚ â† æ§åˆ¶è¡Œä¸º
â”‚ - HurtState      â”‚
â”‚ - DeadState      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ æ›´æ–°è¡¨ç°
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PhysicsComponent â”‚ â† å‡»é€€æ•ˆæœ
â”‚ SpriteComponent  â”‚ â† åŠ¨ç”»æ’­æ”¾
â”‚ ColliderComponentâ”‚ â† ç¢°æ’æ§åˆ¶
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è®¾è®¡æ¨¡å¼åº”ç”¨

| æ¨¡å¼ | åº”ç”¨ | ä¼˜åŠ¿ |
|------|------|------|
| **ç»„ä»¶æ¨¡å¼** | HealthComponent | é€šç”¨ã€å¯å¤ç”¨ |
| **çŠ¶æ€æ¨¡å¼** | HurtStateã€DeadState | æ¸…æ™°çš„çŠ¶æ€ç®¡ç† |
| **æ•°æ®é©±åŠ¨** | Tiled é…ç½® | æ˜“äºè°ƒæ•´å¹³è¡¡ |
| **å§”æ‰˜æ¨¡å¼** | PlayerComponent â†’ HealthComponent | èŒè´£åˆ†ç¦» |

---

## ğŸ“š æ€»ç»“

æˆ‘ä»¬çš„æ¸¸æˆç°åœ¨æœ‰äº† **çœŸæ­£çš„æ ¸å¿ƒç©æ³•å¾ªç¯**ï¼šæŒ‘æˆ˜ â†’ å¤±è´¥ â†’ åé¦ˆã€‚

**å…³é”®è¦ç‚¹ï¼š**
- â¤ï¸ é€šç”¨çš„ HealthComponent ç®¡ç†ç”Ÿå‘½å€¼
- ğŸ›¡ï¸ æ— æ•Œå¸§æœºåˆ¶é˜²æ­¢è¿ç»­ä¼¤å®³
- ğŸ’¥ HurtState æä¾›å‡»é€€å’Œç¡¬ç›´åé¦ˆ
- âš°ï¸ DeadState å¤„ç†æ­»äº¡é€»è¾‘
- ğŸ”— PlayerComponent è¿æ¥ä¼¤å®³ä¸çŠ¶æ€
- ğŸ“Š æ•°æ®é©±åŠ¨çš„ç”Ÿå‘½å€¼é…ç½®

> ğŸ’¡ **è®¾è®¡å“²å­¦**ï¼šç”Ÿå‘½ç³»ç»Ÿæ˜¯æ¸¸æˆçš„æ ¸å¿ƒåé¦ˆæœºåˆ¶ä¹‹ä¸€ã€‚ä¸€ä¸ªå¥½çš„ç”Ÿå‘½ç³»ç»Ÿä¸ä»…è¦ç®¡ç†æ•°å€¼ï¼Œè¿˜è¦æä¾›æ¸…æ™°çš„è§†è§‰å’Œè§¦è§‰åé¦ˆã€‚æˆ‘ä»¬é€šè¿‡çŠ¶æ€æœºå°†å—ä¼¤å’Œæ­»äº¡å°è£…æˆç‹¬ç«‹çš„çŠ¶æ€ï¼Œç»“åˆåŠ¨ç”»ã€å‡»é€€ã€ç¡¬ç›´ç­‰æœºåˆ¶ï¼Œç»™ç©å®¶å¸¦æ¥çœŸå®çš„"å—ä¼¤"ä½“éªŒã€‚æ— æ•Œå¸§çš„è®¾è®¡é˜²æ­¢äº†è¿ç»­ä¼¤å®³é€ æˆçš„æŒ«è´¥æ„Ÿï¼Œè¿™æ˜¯å¹³å°æ¸¸æˆä¸­å¿…ä¸å¯å°‘çš„æœºåˆ¶ã€‚

---

## ğŸš€ ä¸‹ä¸€æ­¥å±•æœ›

ç°åœ¨ç©å®¶å¯ä»¥å—ä¼¤å’Œæ­»äº¡äº†ï¼ä½†æ¸¸æˆè¿˜ç¼ºå°‘æ”»å‡»æ€§ï¼š

- â“ å¦‚ä½•è®©ç©å®¶æ”»å‡»æ•Œäººï¼Ÿ
- â“ å¦‚ä½•å®ç°æ•Œäººçš„æ­»äº¡é€»è¾‘ï¼Ÿ
- â“ å¦‚ä½•å¤„ç†ç©å®¶ä¸æ•Œäººçš„ç¢°æ’äº¤äº’ï¼Ÿ

ä¸‹ä¸€è¯¾ï¼Œæˆ‘ä»¬å°†å®ç° **ç©å®¶ä¸å…¶ä»–å¯¹è±¡äº¤äº’**ï¼š

- âš”ï¸ ç©å®¶æ”»å‡»ç³»ç»Ÿ
- ğŸ’€ æ•Œäººæ­»äº¡å¤„ç†
- ğŸ† é“å…·æ‹¾å–æœºåˆ¶
- ğŸ® å®Œæ•´çš„æˆ˜æ–—å¾ªç¯

åå®ˆä¸ºæ”»ï¼Œè®©æ¸¸æˆçœŸæ­£"ç©"èµ·æ¥ï¼ğŸ®ğŸŒŸ