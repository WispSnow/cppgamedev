# åœºæ™¯ä¸åœºæ™¯ç®¡ç†

<div class="video-container">
  <div id="bilibili" class="video-content">
    <!-- Bç«™åµŒå…¥ï¼šä½¿ç”¨ https æ˜ç¡®åè®®ï¼ˆé¿å… file:// æˆ– http å¯¼è‡´è¢«æµè§ˆå™¨æ‹¦æˆªï¼‰ -->
    <iframe
      class="video-frame"
      src="https://player.bilibili.com/player.html?bvid=BV1Sy3vzbESW&page=1&autoplay=0&danmaku=0&high_quality=1"
      width="100%"
      height="480"
      scrolling="no"
      frameborder="0"
      allowfullscreen>
    </iframe>
  </div>
</div>

[åœ¨ Bilibili ä¸Šè§‚çœ‹](https://www.bilibili.com/video/BV1Sy3vzbESW)

## ğŸ“Œ é—®é¢˜èƒŒæ™¯

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„æµ‹è¯•ä»£ç éƒ½ç›´æ¥å†™åœ¨ `GameApp` ä¸­ã€‚è™½ç„¶è¿™åœ¨åˆæœŸå¾ˆæ–¹ä¾¿ï¼Œä½†éšç€é¡¹ç›®å˜å¤§ï¼Œ`GameApp` ä¼šå˜å¾—è‡ƒè‚¿ä¸å ªã€‚

### âš ï¸ ç°æœ‰æ¶æ„çš„é—®é¢˜

ä¸€ä¸ªå®Œæ•´çš„æ¸¸æˆåŒ…å«å¤šä¸ªçŠ¶æ€ï¼š

```
æ¸¸æˆçŠ¶æ€
â”œâ”€â”€ ä¸»èœå•
â”œâ”€â”€ æ¸¸æˆå…³å¡
â”‚   â”œâ”€â”€ ç¬¬ä¸€å…³
â”‚   â”œâ”€â”€ ç¬¬äºŒå…³
â”‚   â””â”€â”€ ...
â”œâ”€â”€ æš‚åœç•Œé¢
â”œâ”€â”€ è®¾ç½®ç•Œé¢
â””â”€â”€ æ¸¸æˆç»“æŸç•Œé¢
```

**æŠŠæ‰€æœ‰è¿™äº›é€»è¾‘éƒ½å¡è¿›ä¸€ä¸ªç±»é‡Œï¼Œä¼šæ˜¯ä¸€åœºç¾éš¾ã€‚**

æœ¬èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ª **åœºæ™¯ç®¡ç†ç³»ç»Ÿ**ï¼Œå°†æ¸¸æˆçš„ä¸åŒéƒ¨åˆ†åˆ’åˆ†åˆ°ç‹¬ç«‹çš„ **åœºæ™¯ï¼ˆSceneï¼‰** ä¸­ï¼Œå¹¶ç”± **åœºæ™¯ç®¡ç†å™¨ï¼ˆSceneManagerï¼‰** æ¥ç»Ÿä¸€è°ƒåº¦ã€‚

> ğŸ¯ è¿™æ˜¯æ„å»ºä¸€ä¸ªçœŸæ­£å¯æ‰©å±•æ¸¸æˆæ¶æ„çš„å…³é”®ä¸€æ­¥ã€‚

---

## 1. æ ¸å¿ƒæ¦‚å¿µï¼šåœºæ™¯æ ˆ

æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ç§ç»å…¸ä¸”å¼ºå¤§çš„æ¨¡å¼â€”â€”**åœºæ™¯æ ˆï¼ˆScene Stackï¼‰**ã€‚

<img src="https://theorhythm.top/gamedev/SL/SL.045.webp" alt="åœºæ™¯æ ˆ1" style="display: block; margin: auto; width: 700px;" />
<img src="https://theorhythm.top/gamedev/SL/SL.046.webp" alt="åœºæ™¯æ ˆ2" style="display: block; margin: auto; width: 700px;" />

### ğŸ’¡ æ ˆçš„ç±»æ¯”

æƒ³è±¡ä¸€å å¡ç‰‡ï¼Œä½ æ€»æ˜¯åªèƒ½ä¸ **æœ€ä¸Šé¢çš„é‚£å¼ å¡ç‰‡** äº’åŠ¨ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PauseScene  â”‚ â† æ ˆé¡¶ï¼ˆå½“å‰æ´»åŠ¨åœºæ™¯ï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ GameScene   â”‚ â† ä»åœ¨æ ˆä¸­ï¼Œä½†è¢«æš‚åœ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

<img src="https://theorhythm.top/gamedev/SL/SL.047.webp" alt="åœºæ™¯æ ˆ3" style="display: block; margin: auto; width: 700px;" />

#### Sceneï¼ˆåœºæ™¯ï¼‰

ä»£è¡¨æ¸¸æˆçš„ä¸€ä¸ªç‹¬ç«‹çŠ¶æ€ï¼Œæ¯”å¦‚ `MainMenuScene`, `GameScene`, `PauseScene`ã€‚

**ç‰¹ç‚¹ï¼š**
- æ¯ä¸ªåœºæ™¯éƒ½æ‹¥æœ‰å’Œç®¡ç†è‡ªå·±çš„ä¸€ç»„æ¸¸æˆå¯¹è±¡ï¼ˆGameObjectï¼‰
- åœºæ™¯ä¹‹é—´ç›¸äº’ç‹¬ç«‹

#### SceneManagerï¼ˆåœºæ™¯ç®¡ç†å™¨ï¼‰

è´Ÿè´£ç»´æŠ¤ä¸€ä¸ªåœºæ™¯çš„"æ ˆ"ç»“æ„ã€‚

**ä¸‰ç§åŸºæœ¬æ“ä½œï¼š**

| æ“ä½œ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| **Pushï¼ˆå‹å…¥ï¼‰** | å°†æ–°åœºæ™¯å‹å…¥æ ˆé¡¶ | ä»ä¸»èœå•è¿›å…¥æ¸¸æˆæ—¶ï¼Œå°† `GameScene` å‹å…¥æ ˆé¡¶ |
| **Popï¼ˆå¼¹å‡ºï¼‰** | å°†æ ˆé¡¶åœºæ™¯å¼¹å‡º | ä»æ¸¸æˆé€€å‡ºè¿”å›ä¸»èœå•æ—¶ï¼Œå°† `GameScene` å¼¹å‡º |
| **Replaceï¼ˆæ›¿æ¢ï¼‰** | æ›¿æ¢æ ˆé¡¶åœºæ™¯ | ä»ç¬¬ä¸€å…³åˆ‡æ¢åˆ°ç¬¬äºŒå…³æ—¶ï¼Œç”¨ `Level2Scene` æ›¿æ¢ `Level1Scene` |

### ğŸ® æ¸²æŸ“ä¸æ›´æ–°ç­–ç•¥

| ç”Ÿå‘½å‘¨æœŸæ–¹æ³• | ä½œç”¨èŒƒå›´ | è¯´æ˜ |
|-------------|---------|------|
| `handleInput()` | **ä»…æ ˆé¡¶åœºæ™¯** | åªæœ‰æ ˆé¡¶çš„åœºæ™¯æ¥æ”¶è¾“å…¥ |
| `update()` | **ä»…æ ˆé¡¶åœºæ™¯** | åªæœ‰æ ˆé¡¶çš„åœºæ™¯æ›´æ–°é€»è¾‘ |
| `render()` | **æ‰€æœ‰åœºæ™¯** | æ¸²æŸ“æ—¶å¯èƒ½ä¼šæ¸²æŸ“æ ˆä¸­çš„å¤šä¸ªåœºæ™¯ |

**æ¸²æŸ“å¤šåœºæ™¯çš„ä¾‹å­ï¼š**

```
æ¸¸æˆæš‚åœæ—¶ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   [ æš‚åœèœå• ]      â”‚ â† PauseSceneï¼ˆæ ˆé¡¶ï¼ŒåŠé€æ˜ï¼‰
â”‚                     â”‚
â”‚   æ¸¸æˆç”»é¢ç»§ç»­æ˜¾ç¤º  â”‚ â† GameSceneï¼ˆæ ˆåº•ï¼Œå®Œå…¨æ¸²æŸ“ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. æ–°çš„é¡¹ç›®ç»“æ„

æˆ‘ä»¬å°†ä»£ç ç»„ç»‡å¾—æ›´åŠ æ¸…æ™°ï¼Œåœ¨ `engine` ä¸‹åˆ›å»º `scene` ç›®å½•ï¼Œå¹¶åœ¨ `src` ä¸‹åˆ›å»º `game` ç›®å½•ï¼Œç”¨äºå­˜æ”¾å¼•æ“æ— å…³çš„æ¸¸æˆé€»è¾‘ä»£ç ã€‚

```
â””â”€â”€ src/
    â”œâ”€â”€ engine/                          // å¼•æ“å±‚ï¼ˆå¯å¤ç”¨ï¼‰
    â”‚   â”œâ”€â”€ core/
    â”‚   â”œâ”€â”€ resource/
    â”‚   â”œâ”€â”€ render/
    â”‚   â”œâ”€â”€ input/
    â”‚   â”œâ”€â”€ object/
    â”‚   â”œâ”€â”€ component/
    â”‚   â””â”€â”€ scene/                       // ğŸ†• åœºæ™¯ç³»ç»Ÿ
    â”‚       â”œâ”€â”€ scene.h
    â”‚       â”œâ”€â”€ scene.cpp
    â”‚       â”œâ”€â”€ scene_manager.h
    â”‚       â””â”€â”€ scene_manager.cpp
    â”‚
    â””â”€â”€ game/                            // ğŸ†• æ¸¸æˆå±‚ï¼ˆé¡¹ç›®ç‰¹å®šï¼‰
        â””â”€â”€ scene/
            â”œâ”€â”€ game_scene.h
            â””â”€â”€ game_scene.cpp
```

> ğŸ’¡ **è®¾è®¡åŸåˆ™**ï¼šå¼•æ“å±‚ä»£ç åº”è¯¥æ˜¯é€šç”¨çš„ã€å¯å¤ç”¨çš„ï¼›æ¸¸æˆå±‚ä»£ç æ˜¯é¡¹ç›®ç‰¹å®šçš„ã€‚

---

## 3. Scene åŸºç±»

è¿™æ˜¯æ‰€æœ‰å…·ä½“åœºæ™¯çš„çˆ¶ç±»ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªåœºæ™¯çš„åŸºæœ¬æ¡†æ¶ã€‚

### engine/scene/scene.h

```cpp
#pragma once
#include <vector>
#include <memory>
#include <string>

namespace engine::core {
    class Context;
}

namespace engine::render {
    class Renderer;
    class Camera;
}

namespace engine::input {
    class InputManager;
}

namespace engine::object {
    class GameObject;
}

namespace engine::scene {
    class SceneManager;

/**
 * @brief åœºæ™¯åŸºç±»ï¼Œè´Ÿè´£ç®¡ç†åœºæ™¯ä¸­çš„æ¸¸æˆå¯¹è±¡å’Œåœºæ™¯ç”Ÿå‘½å‘¨æœŸã€‚
 *
 * åŒ…å«ä¸€ç»„æ¸¸æˆå¯¹è±¡ï¼Œå¹¶æä¾›æ›´æ–°ã€æ¸²æŸ“ã€å¤„ç†è¾“å…¥å’Œæ¸…ç†çš„æ¥å£ã€‚
 * æ´¾ç”Ÿç±»åº”å®ç°å…·ä½“çš„åœºæ™¯é€»è¾‘ã€‚
 */
class Scene {
protected:
    std::string scene_name_;                            ///< @brief åœºæ™¯åç§°
    engine::core::Context& context_;                    ///< @brief ä¸Šä¸‹æ–‡å¼•ç”¨ï¼ˆéšå¼ï¼Œæ„é€ æ—¶ä¼ å…¥ï¼‰
    engine::scene::SceneManager& scene_manager_;        ///< @brief åœºæ™¯ç®¡ç†å™¨å¼•ç”¨ï¼ˆæ„é€ æ—¶ä¼ å…¥ï¼‰
    bool is_initialized_ = false;                       ///< @brief åœºæ™¯æ˜¯å¦å·²åˆå§‹åŒ–(éå½“å‰åœºæ™¯å¾ˆå¯èƒ½æœªè¢«åˆ é™¤ï¼Œå› æ­¤éœ€è¦åˆå§‹åŒ–æ ‡å¿—é¿å…é‡å¤åˆå§‹åŒ–)
    std::vector<std::unique_ptr<engine::object::GameObject>> game_objects_;         ///< @brief åœºæ™¯ä¸­çš„æ¸¸æˆå¯¹è±¡
    std::vector<std::unique_ptr<engine::object::GameObject>> pending_additions_;    ///< @brief å¾…æ·»åŠ çš„æ¸¸æˆå¯¹è±¡ï¼ˆå»¶æ—¶æ·»åŠ ï¼‰

public:
    /**
     * @brief æ„é€ å‡½æ•°ã€‚
     *
     * @param name åœºæ™¯çš„åç§°ã€‚
     * @param context åœºæ™¯ä¸Šä¸‹æ–‡ã€‚
     * @param scene_manager åœºæ™¯ç®¡ç†å™¨ã€‚
     */
    Scene(std::string name, engine::core::Context& context, engine::scene::SceneManager& scene_manager);

    virtual ~Scene();           // 1. åŸºç±»å¿…é¡»å£°æ˜è™šææ„å‡½æ•°æ‰èƒ½è®©æ´¾ç”Ÿç±»ææ„å‡½æ•°è¢«æ­£ç¡®è°ƒç”¨ã€‚
                                // 2. ææ„å‡½æ•°å®šä¹‰å¿…é¡»å†™åœ¨cppä¸­ï¼Œä¸ç„¶éœ€è¦å¼•å…¥GameObjectå¤´æ–‡ä»¶

    // ç¦æ­¢æ‹·è´å’Œç§»åŠ¨æ„é€ 
    Scene(const Scene&) = delete;
    Scene& operator=(const Scene&) = delete;
    Scene(Scene&&) = delete;
    Scene& operator=(Scene&&) = delete;

    // æ ¸å¿ƒå¾ªç¯æ–¹æ³•
    virtual void init();                        ///< @brief åˆå§‹åŒ–åœºæ™¯ã€‚
    virtual void update(float delta_time);      ///< @brief æ›´æ–°åœºæ™¯ã€‚
    virtual void render();                      ///< @brief æ¸²æŸ“åœºæ™¯ã€‚
    virtual void handleInput();                 ///< @brief å¤„ç†è¾“å…¥ã€‚
    virtual void clean();                       ///< @brief æ¸…ç†åœºæ™¯ã€‚

    /// @brief ç›´æ¥å‘åœºæ™¯ä¸­æ·»åŠ ä¸€ä¸ªæ¸¸æˆå¯¹è±¡ã€‚ï¼ˆåˆå§‹åŒ–æ—¶å¯ç”¨ï¼Œæ¸¸æˆè¿›è¡Œä¸­ä¸å®‰å…¨ï¼‰ ï¼ˆ&&è¡¨ç¤ºå³å€¼å¼•ç”¨ï¼Œä¸std::moveæ­é…ä½¿ç”¨ï¼Œé¿å…æ‹·è´ï¼‰
    virtual void addGameObject(std::unique_ptr<engine::object::GameObject>&& game_object);

    /// @brief å®‰å…¨åœ°æ·»åŠ æ¸¸æˆå¯¹è±¡ã€‚ï¼ˆæ·»åŠ åˆ°pending_additions_ä¸­ï¼‰
    virtual void safeAddGameObject(std::unique_ptr<engine::object::GameObject>&& game_object); 

    /// @brief ç›´æ¥ä»åœºæ™¯ä¸­ç§»é™¤ä¸€ä¸ªæ¸¸æˆå¯¹è±¡ã€‚ï¼ˆä¸€èˆ¬ä¸ä½¿ç”¨ï¼Œä½†ä¿ç•™å®ç°çš„é€»è¾‘ï¼‰
    virtual void removeGameObject(engine::object::GameObject* game_object_ptr);

    /// @brief å®‰å…¨åœ°ç§»é™¤æ¸¸æˆå¯¹è±¡ã€‚ï¼ˆè®¾ç½®need_remove_æ ‡è®°ï¼‰
    virtual void safeRemoveGameObject(engine::object::GameObject* game_object_ptr);

    /// @brief è·å–åœºæ™¯ä¸­çš„æ¸¸æˆå¯¹è±¡å®¹å™¨ã€‚
    const std::vector<std::unique_ptr<engine::object::GameObject>>& getGameObjects() const { return game_objects_; }

    /// @brief æ ¹æ®åç§°æŸ¥æ‰¾æ¸¸æˆå¯¹è±¡ï¼ˆè¿”å›æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªå¯¹è±¡ï¼‰ã€‚
    engine::object::GameObject* findGameObjectByName(const std::string& name) const;

    // getters and setters
    void setName(const std::string& name) { scene_name_ = name; }               ///< @brief è®¾ç½®åœºæ™¯åç§°
    const std::string& getName() const { return scene_name_; }                  ///< @brief è·å–åœºæ™¯åç§°
    void setInitialized(bool initialized) { is_initialized_ = initialized; }    ///< @brief è®¾ç½®åœºæ™¯æ˜¯å¦å·²åˆå§‹åŒ–
    bool isInitialized() const { return is_initialized_; }                      ///< @brief è·å–åœºæ™¯æ˜¯å¦å·²åˆå§‹åŒ–

    engine::core::Context& getContext() const { return context_; }                  ///< @brief è·å–ä¸Šä¸‹æ–‡å¼•ç”¨
    engine::scene::SceneManager& getSceneManager() const { return scene_manager_; } ///< @brief è·å–åœºæ™¯ç®¡ç†å™¨å¼•ç”¨
    std::vector<std::unique_ptr<engine::object::GameObject>>& getGameObjects() { return game_objects_; } ///< @brief è·å–åœºæ™¯ä¸­çš„æ¸¸æˆå¯¹è±¡

protected:
    void processPendingAdditions();     ///< @brief å¤„ç†å¾…æ·»åŠ çš„æ¸¸æˆå¯¹è±¡ã€‚ï¼ˆæ¯è½®æ›´æ–°çš„æœ€åè°ƒç”¨ï¼‰
};

} // namespace engine::scene
```

### æ ¸å¿ƒèŒè´£

| èŒè´£ | è¯´æ˜ |
|------|------|
| **ç®¡ç† GameObject** | ç®¡ç†ä¸€ä¸ª `std::vector` çš„ GameObjectï¼Œåœ¨è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸå†…è°ƒç”¨è¿™äº›å¯¹è±¡çš„ `update`, `render`, `handleInput` |
| **å®‰å…¨çš„å¯¹è±¡ç®¡ç†** | æä¾› `safeAddGameObject` å’Œ `safeRemoveGameObject` æ–¹æ³•ï¼Œé¿å…åœ¨æ¸¸æˆå¾ªç¯ä¸­ç›´æ¥ä¿®æ”¹å®¹å™¨å¯¼è‡´è¿­ä»£å™¨å¤±æ•ˆ |

### ğŸ›¡ï¸ å®‰å…¨çš„å¯¹è±¡ç®¡ç†

åœ¨æ¸¸æˆå¾ªç¯ä¸­ç›´æ¥æ·»åŠ æˆ–åˆ é™¤å¯¹è±¡ï¼ˆå³ä¿®æ”¹ `game_objects_` è¿™ä¸ª vectorï¼‰æ˜¯ **éå¸¸å±é™©** çš„ï¼Œå› ä¸ºå®ƒå¯èƒ½å¯¼è‡´è¿­ä»£å™¨å¤±æ•ˆã€‚

**è§£å†³æ–¹æ¡ˆï¼š**

```
safeAddGameObject()
    â†“
å°†å¯¹è±¡æ”¾å…¥ pending_additions_ åˆ—è¡¨
    â†“
åœ¨ update() æœ«å°¾è°ƒç”¨ processPendingAdditions()
    â†“
å®‰å…¨åœ°å°†å¯¹è±¡åŠ å…¥ game_objects_
```

```
safeRemoveGameObject()
    â†“
ç»™å¯¹è±¡æ‰“ä¸Š need_remove_ æ ‡è®°
    â†“
åœ¨ update() ä¸­éå†æ—¶æ£€æŸ¥æ ‡è®°
    â†“
å®‰å…¨åœ°ç§»é™¤æ ‡è®°çš„å¯¹è±¡
```

---

### engine/scene/scene.cpp

```cpp
#include "scene.h"
#include "../object/game_object.h"
#include "scene_manager.h"
#include <algorithm> // for std::remove_if
#include <spdlog/spdlog.h>

namespace engine::scene {

Scene::Scene(std::string name, engine::core::Context& context, engine::scene::SceneManager& scene_manager)
    : scene_name_(std::move(name)), context_(context), scene_manager_(scene_manager), is_initialized_(false) {
    spdlog::trace("åœºæ™¯ '{}' æ„é€ å®Œæˆã€‚", scene_name_);
}

Scene::~Scene() = default;

void Scene::init() {
    is_initialized_ = true;     // å­ç±»åº”è¯¥æœ€åè°ƒç”¨çˆ¶ç±»çš„ init æ–¹æ³•
    spdlog::trace("åœºæ™¯ '{}' åˆå§‹åŒ–å®Œæˆã€‚", scene_name_);
}

void Scene::update(float delta_time) {
    if (!is_initialized_) return;

    // æ›´æ–°æ‰€æœ‰æ¸¸æˆå¯¹è±¡ï¼Œå¹¶åˆ é™¤éœ€è¦ç§»é™¤çš„å¯¹è±¡
    for (auto it = game_objects_.begin(); it != game_objects_.end();) {
        if (*it && !(*it)->isNeedRemove()) {    // æ­£å¸¸æ›´æ–°æ¸¸æˆå¯¹è±¡
            (*it)->update(delta_time, context_);
            ++it;
        } else {
            if (*it) {      // å®‰å…¨åˆ é™¤éœ€è¦ç§»é™¤çš„å¯¹è±¡
                (*it)->clean();
            }
            it = game_objects_.erase(it);   // åˆ é™¤éœ€è¦ç§»é™¤çš„å¯¹è±¡ï¼Œæ™ºèƒ½æŒ‡é’ˆè‡ªåŠ¨ç®¡ç†å†…å­˜
        }
    }

    processPendingAdditions();      // å¤„ç†å¾…æ·»åŠ ï¼ˆå»¶æ—¶æ·»åŠ ï¼‰çš„æ¸¸æˆå¯¹è±¡
}

void Scene::render() {
     if (!is_initialized_) return;
    // æ¸²æŸ“æ‰€æœ‰æ¸¸æˆå¯¹è±¡
    for (const auto& obj : game_objects_) {
        if (obj) obj->render(context_);
    }
}

void Scene::handleInput() {
     if (!is_initialized_) return;

    // éå†æ‰€æœ‰æ¸¸æˆå¯¹è±¡ï¼Œå¹¶åˆ é™¤éœ€è¦ç§»é™¤çš„å¯¹è±¡
    for (auto it = game_objects_.begin(); it != game_objects_.end();) {
        if (*it && !(*it)->isNeedRemove()) {
            (*it)->handleInput(context_);
            ++it;
        } else {
            // å®‰å…¨åˆ é™¤éœ€è¦ç§»é™¤çš„å¯¹è±¡
            if (*it) (*it)->clean();
            it = game_objects_.erase(it);
        }
    }
}

void Scene::clean() {
    if (!is_initialized_) return;
    
    for (const auto& obj : game_objects_) {
        if (obj) obj->clean();
    }
    game_objects_.clear();

    is_initialized_ = false;        // æ¸…ç†å®Œæˆåï¼Œè®¾ç½®åœºæ™¯ä¸ºæœªåˆå§‹åŒ–
    spdlog::trace("åœºæ™¯ '{}' æ¸…ç†å®Œæˆã€‚", scene_name_);
}

void Scene::addGameObject(std::unique_ptr<engine::object::GameObject>&& game_object) {
    if (game_object) game_objects_.push_back(std::move(game_object));
    else spdlog::warn("å°è¯•å‘åœºæ™¯ '{}' æ·»åŠ ç©ºæ¸¸æˆå¯¹è±¡ã€‚", scene_name_);
}

void Scene::safeAddGameObject(std::unique_ptr<engine::object::GameObject>&& game_object)
{
    if (game_object) pending_additions_.push_back(std::move(game_object));
    else spdlog::warn("å°è¯•å‘åœºæ™¯ '{}' æ·»åŠ ç©ºæ¸¸æˆå¯¹è±¡ã€‚", scene_name_);
}

void Scene::removeGameObject(engine::object::GameObject* game_object_ptr) {
    if (!game_object_ptr) {
        spdlog::warn("å°è¯•ä»åœºæ™¯ '{}' ä¸­ç§»é™¤ä¸€ä¸ªç©ºçš„æ¸¸æˆå¯¹è±¡æŒ‡é’ˆã€‚", scene_name_);
        return;
    }

    // erase-remove ç§»é™¤æ³•ä¸å¯ç”¨ï¼Œå› ä¸ºæ™ºèƒ½æŒ‡é’ˆä¸è£¸æŒ‡é’ˆæ— æ³•æ¯”è¾ƒ
    // éœ€è¦ä½¿ç”¨ std::remove_if å’Œ lambda è¡¨è¾¾å¼è‡ªå®šä¹‰æ¯”è¾ƒçš„æ–¹å¼
    auto it = std::remove_if(game_objects_.begin(), game_objects_.end(),
                             [game_object_ptr](const std::unique_ptr<engine::object::GameObject>& p) {
                                 return p.get() == game_object_ptr;    // æ¯”è¾ƒè£¸æŒ‡é’ˆæ˜¯å¦ç›¸ç­‰ï¼ˆè‡ªå®šä¹‰æ¯”è¾ƒæ–¹å¼ï¼‰
                             });

    if (it != game_objects_.end()) {
        (*it)->clean();             // å› ä¸ºä¼ å…¥çš„æ˜¯æŒ‡é’ˆï¼Œå› æ­¤åªå¯èƒ½æœ‰ä¸€ä¸ªå…ƒç´ è¢«ç§»é™¤ï¼Œä¸éœ€è¦éå†itåˆ°æœ«å°¾
        game_objects_.erase(it, game_objects_.end());   // åˆ é™¤ä»itåˆ°æœ«å°¾çš„å…ƒç´ ï¼ˆæœ€åä¸€ä¸ªå…ƒç´ ï¼‰
        spdlog::trace("ä»åœºæ™¯ '{}' ä¸­ç§»é™¤æ¸¸æˆå¯¹è±¡ã€‚", scene_name_);
    } else {
        spdlog::warn("æ¸¸æˆå¯¹è±¡æŒ‡é’ˆæœªæ‰¾åˆ°åœ¨åœºæ™¯ '{}' ä¸­ã€‚", scene_name_);
    }
}

void Scene::safeRemoveGameObject(engine::object::GameObject* game_object_ptr)
{
    game_object_ptr->setNeedRemove(true);
}

engine::object::GameObject *Scene::findGameObjectByName(const std::string &name) const
{
    // æ‰¾åˆ°ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„æ¸¸æˆå¯¹è±¡å°±è¿”å›
    for (const auto& obj : game_objects_) {
        if (obj && obj->getName() == name) {
            return obj.get();
        }
    }
    return nullptr;
}

void Scene::processPendingAdditions()
{
    // å¤„ç†å¾…æ·»åŠ çš„æ¸¸æˆå¯¹è±¡
    for (auto& game_object : pending_additions_) {
        addGameObject(std::move(game_object));
    }
    pending_additions_.clear();
}

} // namespace engine::scene
```

---

## 4. SceneManagerï¼šåœºæ™¯çš„æ€»è°ƒåº¦

`SceneManager` æ˜¯å¼•æ“çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒè´Ÿè´£åœºæ™¯çš„åˆ‡æ¢é€»è¾‘ã€‚

### engine/scene/scene_manager.h

```cpp
#pragma once
#include <memory>
#include <string>
#include <vector>

// å‰ç½®å£°æ˜
namespace engine::core {
    class Context;
}
namespace engine::scene {
    class Scene;
}

namespace engine::scene {

/**
 * @brief ç®¡ç†æ¸¸æˆä¸­çš„åœºæ™¯æ ˆï¼Œå¤„ç†åœºæ™¯åˆ‡æ¢å’Œç”Ÿå‘½å‘¨æœŸã€‚
 */
class SceneManager final {
private:
    engine::core::Context& context_;                        ///< @brief å¼•æ“ä¸Šä¸‹æ–‡å¼•ç”¨
    std::vector<std::unique_ptr<Scene>> scene_stack_;       ///< @brief åœºæ™¯æ ˆ

    enum class PendingAction { None, Push, Pop, Replace };  ///< @brief å¾…å¤„ç†çš„åŠ¨ä½œ
    PendingAction pending_action_ = PendingAction::None;    ///< @brief å¾…å¤„ç†çš„åŠ¨ä½œ
    std::unique_ptr<Scene> pending_scene_;                  ///< @brief å¾…å¤„ç†åœºæ™¯

public:
    explicit SceneManager(engine::core::Context& context);
    ~SceneManager();

    // ç¦æ­¢æ‹·è´å’Œç§»åŠ¨
    SceneManager(const SceneManager&) = delete;
    SceneManager& operator=(const SceneManager&) = delete;
    SceneManager(SceneManager&&) = delete;
    SceneManager& operator=(SceneManager&&) = delete;

    // å»¶æ—¶åˆ‡æ¢åœºæ™¯
    void requestPushScene(std::unique_ptr<Scene>&& scene);      ///< @brief è¯·æ±‚å‹å…¥ä¸€ä¸ªæ–°åœºæ™¯ã€‚
    void requestPopScene();                                     ///< @brief è¯·æ±‚å¼¹å‡ºå½“å‰åœºæ™¯ã€‚
    void requestReplaceScene(std::unique_ptr<Scene>&& scene);   ///< @brief è¯·æ±‚æ›¿æ¢å½“å‰åœºæ™¯ã€‚

    // getters
    Scene* getCurrentScene() const;                                 ///< @brief è·å–å½“å‰æ´»åŠ¨åœºæ™¯ï¼ˆæ ˆé¡¶åœºæ™¯ï¼‰çš„æŒ‡é’ˆã€‚
    engine::core::Context& getContext() const { return context_; }  ///< @brief è·å–å¼•æ“ä¸Šä¸‹æ–‡å¼•ç”¨ã€‚

    // æ ¸å¿ƒå¾ªç¯å‡½æ•°
    void update(float delta_time);
    void render();
    void handleInput();
    void close();

private:
    void processPendingActions();                           ///< @brief å¤„ç†æŒ‚èµ·çš„åœºæ™¯æ“ä½œï¼ˆæ¯è½®æ›´æ–°æœ€åè°ƒç”¨ï¼‰ã€‚
    // ç›´æ¥åˆ‡æ¢åœºæ™¯
    void pushScene(std::unique_ptr<Scene>&& scene);         ///< @brief å°†ä¸€ä¸ªæ–°åœºæ™¯å‹å…¥æ ˆé¡¶ï¼Œä½¿å…¶æˆä¸ºæ´»åŠ¨åœºæ™¯ã€‚
    void popScene();                                        ///< @brief ç§»é™¤æ ˆé¡¶åœºæ™¯ã€‚
    void replaceScene(std::unique_ptr<Scene>&& scene);      ///< @brief æ¸…ç†åœºæ™¯æ ˆæ‰€æœ‰åœºæ™¯ï¼Œå°†æ­¤åœºæ™¯è®¾ä¸ºæ ˆé¡¶åœºæ™¯ã€‚
    
};

} // namespace engine::scene
```

### ğŸ”‘ å…³é”®è®¾è®¡ï¼šå»¶è¿Ÿå¤„ç†ï¼ˆPending Actionsï¼‰

ä¸ `Scene` ç®¡ç† `GameObject` ç±»ä¼¼ï¼Œ`SceneManager` ä¹Ÿä¸èƒ½åœ¨ä¸»å¾ªç¯ä¸­ç›´æ¥ä¿®æ”¹åœºæ™¯æ ˆã€‚

**åŸå› ï¼š**
- é¿å…åœ¨éå†æ ˆæ—¶ä¿®æ”¹æ ˆç»“æ„
- ä¿è¯åœºæ™¯åˆ‡æ¢çš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§

**å®ç°ï¼š**
- ä½¿ç”¨ `pending_action_` è®°å½•è¯·æ±‚ï¼ˆPush, Pop, or Replaceï¼‰
- åœ¨ `update` çš„æœ€åç»Ÿä¸€å¤„ç†

```
è¯·æ±‚åˆ‡æ¢åœºæ™¯
    â†“
è®¾ç½® pending_action_
    â†“
ç»§ç»­æ‰§è¡Œå½“å‰å¸§
    â†“
å¸§æœ«å°¾è°ƒç”¨ processPendingActions()
    â†“
å®‰å…¨åœ°æ‰§è¡Œåœºæ™¯åˆ‡æ¢
```

---

### engine/scene/scene_manager.cpp

```cpp
#include "scene_manager.h"
#include "scene.h"
#include "../core/context.h"
#include <spdlog/spdlog.h>

namespace engine::scene {

SceneManager::SceneManager(engine::core::Context& context)
    : context_(context) {
    spdlog::trace("åœºæ™¯ç®¡ç†å™¨å·²åˆ›å»ºã€‚");
}

SceneManager::~SceneManager() {
    spdlog::trace("åœºæ™¯ç®¡ç†å™¨å·²é”€æ¯ã€‚");
    close(); // å³ä½¿ä¸æ‰‹åŠ¨è°ƒç”¨ close ä¹Ÿèƒ½ç¡®ä¿æ¸…ç†
}

Scene* SceneManager::getCurrentScene() const {
    if (scene_stack_.empty()) {
        return nullptr;
    }
    return scene_stack_.back().get(); // è¿”å›æ ˆé¡¶åœºæ™¯çš„è£¸æŒ‡é’ˆ
}

void SceneManager::update(float delta_time) {
    // åªæ›´æ–°æ ˆé¡¶ï¼ˆå½“å‰ï¼‰åœºæ™¯
    Scene* current_scene = getCurrentScene();
    if (current_scene) {
        current_scene->update(delta_time);
    }
    // æ‰§è¡Œå¯èƒ½çš„åˆ‡æ¢åœºæ™¯æ“ä½œ
    processPendingActions();
}

void SceneManager::render() {
    // æ¸²æŸ“æ—¶éœ€è¦å åŠ æ¸²æŸ“æ‰€æœ‰åœºæ™¯ï¼Œè€Œä¸åªæ˜¯æ ˆé¡¶
    for (const auto& scene : scene_stack_) {
        if (scene) {
            scene->render();
        }
    }
}

void SceneManager::handleInput() {
    // åªè€ƒè™‘æ ˆé¡¶åœºæ™¯
    Scene* current_scene = getCurrentScene();
    if (current_scene) {
        current_scene->handleInput();
    }
}

void SceneManager::close() {
    spdlog::trace("æ­£åœ¨å…³é—­åœºæ™¯ç®¡ç†å™¨å¹¶æ¸…ç†åœºæ™¯æ ˆ...");
    // æ¸…ç†æ ˆä¸­æ‰€æœ‰å‰©ä½™çš„åœºæ™¯ï¼ˆä»é¡¶åˆ°åº•ï¼‰
    while (!scene_stack_.empty()) {
        if (scene_stack_.back()) {
            spdlog::debug("æ­£åœ¨æ¸…ç†åœºæ™¯ '{}' ã€‚", scene_stack_.back()->getName());
            scene_stack_.back()->clean();
        }
        scene_stack_.pop_back();
    }   
}

void SceneManager::requestPopScene()
{
    pending_action_ = PendingAction::Pop;
}

void SceneManager::requestReplaceScene(std::unique_ptr<Scene>&& scene)
{
    pending_action_ = PendingAction::Replace;
    pending_scene_ = std::move(scene);
}

void SceneManager::requestPushScene(std::unique_ptr<Scene>&& scene)
{
    pending_action_ = PendingAction::Push;
    pending_scene_ = std::move(scene);
}

// --- Private Methods ---

void SceneManager::processPendingActions()
{
    if (pending_action_ == PendingAction::None) {
        return;
    }

    switch (pending_action_) {
        case PendingAction::Pop:
            popScene();
            break;
        case PendingAction::Replace:
            replaceScene(std::move(pending_scene_));
            break;
        case PendingAction::Push:
            pushScene(std::move(pending_scene_));
            break;
        default:
            break;
    }

    pending_action_ = PendingAction::None;
}

void SceneManager::pushScene(std::unique_ptr<Scene>&& scene) {
    if (!scene) {
        spdlog::warn("å°è¯•å°†ç©ºåœºæ™¯å‹å…¥æ ˆã€‚");
        return;
    }
    spdlog::debug("æ­£åœ¨å°†åœºæ™¯ '{}' å‹å…¥æ ˆã€‚", scene->getName());

    // åˆå§‹åŒ–æ–°åœºæ™¯
    if (!scene->isInitialized()) { // ç¡®ä¿åªåˆå§‹åŒ–ä¸€æ¬¡
        scene->init(); 
    }

    // å°†æ–°åœºæ™¯ç§»å…¥æ ˆé¡¶
    scene_stack_.push_back(std::move(scene));
}

void SceneManager::popScene() {
    if (scene_stack_.empty()) {
        spdlog::warn("å°è¯•ä»ç©ºåœºæ™¯æ ˆä¸­å¼¹å‡ºã€‚");
        return;
    }
    spdlog::debug("æ­£åœ¨ä»æ ˆä¸­å¼¹å‡ºåœºæ™¯ '{}' ã€‚", scene_stack_.back()->getName());

    // æ¸…ç†å¹¶ç§»é™¤æ ˆé¡¶åœºæ™¯
    if (scene_stack_.back()) {
        scene_stack_.back()->clean();       // æ˜¾å¼è°ƒç”¨æ¸…ç†
    }
    scene_stack_.pop_back();
}

void SceneManager::replaceScene(std::unique_ptr<Scene>&& scene) {
    if (!scene) {
        spdlog::warn("å°è¯•ç”¨ç©ºåœºæ™¯æ›¿æ¢ã€‚");
        return;
    }
    spdlog::debug("æ­£åœ¨ç”¨åœºæ™¯ '{}' æ›¿æ¢åœºæ™¯ '{}' ã€‚", scene->getName(), scene_stack_.back()->getName());

    // æ¸…ç†å¹¶ç§»é™¤åœºæ™¯æ ˆä¸­æ‰€æœ‰åœºæ™¯
    while (!scene_stack_.empty()) {
        if (scene_stack_.back()) {
            scene_stack_.back()->clean();
        }
        scene_stack_.pop_back();
    }

    // åˆå§‹åŒ–æ–°åœºæ™¯
    if (!scene->isInitialized()) {
        scene->init();
    }

    // å°†æ–°åœºæ™¯å‹å…¥æ ˆé¡¶
    scene_stack_.push_back(std::move(scene));
}

} // namespace engine::scene
```

---

## 5. GameSceneï¼šæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªå…·ä½“åœºæ™¯

ç°åœ¨ï¼Œæˆ‘ä»¬æŠŠä¹‹å‰åœ¨ `GameApp` ä¸­çš„æµ‹è¯•é€»è¾‘ï¼Œè¿ç§»åˆ°ä¸€ä¸ªä¸“é—¨çš„ `GameScene` ä¸­ã€‚è¿™æ˜¯æˆ‘ä»¬ç¬¬ä¸€ä¸ªå±äº **game é€»è¾‘å±‚** çš„ç±»ã€‚

### src/game/scene/game_scene.h

```cpp
#pragma once
#include "../../engine/scene/scene.h"
#include <memory>

// å‰ç½®å£°æ˜
namespace engine::object {
    class GameObject;
}

namespace game::scene {

/**
 * @brief ä¸»è¦çš„æ¸¸æˆåœºæ™¯ï¼ŒåŒ…å«ç©å®¶ã€æ•Œäººã€å…³å¡å…ƒç´ ç­‰ã€‚
 */
class GameScene final: public engine::scene::Scene {

public:
    GameScene(std::string name, engine::core::Context& context, engine::scene::SceneManager& scene_manager);

    // è¦†ç›–åœºæ™¯åŸºç±»çš„æ ¸å¿ƒæ–¹æ³•
    void init() override;
    void update(float delta_time) override;
    void render() override;
    void handleInput() override;
    void clean() override;

private:
    // æµ‹è¯•å‡½æ•°
    void createTestObject();
};

} // namespace game::scene
```

### src/game/scene/game_scene.cpp

```cpp
#include "game_scene.h"
#include "../../engine/core/context.h"
#include "../../engine/object/game_object.h"
#include "../../engine/component/transform_component.h"
#include "../../engine/component/sprite_component.h"
#include <spdlog/spdlog.h>
#include <SDL3/SDL_rect.h>

namespace game::scene {

// æ„é€ å‡½æ•°ï¼šè°ƒç”¨åŸºç±»æ„é€ å‡½æ•°
GameScene::GameScene(std::string name, engine::core::Context& context, engine::scene::SceneManager& scene_manager)
    : Scene(name, context, scene_manager) {
    spdlog::trace("GameScene æ„é€ å®Œæˆã€‚");
}

void GameScene::init() {
    // åˆ›å»º test_object
    createTestObject();

    Scene::init();
    spdlog::trace("GameScene åˆå§‹åŒ–å®Œæˆã€‚");
}

void GameScene::update(float delta_time) {
    Scene::update(delta_time);
}

void GameScene::render() {
    Scene::render();
}

void GameScene::handleInput() {
    Scene::handleInput();
}

void GameScene::clean() {
    Scene::clean();
}

// --- ç§æœ‰æ–¹æ³• ---

void GameScene::createTestObject() {
    spdlog::trace("åœ¨ GameScene ä¸­åˆ›å»º test_object...");
    auto test_object = std::make_unique<engine::object::GameObject>("test_object");

    // æ·»åŠ ç»„ä»¶
    test_object->addComponent<engine::component::TransformComponent>(glm::vec2(100.0f, 100.0f)); 
    test_object->addComponent<engine::component::SpriteComponent>("assets/textures/Props/big-crate.png", context_.getResourceManager());

    // å°†åˆ›å»ºå¥½çš„ GameObject æ·»åŠ åˆ°åœºæ™¯ä¸­ ï¼ˆä¸€å®šè¦ç”¨std::moveï¼Œå¦åˆ™ä¼ é€’çš„æ˜¯å·¦å€¼ï¼‰
    addGameObject(std::move(test_object)); 
    spdlog::trace("test_object åˆ›å»ºå¹¶æ·»åŠ åˆ° GameScene ä¸­ã€‚");
}

} // namespace game::scene
```

### ğŸ¯ è®¾è®¡äº®ç‚¹

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **ç»§æ‰¿ Scene åŸºç±»** | è·å¾—å®Œæ•´çš„åœºæ™¯ç”Ÿå‘½å‘¨æœŸç®¡ç† |
| **è°ƒç”¨åŸºç±»æ–¹æ³•** | åœ¨å„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­è°ƒç”¨ `Scene::xxx()`ï¼Œç¡®ä¿åŸºç±»é€»è¾‘æ­£ç¡®æ‰§è¡Œ |
| **é€»è¾‘å°è£…** | å°†å¯¹è±¡åˆ›å»ºå°è£…åˆ° `createTestObject()` ç­‰ç§æœ‰æ–¹æ³•ä¸­ |
| **å‘½åç©ºé—´åˆ†ç¦»** | ä½¿ç”¨ `game::scene` å‘½åç©ºé—´ï¼Œä¸å¼•æ“å±‚åˆ†ç¦» |

---

## 6. æ”¹é€  GameApp

æœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬æ”¹é€  `GameApp`ï¼Œè®©å®ƒæˆä¸ºä¸€ä¸ª **çº¯ç²¹çš„å¼•æ“å¼•å¯¼è€…å’Œå¾ªç¯é©±åŠ¨è€…**ï¼Œä¸å†åŒ…å«ä»»ä½•æ¸¸æˆé€»è¾‘ã€‚

### engine/core/game_app.h

```cpp
namespace engine::scene {
class SceneManager;
}

class GameApp final {
private:
    std::unique_ptr<engine::scene::SceneManager> scene_manager_;
    
    [[nodiscard]] bool initSceneManager();
};
```

### engine/core/game_app.cpp

```cpp
// ...
bool GameApp::init() {
    // ... åˆå§‹åŒ–æ‰€æœ‰å¼•æ“æ¨¡å— ...
    if (!initContext()) return false;
    if (!initSceneManager()) return false;

    // åˆ›å»ºç¬¬ä¸€ä¸ªåœºæ™¯å¹¶å‹å…¥æ ˆ
    auto scene = std::make_unique<game::scene::GameScene>("GameScene", *context_, *scene_manager_);
    scene_manager_->requestPushScene(std::move(scene));

    is_running_ = true;
    spdlog::trace("GameApp åˆå§‹åŒ–æˆåŠŸã€‚");
    return true;
}

void GameApp::handleEvents() {
    if (input_manager_->shouldQuit()) {
        is_running_ = false;
        return;
    }
    scene_manager_->handleInput();
}

void GameApp::update(float delta_time) {
    scene_manager_->update(delta_time);
}

void GameApp::render() {
    renderer_->clearScreen();
    scene_manager_->render();
    renderer_->present();
}

bool GameApp::initSceneManager()
{
    try {
        scene_manager_ = std::make_unique<engine::scene::SceneManager>(*context_);
    } catch (const std::exception& e) {
        spdlog::error("åˆå§‹åŒ–åœºæ™¯ç®¡ç†å™¨å¤±è´¥: {}", e.what());
        return false;
    }
    spdlog::trace("åœºæ™¯ç®¡ç†å™¨åˆå§‹åŒ–æˆåŠŸã€‚");
    return true;
}
// ...
```

### âœ¨ æ”¹é€ æˆæœ

**æ‰€æœ‰çš„ `test...` å‡½æ•°éƒ½å·²è¢«ç§»é™¤ã€‚** `GameApp` çš„ä¸»å¾ªç¯ç°åœ¨å˜å¾— **æå…¶ç®€æ´**ï¼š

```cpp
ä¸»å¾ªç¯ (GameApp)
    â†“
å§”æ‰˜ç»™ SceneManager
    â†“
SceneManager è°ƒåº¦å½“å‰åœºæ™¯
    â†“
Scene ç®¡ç†å…¶æ¸¸æˆå¯¹è±¡
    â†“
GameObject æ‰§è¡Œç»„ä»¶é€»è¾‘
```

---

## âœ… ç¼–è¯‘ä¸è¿è¡Œ

ç¼–è¯‘å¹¶è¿è¡Œï¼Œä½ å°†çœ‹åˆ°å’Œä¸Šä¸€è¯¾ **å®Œå…¨ä¸€æ ·çš„ç”»é¢**ã€‚ä½†è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬çš„ä»£ç æ¶æ„å·²ç» **å‘ç”Ÿäº†è´¨çš„é£è·ƒ**ã€‚

```
è¿è¡Œæ•ˆæœï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         â”‚
â”‚     â•±â”€â”€â”€â”€â•²              â”‚
â”‚    â•±  ğŸ“¦  â•²             â”‚
â”‚    â•²      â•±             â”‚
â”‚     â•²â”€â”€â”€â”€â•±              â”‚
â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ ç³»ç»Ÿæ¶æ„æ€»ç»“

### æ ¸å¿ƒæˆå°±

æˆ‘ä»¬æˆåŠŸåœ°ï¼š

1. âœ… **å®ç°åœºæ™¯æ ˆç³»ç»Ÿ**ï¼šæ”¯æŒ Pushã€Popã€Replace ä¸‰ç§åœºæ™¯åˆ‡æ¢æ“ä½œ
2. âœ… **å®‰å…¨çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šé€šè¿‡å»¶è¿Ÿå¤„ç†ç¡®ä¿åœºæ™¯å’Œå¯¹è±¡çš„å®‰å…¨åˆ‡æ¢
3. âœ… **åˆ†å±‚æ¶æ„**ï¼šå¼•æ“å±‚ï¼ˆengineï¼‰å’Œæ¸¸æˆå±‚ï¼ˆgameï¼‰æ¸…æ™°åˆ†ç¦»
4. âœ… **ç®€åŒ– GameApp**ï¼šå°†æ¸¸æˆé€»è¾‘ä»å¼•æ“æ ¸å¿ƒå‰¥ç¦»

### æ¶æ„å¯¹æ¯”

| ç‰¹æ€§ | æ”¹é€ å‰ | æ”¹é€ å |
|------|--------|--------|
| **ä»£ç ç»„ç»‡** | æ‰€æœ‰é€»è¾‘åœ¨ GameApp ä¸­ | æŒ‰åœºæ™¯å’ŒåŠŸèƒ½æ¨¡å—åˆ’åˆ† |
| **å¯æ‰©å±•æ€§** | æ·»åŠ æ–°çŠ¶æ€å›°éš¾ | åªéœ€æ·»åŠ æ–°åœºæ™¯ç±» |
| **ä»£ç å¤ç”¨** | å¼•æ“å’Œæ¸¸æˆé€»è¾‘æ··åœ¨ä¸€èµ· | å¼•æ“å±‚å¯åœ¨å…¶ä»–é¡¹ç›®å¤ç”¨ |
| **ç»´æŠ¤æ€§** | GameApp è‡ƒè‚¿ | æ¯ä¸ªåœºæ™¯ç‹¬ç«‹ç»´æŠ¤ |

### è®¾è®¡æ¨¡å¼åº”ç”¨

| æ¨¡å¼ | åº”ç”¨ |
|------|------|
| **æ ˆæ¨¡å¼** | åœºæ™¯æ ˆç®¡ç†æ¸¸æˆçŠ¶æ€ |
| **å»¶è¿Ÿæ‰§è¡Œ** | Pending Actions é¿å…å¹¶å‘ä¿®æ”¹ |
| **æ¨¡æ¿æ–¹æ³•** | Scene å®šä¹‰ç”Ÿå‘½å‘¨æœŸæ¡†æ¶ |
| **ç­–ç•¥æ¨¡å¼** | ä¸åŒåœºæ™¯å®ç°ä¸åŒé€»è¾‘ |

---

### æœªæ¥çš„åœºæ™¯åº”ç”¨

æœ‰äº†åœºæ™¯ç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åˆ›å»ºï¼š

```cpp
// ä¸»èœå•åœºæ™¯
scene_manager_->requestPushScene(
    std::make_unique<MainMenuScene>("MainMenu", context, scene_manager)
);

// è¿›å…¥æ¸¸æˆï¼ˆå‹å…¥æ¸¸æˆåœºæ™¯ï¼‰
scene_manager_->requestPushScene(
    std::make_unique<GameScene>("Game", context, scene_manager)
);

// æš‚åœæ¸¸æˆï¼ˆå‹å…¥æš‚åœåœºæ™¯ï¼Œæ¸¸æˆåœºæ™¯ç»§ç»­æ¸²æŸ“ï¼‰
scene_manager_->requestPushScene(
    std::make_unique<PauseScene>("Pause", context, scene_manager)
);

// åˆ‡æ¢å…³å¡ï¼ˆæ›¿æ¢åœºæ™¯ï¼‰
scene_manager_->requestReplaceScene(
    std::make_unique<Level2Scene>("Level2", context, scene_manager)
);

// è¿”å›ä¸»èœå•ï¼ˆå¼¹å‡ºæ‰€æœ‰åœºæ™¯ï¼Œå‹å…¥ä¸»èœå•ï¼‰
scene_manager_->requestPopScene();
```

---

## ğŸ“š æ€»ç»“

æˆ‘ä»¬æˆåŠŸåœ°å°†æ¸¸æˆé€»è¾‘ä»å¼•æ“æ ¸å¿ƒä¸­å‰¥ç¦»ï¼Œå¹¶ä¸ºæ„å»ºä¸€ä¸ªæ‹¥æœ‰ **å¤šä¸ªå…³å¡å’Œèœå•** çš„å¤æ‚æ¸¸æˆé“ºå¹³äº†é“è·¯ã€‚

**å…³é”®è¦ç‚¹ï¼š**
- ğŸ—ï¸ åœºæ™¯æ ˆæ¨¡å¼ç®¡ç†æ¸¸æˆçŠ¶æ€
- ğŸ›¡ï¸ å»¶è¿Ÿå¤„ç†ç¡®ä¿å®‰å…¨æ€§
- ğŸ“¦ Scene ç±»ç®¡ç†æ¸¸æˆå¯¹è±¡é›†åˆ
- ğŸ® SceneManager ç»Ÿä¸€è°ƒåº¦åœºæ™¯
- ğŸ”€ æ”¯æŒ Push / Pop / Replace ä¸‰ç§åˆ‡æ¢æ–¹å¼
- ğŸ¯ å¼•æ“å±‚å’Œæ¸¸æˆå±‚æ¸…æ™°åˆ†ç¦»

> ğŸ’¡ **æ¶æ„åŸåˆ™**ï¼šä¸€ä¸ªå¥½çš„æ¶æ„ä¸æ˜¯ä¸€å¼€å§‹å°±å®Œç¾çš„ï¼Œè€Œæ˜¯åœ¨å®è·µä¸­ä¸æ–­é‡æ„å’Œæ”¹è¿›çš„ã€‚æˆ‘ä»¬çš„å¼•æ“æ­£æœç€æ›´åŠ æ¨¡å—åŒ–ã€å¯æ‰©å±•çš„æ–¹å‘å‘å±•ï¼

ä»ä¸‹ä¸€è¯¾å¼€å§‹ï¼Œæˆ‘ä»¬å°†ä¸å†æ‰‹åŠ¨åˆ›å»ºæµ‹è¯•å¯¹è±¡ï¼Œè€Œæ˜¯é€šè¿‡ **å…³å¡è½½å…¥å™¨** ä»åœ°å›¾æ–‡ä»¶ä¸­åŠ è½½æ•´ä¸ªæ¸¸æˆä¸–ç•Œï¼ğŸ—ºï¸âœ¨
