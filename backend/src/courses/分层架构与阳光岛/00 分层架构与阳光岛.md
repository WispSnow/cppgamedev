# 分层架构与阳光岛：C++游戏开发的架构实践

<div class="video-container">
  <div id="bilibili" class="video-content">
    <!-- B站嵌入：使用 https 明确协议（避免 file:// 或 http 导致被浏览器拦截） -->
    <iframe
      class="video-frame"
      src="https://player.bilibili.com/player.html?bvid=BV1u7NizLEBa&page=1&autoplay=0&danmaku=0&high_quality=1"
      width="100%"
      height="480"
      scrolling="no"
      frameborder="0"
      allowfullscreen>
    </iframe>
  </div>
</div>

[在 Bilibili 上观看](https://www.bilibili.com/video/BV1u7NizLEBa)

## 🎮 课程简介

欢迎来到《C++游戏开发之旅》系列的第三期课程：**《分层架构与阳光岛》**！

在前两期课程中，我们分别从零开始构建了"太空战机"，掌握了游戏开发的基础，并通过"幽灵逃生"项目，深入实践了模块化编程思想。现在，是时候迈向新的高度，探索更专业、更具扩展性的游戏架构设计了。

> 📦 课程配套代码: [Github](https://github.com/WispSnow/SunnyLand)

---

## 🚀 新的征程：分层架构与平台跳跃游戏
在本期课程中，我们将挑战经典的**2D平台跳跃游戏**类型，并引入**分层架构（Layered Architecture）**这一核心概念。与之前将所有逻辑耦合在游戏主循环中的做法不同，我们将学习如何构建一个清晰、可维护、可扩展的游戏引擎。

### 🏗️ 什么是分层架构？

我们将把整个游戏项目解构为两个主要部分：

#### 1️⃣ 游戏引擎层 (Engine Layer)

负责处理**通用的、与具体游戏逻辑无关**的核心功能。这一层是高度可复用的，理论上可以用于开发任何类型的2D游戏。它包含：

- ⚙️ **核心系统** - 游戏循环、配置管理、场景管理等
- 🎨 **渲染引擎** - 封装SDL3的底层渲染，提供相机、精灵、动画、文字等高级渲染功能
- 🔬 **物理引擎** - 处理重力、碰撞检测、碰撞解析（包括斜坡和单向平台）
- 📦 **资源管理** - 统一管理纹理、音频、字体等资源
- 🧩 **组件系统** - 提供游戏对象（GameObject）和组件（Component）的基类
- 🖼️ **UI系统** - 一个基于状态模式的、可交互的UI框架

#### 2️⃣ 游戏逻辑层 (Game Layer)

专注于实现"阳光岛"这款游戏的**特定玩法和逻辑**。这一层依赖于引擎层提供的功能，包含：

- 🕹️ **玩家逻辑** - 实现复杂的玩家状态机（站立、行走、跳跃、攀爬、受伤、死亡等）
- 🤖 **敌人AI** - 为不同类型的敌人（巡逻、跳跃、飞行）设计AI行为策略
- 🗺️ **关卡逻辑** - 道具交互、关卡切换、游戏数据持久化等
- 🎬 **游戏场景** - 实现标题、游戏、暂停、帮助、结束等具体场景

### 💡 设计优势

通过这种分层设计，我们的代码将变得**前所未有的清晰和强大**。

---

## 🌴 "阳光岛"项目介绍

我们将开发的"阳光岛"是一款**像素风格的平台跳跃游戏**，你将控制主角在一系列充满敌人和挑战的关卡中冒险。

### ✨ 游戏特性

- 🎯 **流畅的角色控制** - 支持跳跃、攀爬、土狼时间（Coyote Time）等高级技巧
- 👾 **多样化的敌人** - 拥有各自独特的AI行为模式
- 🗺️ **丰富的关卡元素** - 包括移动平台、斜坡、单向平台、危险区域和可收集道具
- 🖼️ **完整的UI系统** - 包括生命值显示、得分记录、菜单和按钮交互
- 🎬 **多场景管理** - 实现标题、游戏、暂停、帮助和结束画面的无缝切换
- 🎵 **完善的音频系统** - 包含背景音乐和各种游戏音效
- 🛠️ **关卡编辑器集成** - 基于JSON的关卡编辑器（Tiled）集成，让你轻松设计自己的关卡
- 💾 **存档功能** - 游戏存档与读档功能

---

## 📚 36课时内容概览

在这36节课中，我们将全面覆盖从引擎设计到游戏完成的每一个环节：

### 🏗️ 阶段一：引擎基础构建

游戏架构设计、主循环、资源管理、渲染器与相机

### 🧩 阶段二：核心组件系统

游戏对象与组件模型、变换、精灵、动画、物理与碰撞组件

### 🔬 阶段三：物理引擎深入

瓦片地图碰撞解析，包括单向平台与复杂的斜坡逻辑

### 🕹️ 阶段四：高级玩家控制

实现包含攀爬、受伤、土狼时间等状态的复杂状态机

### 🤖 阶段五：AI行为设计

使用策略模式为不同敌人设计巡逻、跳跃、飞行等AI行为

### 🗺️ 阶段六：关卡与数据

使用Tiled设计关卡、实现关卡加载器、管理跨场景的游戏数据

### 🖼️ 阶段七：UI框架与实现

构建一个可交互的UI系统，实现游戏HUD、菜单和各个场景界面

### 🎵 阶段八：音频与特效

集成音频播放，为关键事件（如击败敌人、收集道具）添加音效与视觉特效

### 🎬 阶段九：游戏流程管理

实现完整的场景切换逻辑，包括标题、暂停、帮助和结束场景

---

## 📸 项目截图

<div style="display: flex; gap: 10px;">
<img src="https://theorhythm.top/gamedev/SL/SL_screenshot_1.png" width="300" alt="阳光岛游戏截图1"/>
<img src="https://theorhythm.top/gamedev/SL/SL_screenshot_2.png" width="300" alt="阳光岛游戏截图2"/>
</div>
<div style="display: flex; gap: 10px;">
<img src="https://theorhythm.top/gamedev/SL/SL_screenshot_3.png" width="300" alt="阳光岛游戏截图3"/>
<img src="https://theorhythm.top/gamedev/SL/SL_screenshot_4.png" width="300" alt="阳光岛游戏截图4"/>
</div>

---

## 👥 适合谁学习？

本课程是为有一定C++和游戏开发基础的学员设计的**进阶课程**，特别适合：

- 🎓 **已完成前两期课程** - 希望挑战更复杂项目、学习专业架构设计的学员
- 💻 **有游戏开发经验** - 但对代码组织和架构感到困惑的开发者
- 🔧 **希望构建游戏引擎** - 并深入理解其背后原理的程序员
- 🎮 **平台跳跃游戏爱好者** - 对此类型充满热情，渴望亲手实现一款完整作品的爱好者

---

## 🚀 准备好迎接挑战了吗？
这不仅仅是制作一款游戏，更是一次**构建一个小型游戏引擎的实践**。我们将从最底层的代码开始，一层层搭建起一个功能完备、结构清晰的框架，并最终在它的基础上绽放出"阳光岛"这款游戏的生命力。

准备好将你的游戏开发技能提升到一个全新的水平了吗？让我们现在就出发，踏上这场激动人心的架构实践之旅吧！

---

## 💝 致谢

感谢 **Sino**、**李同学**、**swrainbow**、**爱发电用户_b7469** 对本项目的赞助支持！