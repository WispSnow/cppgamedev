# ç”Ÿæˆå™¨æ¨¡å¼ (Builder) 

<div class="video-container">
  <div id="bilibili" class="video-content">
    <iframe
      class="video-frame"
      src="https://player.bilibili.com/player.html?bvid=BV1yNpyzTEuo&page=1&autoplay=0&danmaku=0&high_quality=1"
      width="100%"
      height="480"
      scrolling="no"
      frameborder="0"
      allowfullscreen>
    </iframe>
  </div>
</div>

**ç”Ÿæˆå™¨æ¨¡å¼**æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„åˆ›å»ºå‹æ¨¡å¼ï¼Œå°¤å…¶é€‚åˆç”¨æ¥æ„å»ºå…·æœ‰å¤šç§ç»„ä»¶å’Œå¤æ‚é…ç½®çš„å¯¹è±¡ï¼Œæ¯”å¦‚æˆ‘ä»¬æ¸¸æˆä¸­çš„ `GameObject`ã€‚

æœ¬èŠ‚è¯¾å°†åˆ†ä¸ºä¸¤éƒ¨åˆ†ã€‚åœ¨ç¬¬ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†ä¸“æ³¨äºè§£å†³ `LevelLoader` ä¸­é‚£ä¸ªè‡ƒè‚¿ä¸å ªçš„ `loadObjectLayer` å‡½æ•°ï¼Œé€šè¿‡å¼•å…¥ä¸€ä¸ªé€šç”¨çš„ `ObjectBuilder` æ¥å°è£…å¯¹è±¡çš„æ„å»ºé€»è¾‘ã€‚

---

# Part 1 - åˆ†è§£å¤æ‚çš„å¯¹è±¡æ„å»ºè¿‡ç¨‹

## ğŸ¯ è¯¾ç¨‹ç›®æ ‡

*   **è¯†åˆ«â€œæ„é€ å‡½æ•°åœ°ç‹±â€**ï¼šè®¤è¯†åˆ°å½“ä¸€ä¸ªç±»ï¼ˆ`LevelLoader`ï¼‰æ‰¿æ‹…äº†è¿‡å¤šå¯¹è±¡åˆ›å»ºçš„ç»†èŠ‚æ—¶ï¼Œä»£ç ä¼šå˜å¾—å¤šä¹ˆå¤æ‚å’Œéš¾ä»¥ç»´æŠ¤ã€‚
*   **ç†è§£ç”Ÿæˆå™¨æ¨¡å¼**ï¼šå­¦ä¹ å¦‚ä½•å°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºè¿‡ç¨‹ä¸å…¶è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚
*   **å®è·µç”Ÿæˆå™¨æ¨¡å¼**ï¼šåˆ›å»ºä¸€ä¸ªé€šç”¨çš„ `ObjectBuilder` ç±»ï¼Œå°† `GameObject` çš„åˆ›å»ºé€»è¾‘ä» `LevelLoader` ä¸­å‰¥ç¦»å‡ºæ¥ã€‚
*   **é‡æ„ä¸è§£è€¦**ï¼šå°† `LevelLoader` é‡æ„ä¸ºâ€œæŒ‡å¯¼è€…(Director)â€ï¼Œä¸“æ³¨äºè§£æåœ°å›¾æ•°æ®å¹¶æŒ‡æŒ¥ `ObjectBuilder` å·¥ä½œï¼Œå®ç°è´£ä»»åˆ†ç¦»ã€‚

## ğŸ¤” å½“å‰ä»£ç çš„é—®é¢˜åœ¨å“ªé‡Œï¼Ÿ

è®©æˆ‘ä»¬ç›´é¢ `SunnyLand` é¡¹ç›®ä¸­æœ€å¤§çš„â€œä»£ç å¼‚å‘³â€æ¥æºï¼š`LevelLoader::loadObjectLayer` å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°é•¿è¾¾è¿‘ 200 è¡Œï¼Œå®ƒå‡ ä¹æ— æ‰€ä¸èƒ½ï¼Œä¹Ÿå› æ­¤è¿åäº†**å•ä¸€èŒè´£åŸåˆ™**ã€‚

å®ƒç›®å‰æ‰¿æ‹…çš„èŒè´£åŒ…æ‹¬ï¼š
1.  è§£æ Tiled å¯¹è±¡å±‚ JSON æ•°æ®ã€‚
2.  åŒºåˆ†è‡ªå®šä¹‰å½¢çŠ¶å¯¹è±¡å’ŒåŸºäºå›¾å—çš„å¯¹è±¡ã€‚
3.  è®¡ç®— `TransformComponent` æ‰€éœ€çš„ä½ç½®ã€æ—‹è½¬å’Œç¼©æ”¾ã€‚
4.  æ ¹æ®å›¾å—ç±»å‹æˆ–è‡ªå®šä¹‰å±æ€§ï¼Œå†³å®šæ˜¯å¦åˆ›å»º `PhysicsComponent` å’Œ `ColliderComponent`ï¼Œå¹¶è¿›è¡Œé…ç½®ã€‚
5.  è§£æè‡ªå®šä¹‰çš„ JSON å­—ç¬¦ä¸²æ¥åˆ›å»ºå’Œé…ç½® `AnimationComponent`ã€‚
6.  è§£æå¦ä¸€ä¸ªè‡ªå®šä¹‰ JSON å­—ç¬¦ä¸²æ¥é…ç½® `AudioComponent`ã€‚
7.  æ ¹æ®å±æ€§åˆ›å»º `HealthComponent`ã€‚
8.  æœ€åï¼Œå°†æ‰€æœ‰è¿™äº›ç»„ä»¶ç»„è£…æˆä¸€ä¸ª `GameObject`ã€‚

è¿™ä¸ªå‡½æ•°å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„â€œ**ä¸Šå¸å‡½æ•°**â€ã€‚å®ƒçš„é—®é¢˜éå¸¸çªå‡ºï¼š

<img src="https://theorhythm.top/gamedev/opt/OPT.011.webp" alt="ç”Ÿæˆå™¨æ¨¡å¼" style="display: block; margin: auto; width: 800px;" />

*   **æéš¾é˜…è¯»å’Œç»´æŠ¤**ï¼šå¦‚æ­¤å¤šçš„ `if-else` å’ŒåµŒå¥—é€»è¾‘ï¼Œè®©ä»»ä½•æƒ³ä¿®æ”¹å®ƒçš„äººéƒ½æœ›è€Œå´ç”Ÿã€‚
*   **é«˜åº¦è€¦åˆ**ï¼š`LevelLoader` å¿…é¡»äº†è§£ `TransformComponent`ã€`PhysicsComponent`ã€`AnimationComponent` ç­‰æ‰€æœ‰ç»„ä»¶çš„åˆ›å»ºç»†èŠ‚ã€‚å¦‚æœæœªæ¥æˆ‘ä»¬æ–°å¢ä¸€ç§ `MagicComponent`ï¼Œå°±å¿…é¡»å›æ¥ä¿®æ”¹ `LevelLoader`ã€‚
*   **æ— æ³•å¤ç”¨**ï¼šè¿™å¥—å¤æ‚çš„ `GameObject` åˆ›å»ºé€»è¾‘è¢«æ­»æ­»åœ°ç„Šåœ¨äº† `LevelLoader` å†…éƒ¨ã€‚å¦‚æœæˆ‘ä»¬æƒ³ä»å…¶ä»–æ•°æ®æºï¼ˆæ¯”å¦‚ä¸€ä¸ªè„šæœ¬æ–‡ä»¶ï¼‰åˆ›å»º `GameObject`ï¼Œå°±æ— æ³•å¤ç”¨è¿™äº›ä»£ç ã€‚

## ğŸ“– ç¬¬ä¸€æ­¥ï¼šå¼•å…¥ç”Ÿæˆå™¨æ¨¡å¼

è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥**ç”Ÿæˆå™¨æ¨¡å¼ (Builder Pattern)**ã€‚

ç”Ÿæˆå™¨æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯**å°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºè¿‡ç¨‹åˆ†è§£ä¸ºä¸€ç³»åˆ—ç®€å•çš„æ­¥éª¤**ã€‚æƒ³è±¡ä¸€ä¸‹ç»„è£…ä¸€å°ç”µè„‘ï¼šä½ ä¸ä¼šåœ¨ä¸€ä¸ªå‡½æ•°é‡ŒåŒæ—¶å¤„ç†é€‰æ‹© CPUã€å®‰è£…å†…å­˜ã€æ’ä¸Šæ˜¾å¡ã€è¿æ¥ç¡¬ç›˜â€¦â€¦è€Œæ˜¯ä¼šæœ‰ä¸€ä¸ªâ€œè£…æœºå¸ˆå‚…â€ï¼ˆç”Ÿæˆå™¨ï¼‰ï¼Œä½ å‘Šè¯‰ä»–é…ç½®å•ï¼ˆæ•°æ®ï¼‰ï¼Œä»–ä¼šä¸€æ­¥æ­¥åœ° `buildCPU()`, `buildMemory()`, `buildGPU()`... æœ€åæŠŠæ•´å°ç”µè„‘ï¼ˆäº§å“ï¼‰äº¤ç»™ä½ ã€‚

<img src="https://theorhythm.top/gamedev/opt/OPT.014.webp" alt="ç”Ÿæˆå™¨æ¨¡å¼2" style="display: block; margin: auto; width: 800px;" />

åœ¨è¿™ä¸ªæ¨¡å¼ä¸­ï¼Œæœ‰å‡ ä¸ªå…³é”®è§’è‰²ï¼š
*   **Product (äº§å“)**ï¼šæˆ‘ä»¬æƒ³è¦åˆ›å»ºçš„å¤æ‚å¯¹è±¡ï¼Œå³ `GameObject`ã€‚
*   **Builder (ç”Ÿæˆå™¨)**ï¼šè´Ÿè´£å…·ä½“æ„å»ºæ­¥éª¤çš„æ¥å£æˆ–æŠ½è±¡ç±»ã€‚æˆ‘ä»¬çš„ `ObjectBuilder` å°†æ‰®æ¼”æ­¤è§’è‰²ã€‚
*   **Director (æŒ‡å¯¼è€…)**ï¼šè´Ÿè´£è°ƒç”¨ç”Ÿæˆå™¨çš„å„ä¸ªæ­¥éª¤æ¥æ„å»ºäº§å“ã€‚é‡æ„åçš„ `LevelLoader` å°†æ‰®æ¼”æ­¤è§’è‰²ã€‚

## ğŸ“– ç¬¬äºŒæ­¥ï¼šåˆ›å»ºé€šç”¨çš„ `ObjectBuilder`

<img src="https://theorhythm.top/gamedev/opt/OPT.012.webp" alt="ç”Ÿæˆå™¨æ¨¡å¼3" style="display: block; margin: auto; width: 800px;" />

æˆ‘ä»¬çš„ç›®æ ‡æ˜¯åˆ›å»ºä¸€ä¸ªä½äº `engine` ç›®å½•ä¸‹çš„ã€é€šç”¨çš„ `ObjectBuilder`ã€‚å®ƒè´Ÿè´£ä» Tiled çš„ JSON æ•°æ®ä¸­æ„å»ºä¸€ä¸ªåŸºç¡€çš„ `GameObject`ï¼ŒåŒ…å«å¼•æ“æä¾›çš„æ‰€æœ‰é€šç”¨ç»„ä»¶ã€‚

### Step 1: å®šä¹‰ `ObjectBuilder` çš„æ¥å£

æˆ‘ä»¬é¦–å…ˆåœ¨ `engine/object/` ç›®å½•ä¸‹åˆ›å»º `object_builder.h` å’Œ `object_builder.cpp`ã€‚

**`src/engine/object/object_builder.h` (æ–°å»º)**
```cpp
#pragma once
#include "../component/tilelayer_component.h"
#include <string>
#include <memory>
#include <nlohmann/json_fwd.hpp>
#include <glm/vec2.hpp>

namespace engine::core {
    class Context;
}
namespace engine::scene {
    class LevelLoader;
}
namespace engine::object {
    class GameObject;

class ObjectBuilder {
private:
    engine::scene::LevelLoader& level_loader_;
    engine::core::Context& context_;
    std::unique_ptr<GameObject> game_object_;

    // --- è§£ææ¸¸æˆå¯¹è±¡æ‰€éœ€è¦çš„å…³é”®ä¿¡æ¯ ---
    const nlohmann::json* object_json_ = nullptr;
    const nlohmann::json* tile_json_ = nullptr;
    engine::component::TileInfo tile_info_;

    // ... å…¶ä»–ç§æœ‰æˆå‘˜ ...

public:
    explicit ObjectBuilder(engine::scene::LevelLoader& level_loader, engine::core::Context& context);
    virtual ~ObjectBuilder() = default;

    // --- ä¸‰ä¸ªå…³é”®æ–¹æ³•ï¼šé…ç½®ã€æ„å»ºã€è¿”å› ---
    ObjectBuilder* configure(const nlohmann::json* object_json);
    ObjectBuilder* configure(const nlohmann::json* object_json,
                             const nlohmann::json* tile_json,
                             engine::component::TileInfo);
    void build();
    std::unique_ptr<GameObject> getGameObject();

private:
    void reset();

    // --- å°†åŸå…ˆåœ¨LevelLoaderä¸­çš„é€»è¾‘æ‹†åˆ†æˆç§æœ‰æ–¹æ³• ---
    void buildBase();
    void buildTransform();
    void buildSprite();
    void buildPhysics();
    void buildAnimation();
    void buildAudio();
    void buildHealth();
};

} // namespace engine::object
```

è¿™ä¸ªå¤´æ–‡ä»¶å®šä¹‰äº†ç”Ÿæˆå™¨çš„ç»“æ„ï¼š
*   å®ƒæŒæœ‰ `LevelLoader` å’Œ `Context` çš„å¼•ç”¨ï¼Œå› ä¸ºæ„å»ºè¿‡ç¨‹éœ€è¦å®ƒä»¬ã€‚
*   `configure()` æ–¹æ³•ç”¨äºæ¥æ”¶æ„å»ºæ‰€éœ€çš„åŸå§‹æ•°æ®ï¼ˆJSONå¯¹è±¡ï¼‰ï¼Œå®ƒè¿”å› `ObjectBuilder*` ä»¥æ”¯æŒ**é“¾å¼è°ƒç”¨** (Fluent Interface)ã€‚æˆ‘ä»¬ä¸ºè‡ªå®šä¹‰å½¢çŠ¶å’Œå›¾å—å¯¹è±¡æä¾›äº†ä¸åŒçš„é‡è½½ã€‚
*   `build()` æ–¹æ³•æ˜¯æ ¸å¿ƒï¼Œå®ƒä¼šæŒ‰ç…§é¡ºåºæ‰§è¡Œä¸€ç³»åˆ—ç§æœ‰çš„ `build...()` æ­¥éª¤ã€‚
*   `getGameObject()` ç”¨äºåœ¨æ„å»ºå®Œæˆåè·å–æœ€ç»ˆçš„äº§å“ã€‚
*   `reset()` æ–¹æ³•ç”¨äºæ¸…ç©ºä¸Šä¸€æ¬¡æ„å»ºçš„æ•°æ®ï¼Œç¡®ä¿æ¯æ¬¡æ„å»ºéƒ½æ˜¯ç‹¬ç«‹çš„ã€‚

### Step 2: å®ç° `ObjectBuilder` çš„æ„å»ºé€»è¾‘

ç°åœ¨ï¼Œæˆ‘ä»¬å°† `LevelLoader::loadObjectLayer` ä¸­åºæ‚çš„é€»è¾‘ï¼Œåˆ†é—¨åˆ«ç±»åœ°è¿ç§»åˆ° `ObjectBuilder` çš„å„ä¸ª `build...()` æ–¹æ³•ä¸­ã€‚

**`src/engine/object/object_builder.cpp` (æ–°å»º)**
```cpp
#include "object_builder.h"
#include "game_object.h"
// ... å…¶ä»–ç»„ä»¶å¤´æ–‡ä»¶ ...

namespace engine::object {

ObjectBuilder::ObjectBuilder(engine::scene::LevelLoader& level_loader, engine::core::Context& context)
    : level_loader_(level_loader), context_(context) {}

// ... configure, getGameObject, reset æ–¹æ³•çš„å®ç° ...

void ObjectBuilder::build()
{
    if (!object_json_) return;
    // æŒ‰é¡ºåºæ„å»ºå„ä¸ªç»„ä»¶
    buildBase();
    buildTransform();
    buildSprite();
    buildPhysics();
    buildAnimation();
    buildAudio();
    buildHealth();
}

// --- æŒ‘é€‰éƒ¨åˆ† build...() æ–¹æ³•å±•ç¤º ---

void ObjectBuilder::buildBase()
{
    name_ = object_json_->value("name", "");
    auto tag = level_loader_.getTileProperty<std::string>(*object_json_, "tag");
    if (!tag && tile_json_) {
        tag = level_loader_.getTileProperty<std::string>(*tile_json_, "tag");
        if (!tag && tile_info_.type == engine::component::TileType::HAZARD) {
            tag = "hazard";
        }
    }
    game_object_ = std::make_unique<GameObject>(name_, tag.value_or(""));
}

void ObjectBuilder::buildTransform()
{
    auto position = glm::vec2(object_json_->value("x", 0.0f), object_json_->value("y", 0.0f));
    dst_size_ = glm::vec2(object_json_->value("width", 0.0f), object_json_->value("height", 0.0f));
    auto rotation = object_json_->value("rotation", 0.0f);
    auto scale = glm::vec2(1.0f);
    
    if (tile_json_) {
        position = glm::vec2(position.x, position.y - dst_size_.y);
        auto src_size_opt = tile_info_.sprite.getSourceRect();
        if (src_size_opt) {
            src_size_ = glm::vec2(src_size_opt->w, src_size_opt->h);
            scale = dst_size_ / src_size_;
        }   
    }
    game_object_->addComponent<engine::component::TransformComponent>(position, scale, rotation);
}

// ... å…¶ä»– build...() æ–¹æ³•çš„å®ç°ï¼Œéƒ½æ˜¯ä» LevelLoader è¿ç§»è¿‡æ¥çš„é€»è¾‘ ...

} // namespace engine::object
```
`build()` æ–¹æ³•å°±åƒä¸€ä¸ªæ–½å·¥è“å›¾ï¼Œæ¸…æ™°åœ°å®šä¹‰äº† `GameObject` çš„ç»„è£…é¡ºåºã€‚è€Œæ¯ä¸ª `build...()` æ–¹æ³•éƒ½åªä¸“æ³¨äºåˆ›å»ºä¸€ä¸ªç‰¹å®šçš„ç»„ä»¶ã€‚è¿™ç§ç»“æ„æ¸…æ™°ã€æ˜“äºç†è§£å’Œæ‰©å±•ã€‚

> **ä»£ç ç»†èŠ‚**
> æ³¨æ„åˆ° `SpriteComponent` çš„æ„é€ å‡½æ•°ç­¾åä» `Sprite&&` (å³å€¼å¼•ç”¨) å˜æˆäº† `Sprite` (å€¼ä¼ é€’)ã€‚
> ```cpp
> // æ—§
> SpriteComponent(engine::render::Sprite&& sprite, ...);
> // æ–°
> SpriteComponent(engine::render::Sprite sprite, ...);
> ```
> è¿™æ˜¯å› ä¸ºåœ¨ `ObjectBuilder` ä¸­ï¼Œ`tile_info_` æ˜¯ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œæˆ‘ä»¬ä¸èƒ½ `std::move` ä¸€ä¸ªæˆå‘˜å˜é‡çš„ä¸€éƒ¨åˆ†ã€‚é€šè¿‡æ”¹ä¸ºå€¼ä¼ é€’ï¼ŒC++ ä¼šè‡ªåŠ¨è°ƒç”¨ `Sprite` çš„æ‹·è´æ„é€ å‡½æ•°ã€‚ç”±äº `Sprite` æ˜¯ä¸€ä¸ªå¾ˆå°çš„æ•°æ®ç»“æ„ï¼ˆä¸€ä¸ªå­—ç¬¦ä¸²ã€ä¸€ä¸ªå¯é€‰çš„`SDL_FRect`å’Œä¸€ä¸ªå¸ƒå°”å€¼ï¼‰ï¼Œè¿™ç§æ‹·è´çš„å¼€é”€å¾®ä¹å…¶å¾®ï¼Œä½†å´ç®€åŒ–äº† Builder å†…éƒ¨çš„é€»è¾‘ã€‚

## ğŸ“– ç¬¬ä¸‰æ­¥ï¼šé‡æ„ `LevelLoader`ï¼Œè®©å®ƒæˆä¸ºâ€œæŒ‡å¯¼è€…â€

ç°åœ¨ `ObjectBuilder` å·²ç»å‡†å¤‡å°±ç»ªï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ `LevelLoader::loadObjectLayer` è¿›è¡Œå¤§åˆ€é˜”æ–§çš„é‡æ„äº†ã€‚

**`src/engine/scene/level_loader.h`**
```cpp
// ...
namespace engine::object {
class ObjectBuilder;
}
// ...
class LevelLoader final {
    friend class engine::object::ObjectBuilder; // å…è®¸ ObjectBuilder è®¿é—®å…¶ç§æœ‰æ–¹æ³•
    // ...
private:
    // ...
    // æ·»åŠ å¯¹ ObjectBuilder çš„å‹å…ƒå£°æ˜ï¼Œä»¥ä¾¿å®ƒèƒ½è°ƒç”¨ getTileProperty ç­‰è¾…åŠ©å‡½æ•°
    void addAnimation(const nlohmann::json& anim_json, engine::component::AnimationComponent* ac, const glm::vec2& sprite_size);
    void addSound(const nlohmann::json& sound_json, engine::component::AudioComponent* audio_component);
    // ...
};
```

**`src/engine/scene/level_loader.cpp`**
```cpp
#include "level_loader.h"
#include "../object/object_builder.h" // åŒ…å«å¤´æ–‡ä»¶
// ...

void LevelLoader::loadObjectLayer(const nlohmann::json& layer_json, Scene& scene)
{
    if (!layer_json.contains("objects") || !layer_json["objects"].is_array()) {
        // ... é”™è¯¯å¤„ç† ...
        return;
    }
    // 1. åˆ›å»ºå¯¹è±¡ç”Ÿæˆå™¨
    engine::object::ObjectBuilder object_builder(*this, scene.getContext());

    const auto& objects = layer_json["objects"];
    for (const auto& object : objects) {
        auto gid = object.value("gid", 0);
        if (gid == 0) { // è‡ªå®šä¹‰å½¢çŠ¶
            // 2. é…ç½®å¹¶æ„å»º
            object_builder.configure(&object)->build();
        } else { // å›¾å—å¯¹è±¡
            auto tile_json = getTileJsonByGid(gid);
            auto tile_info = getTileInfoByGid(gid);
            if (!tile_json || !tile_json->is_object()) {
                // ... é”™è¯¯å¤„ç† ...
                continue;
            }
            // 2. é…ç½®å¹¶æ„å»º
            object_builder.configure(&object, &tile_json.value(), tile_info)->build();
        }
        
        // 3. è·å–äº§å“å¹¶æ·»åŠ åˆ°åœºæ™¯
        auto game_object = object_builder.getGameObject();
        if (game_object) {
            spdlog::info("åŠ è½½å¯¹è±¡: '{}' å®Œæˆ", game_object->getName());
            scene.addGameObject(std::move(game_object));
        }
    }
}
```

çœ‹ï¼`loadObjectLayer` å‡½æ•°ç°åœ¨å˜å¾—å¤šä¹ˆæ¸…çˆ½ï¼å®ƒçš„èŒè´£å˜å¾—éå¸¸çº¯ç²¹ï¼š
1.  éå† Tiled çš„ `objects` æ•°ç»„ã€‚
2.  å‡†å¤‡å¥½æ„å»ºæ‰€éœ€çš„æ•°æ®ï¼ˆ`object_json`, `tile_json`, `tile_info`ï¼‰ã€‚
3.  è°ƒç”¨ `object_builder` çš„ `configure()` å’Œ `build()`ã€‚
4.  ä» `object_builder` è·å–æ„å»ºå®Œæˆçš„ `GameObject` å¹¶å°†å…¶æ·»åŠ åˆ°åœºæ™¯ä¸­ã€‚

å®ƒä¸å†å…³å¿ƒ `GameObject` å†…éƒ¨æ˜¯å¦‚ä½•æ„æˆçš„ï¼Œå®Œå…¨å°†å¤æ‚çš„æ„å»ºè¿‡ç¨‹å§”æ‰˜ç»™äº† `ObjectBuilder`ã€‚`LevelLoader` æˆåŠŸè½¬å‹ä¸ºä¸€ååˆæ ¼çš„â€œæŒ‡å¯¼è€…(Director)â€ã€‚

## âœ¨ å°ç»“ (Part 1)

åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬æˆåŠŸåœ°è¿ç”¨äº†**ç”Ÿæˆå™¨æ¨¡å¼**ï¼Œå®Œæˆäº†ä¸€æ¬¡æ¼‚äº®çš„ä»£ç é‡æ„ï¼š

*   æˆ‘ä»¬å°†ä¸€ä¸ªå·¨å¤§ã€å¤æ‚çš„ `loadObjectLayer` å‡½æ•°åˆ†è§£äº†ã€‚
*   åˆ›å»ºäº†ä¸€ä¸ªä¸“èŒäº `GameObject` æ„å»ºçš„ `ObjectBuilder` ç±»ï¼Œå°è£…äº†æ‰€æœ‰çš„æ„å»ºç»†èŠ‚å’Œæ­¥éª¤ã€‚
*   `LevelLoader` çš„èŒè´£è¢«ç®€åŒ–ï¼Œåªè´Ÿè´£è§£æåœ°å›¾ç»“æ„å’ŒæŒ‡å¯¼ `ObjectBuilder` å·¥ä½œã€‚
*   ä»£ç çš„**å¯è¯»æ€§**ã€**å¯ç»´æŠ¤æ€§**å’Œ**æ¨¡å—åŒ–**ç¨‹åº¦éƒ½å¾—åˆ°äº†æå¤§çš„æå‡ã€‚

ç„¶è€Œï¼Œæˆ‘ä»¬å½“å‰çš„ `ObjectBuilder` ä½äº `engine` ç›®å½•ä¸­ï¼Œå®ƒæ˜¯ä¸€ä¸ª**é€šç”¨**çš„ç”Ÿæˆå™¨ã€‚å®ƒä¸åº”è¯¥ï¼Œä¹Ÿä¸èƒ½çŸ¥é“ä»»ä½•ä¸ `SunnyLand` è¿™ä¸ªå…·ä½“æ¸¸æˆç›¸å…³çš„é€»è¾‘ï¼Œæ¯”å¦‚ `PlayerComponent`ã€æ•Œäºº AI çš„å…·ä½“è¡Œä¸º (`PatrolBehavior` ç­‰)ã€‚

åœ¨ä¸‹ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†æ¢è®¨å¦‚ä½•æ‰©å±•è¿™ä¸ªåŸºç¡€ç”Ÿæˆå™¨ï¼Œä¼˜é›…åœ°æ³¨å…¥ç‰¹å®šäºæ¸¸æˆçš„æ„å»ºé€»è¾‘ï¼Œä»è€Œå®Œæˆæ•´ä¸ªé‡æ„ã€‚

---

åœ¨ä¸Šä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬æˆåŠŸåˆ›å»ºäº†ä¸€ä¸ªé€šç”¨çš„ `ObjectBuilder`ï¼Œå°† `GameObject` çš„åŸºæœ¬æ„å»ºé€»è¾‘ä» `LevelLoader` ä¸­åˆ†ç¦»äº†å‡ºæ¥ã€‚

ç„¶è€Œï¼Œæˆ‘ä»¬ç•™ä¸‹äº†ä¸€ä¸ªæ‚¬å¿µï¼šè¿™ä¸ªé€šç”¨çš„ `ObjectBuilder` ä½äºå¼•æ“å±‚ï¼Œå®ƒä¸çŸ¥é“ä»»ä½•å…³äºã€ŠSunnyLandã€‹å…·ä½“æ¸¸æˆé€»è¾‘ï¼Œæ¯”å¦‚ç©å®¶ (`PlayerComponent`)ã€æ•ŒäººAI (`AIComponent` + å…·ä½“è¡Œä¸º) ç­‰ã€‚æˆ‘ä»¬å¦‚ä½•å°†è¿™äº›ç‰¹å®šäºæ¸¸æˆçš„æ„å»ºæ­¥éª¤ä¼˜é›…åœ°é›†æˆè¿›å»å‘¢ï¼Ÿ

è¿™å°±æ˜¯æœ¬èŠ‚è¯¾çš„é‡ç‚¹ï¼š**é€šè¿‡ç»§æ‰¿æ¥æ‰©å±•ç”Ÿæˆå™¨**ã€‚

---

# Part 2: ç»§æ‰¿ä¸æ‰©å±•

## ğŸ¯ è¯¾ç¨‹ç›®æ ‡

*   **ç†è§£ç”Ÿæˆå™¨æ¨¡å¼çš„æ‰©å±•æ€§**ï¼šå­¦ä¹ å¦‚ä½•é€šè¿‡ç»§æ‰¿æ¥åˆ›å»ºä¸€ä¸ªä¸“é—¨é’ˆå¯¹ç‰¹å®šæ¸¸æˆï¼ˆã€ŠSunnyLandã€‹ï¼‰çš„ç”Ÿæˆå™¨ã€‚
*   **å®ç°ç‰¹å®šæ¸¸æˆçš„ç”Ÿæˆå™¨**ï¼šåˆ›å»ºä¸€ä¸ª `ObjectBuilderSL` ç±»ï¼Œå®ƒç»§æ‰¿è‡ªé€šç”¨çš„ `ObjectBuilder`ï¼Œå¹¶æ·»åŠ æ„å»ºç©å®¶ã€æ•Œäººå’Œé“å…·ç­‰æ¸¸æˆç‰¹å®šç»„ä»¶çš„é€»è¾‘ã€‚
*   **å®Œæˆæœ€ç»ˆé‡æ„**ï¼šå°†æ–°çš„ `ObjectBuilderSL` æ³¨å…¥åˆ° `LevelLoader` ä¸­ï¼Œå½»åº•æ¶ˆé™¤ `GameScene` ä¸­æ®‹ç•™çš„å¯¹è±¡åˆå§‹åŒ–é€»è¾‘ï¼Œå®ç° `GameObject` åˆ›å»ºçš„å®Œå…¨è‡ªåŠ¨åŒ–å’Œæ•°æ®é©±åŠ¨ã€‚

## ğŸ“– ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæ¸¸æˆä¸“å±ç”Ÿæˆå™¨ `ObjectBuilderSL`

æˆ‘ä»¬çš„æ€è·¯æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ç”Ÿæˆå™¨ `ObjectBuilderSL` (SL for SunnyLand)ï¼Œå®ƒç»§æ‰¿è‡ªé€šç”¨çš„ `engine::object::ObjectBuilder`ã€‚è¿™ä¸ªå­ç±»å°†é‡å†™ `build()` æ–¹æ³•ï¼Œåœ¨è°ƒç”¨çˆ¶ç±»é€šç”¨çš„æ„å»ºæ­¥éª¤ä¹‹åï¼Œå†è¿½åŠ è‡ªå·±ç‹¬æœ‰çš„ã€ä¸æ¸¸æˆé€»è¾‘ç›¸å…³çš„æ„å»ºæ­¥éª¤ã€‚

<img src="https://theorhythm.top/gamedev/opt/OPT.013.webp" alt="ç”Ÿæˆå™¨æ¨¡å¼4" style="display: block; margin: auto; width: 800px;" />

### Step 1: æ”¹é€ åŸºç±» `ObjectBuilder`

ä¸ºäº†è®©å­ç±»èƒ½å¤Ÿè®¿é—® `LevelLoader` çš„ç§æœ‰è¾…åŠ©å‡½æ•°ï¼ˆå¦‚ `getTileProperty`ï¼‰å¹¶é¡ºåˆ©åœ°è¿›è¡Œæ‰©å±•ï¼Œæˆ‘ä»¬éœ€è¦å¯¹åŸºç±»åšä¸€äº›è°ƒæ•´ã€‚

1.  å°† `ObjectBuilder` çš„ç§æœ‰æˆå‘˜ (`private`) è°ƒæ•´ä¸ºä¿æŠ¤æˆå‘˜ (`protected`)ï¼Œè¿™æ ·å­ç±»å°±å¯ä»¥è®¿é—®å®ƒä»¬ã€‚
2.  å°† `build()` æ–¹æ³•å£°æ˜ä¸º `virtual`ï¼Œå…è®¸å­ç±»é‡å†™å®ƒã€‚
3.  æ·»åŠ ä¸€äº›â€œä»£ç†å‡½æ•°â€ï¼Œè®©å­ç±»å¯ä»¥é€šè¿‡ `ObjectBuilder` é—´æ¥è°ƒç”¨ `LevelLoader` çš„ç§æœ‰è¾…åŠ©å‡½æ•°ã€‚

**`src/engine/object/object_builder.h` (ä¿®æ”¹)**
```cpp
// ...
class ObjectBuilder {
protected: // æ”¹ä¸º protected
    engine::scene::LevelLoader& level_loader_;
    engine::core::Context& context_;
    // ... å…¶ä»–æˆå‘˜ ...

public:
    // ...
    virtual void build(); // å£°æ˜ä¸ºè™šå‡½æ•°
    // ...
protected: // æ–°å¢
    // --- ä»£ç†å‡½æ•°ï¼Œè®©å­ç±»èƒ½è·å–åˆ°LevelLoaderçš„ç§æœ‰æ–¹æ³• ---
    template<typename T>
    std::optional<T> getTileProperty(const nlohmann::json& tile_json, std::string_view property_name);
    engine::component::TileType getTileType(const nlohmann::json& tile_json);
    std::optional<engine::utils::Rect> getColliderRect(const nlohmann::json& tile_json);
    void addAnimation(const nlohmann::json& anim_json, engine::component::AnimationComponent* ac, const glm::vec2& sprite_size);
    void addSound(const nlohmann::json& sound_json, engine::component::AudioComponent* audio_component);
    // ...
};
```

**`src/engine/object/object_builder.cpp` (ä¿®æ”¹)**
```cpp
// ...
// --- å®ç°ä»£ç†å‡½æ•° ---
template<typename T>
std::optional<T> ObjectBuilder::getTileProperty(const nlohmann::json& tile_json, std::string_view property_name) {
    return level_loader_.getTileProperty<T>(tile_json, property_name);
}
// ... å…¶ä»–ä»£ç†å‡½æ•°çš„å®ç° ...
```

### Step 2: åˆ›å»º `ObjectBuilderSL`

ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨ `game/object/` ç›®å½•ä¸‹åˆ›å»º `object_builder_sl.h` å’Œ `object_builder_sl.cpp`ã€‚

**`src/game/object/object_builder_sl.h` (æ–°å»º)**
```cpp
#pragma once
#include "../../engine/object/object_builder.h"

namespace game::object {

/**
 * @brief é’ˆå¯¹å…·ä½“æ¸¸æˆçš„å¯¹è±¡ç”Ÿæˆå™¨ï¼Œç»§æ‰¿è‡ª engine::object::ObjectBuilderã€‚
 *        æ·»åŠ æ¸¸æˆä¸­çš„ç©å®¶ã€æ•Œäººã€ç‰©å“ç­‰å¯¹è±¡çš„ç›¸å…³ç»„ä»¶ã€‚
 */
class ObjectBuilderSL final : public engine::object::ObjectBuilder {
public:
    ObjectBuilderSL(engine::scene::LevelLoader& level_loader, engine::core::Context& context);
    ~ObjectBuilderSL() = default;

    void build() override; // é‡å†™çˆ¶ç±»çš„ build æ–¹æ³•

private:
    // --- é’ˆå¯¹å…·ä½“æ¸¸æˆæ–°æ·»åŠ çš„æ­¥éª¤ ---
    void buildPlayer();
    void buildEnemy();
    void buildItem();
};

}   // namespace game::object
```

### Step 3: å®ç° `ObjectBuilderSL` çš„æ„å»ºé€»è¾‘

`ObjectBuilderSL` çš„ `build()` æ–¹æ³•é¦–å…ˆè°ƒç”¨çˆ¶ç±»çš„ `build()` æ¥å®Œæˆé€šç”¨ç»„ä»¶çš„æ„å»ºï¼Œç„¶åä¾æ¬¡è°ƒç”¨è‡ªå·±ç‰¹æœ‰çš„ `buildPlayer()`, `buildEnemy()` ç­‰æ–¹æ³•ã€‚

**`src/game/object/object_builder_sl.cpp` (æ–°å»º)**
```cpp
#include "object_builder_sl.h"
#include "../../engine/object/game_object.h"
// ... åŒ…å« PlayerComponent, AIComponent, å„ç§ Behavior ç­‰å¤´æ–‡ä»¶ ...

namespace game::object {

ObjectBuilderSL::ObjectBuilderSL(engine::scene::LevelLoader& level_loader, engine::core::Context& context)
    : engine::object::ObjectBuilder(level_loader, context) {}

void ObjectBuilderSL::build() {
    ObjectBuilder::build(); // 1. å…ˆè°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œæ„å»ºé€šç”¨ç»„ä»¶
    
    // 2. å†è°ƒç”¨å­ç±»ç‰¹æœ‰çš„æ–¹æ³•ï¼Œæ„å»ºæ¸¸æˆç‰¹å®šç»„ä»¶
    buildPlayer();
    buildEnemy();
    buildItem();
}

void ObjectBuilderSL::buildPlayer() {
    if (!tile_json_ || name_ != "player") return; // å¦‚æœä¸æ˜¯åä¸º "player" çš„å›¾å—å¯¹è±¡ï¼Œåˆ™ä¸åšä»»ä½•äº‹
    
    if (auto* player_component = game_object_->addComponent<game::component::PlayerComponent>(); player_component) {
        if (auto* transform = game_object_->getComponent<engine::component::TransformComponent>(); transform) {
            context_.getCamera().setTarget(transform);  // ç›¸æœºè·Ÿéšç©å®¶
        }
    }
}

void ObjectBuilderSL::buildEnemy() {
    if (!tile_json_ || game_object_->getTag() != "enemy") return; // å¦‚æœä¸æ˜¯æ ‡ç­¾ä¸º "enemy" çš„å›¾å—å¯¹è±¡ï¼Œåˆ™è·³è¿‡
    
    if (name_ == "eagle") {
        if (auto* ai_component = game_object_->addComponent<game::component::AIComponent>(); ai_component) {
            auto y_max = game_object_->getComponent<engine::component::TransformComponent>()->getPosition().y;
            auto y_min = y_max - 80.0f;
            ai_component->setBehavior(std::make_unique<game::component::ai::UpDownBehavior>(y_min, y_max));
        }
    } else if (name_ == "frog") {
        // ... ä¸º frog æ·»åŠ  JumpBehavior ...
    } else if (name_ == "opossum") {
        // ... ä¸º opossum æ·»åŠ  PatrolBehavior ...
    }
}

void ObjectBuilderSL::buildItem() {
    if (!tile_json_ || game_object_->getTag() != "item") return;
    
    // ä¸ºæ‰€æœ‰ item å¯¹è±¡æ’­æ”¾ "idle" åŠ¨ç”»
    if (auto* ac = game_object_->addComponent<engine::component::AnimationComponent>(); ac) {
        ac->playAnimation("idle");
    }
}

}   // namespace game::object
```
çœ‹ï¼æˆ‘ä»¬å°†ä¹‹å‰ `GameScene::initEnemyAndItem()` å’Œ `GameScene::initPlayer()` ä¸­çš„é€»è¾‘ï¼Œå®Œç¾åœ°è¿ç§»åˆ°äº†è¿™ä¸ªä¸“é—¨çš„ç”Ÿæˆå™¨ç±»ä¸­ã€‚æ¯ä¸ª `build...()` æ–¹æ³•èŒè´£å•ä¸€ï¼Œä»£ç æ¸…æ™°ã€‚

## ğŸ“– ç¬¬äºŒæ­¥ï¼šå°† `ObjectBuilderSL` æ³¨å…¥ `LevelLoader`

ç°åœ¨æˆ‘ä»¬æœ‰äº†æ›´å¼ºå¤§çš„ã€é’ˆå¯¹ã€ŠSunnyLandã€‹çš„ `ObjectBuilderSL`ï¼Œæˆ‘ä»¬éœ€è¦è®© `LevelLoader` ä½¿ç”¨å®ƒï¼Œè€Œä¸æ˜¯é»˜è®¤çš„é€šç”¨ `ObjectBuilder`ã€‚

### Step 1: ä¿®æ”¹ `LevelLoader` ä»¥æ¥å—è‡ªå®šä¹‰ç”Ÿæˆå™¨

`LevelLoader` åº”è¯¥æŒæœ‰ä¸€ä¸ª `ObjectBuilder` çš„**åŸºç±»æŒ‡é’ˆ**ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨è¿è¡Œæ—¶ç»™å®ƒæä¾›ä»»ä½• `ObjectBuilder` çš„å­ç±»å®ä¾‹ã€‚

**`src/engine/scene/level_loader.h` (ä¿®æ”¹)**
```cpp
// ...
class LevelLoader final {
    // ...
private:
    // ...
    std::unique_ptr<engine::object::ObjectBuilder> object_builder_; // æŒæœ‰åŸºç±»æŒ‡é’ˆ

public:
    LevelLoader(engine::core::Context& context); // æ„é€ æ—¶åˆ›å»ºé»˜è®¤ builder
    ~LevelLoader();

    // æä¾›ä¸€ä¸ªæ–¹æ³•æ¥æ›¿æ¢é»˜è®¤çš„ builder
    void setObjectBuilder(std::unique_ptr<engine::object::ObjectBuilder> object_builder);
    // ...
};
```
**`src/engine/scene/level_loader.cpp` (ä¿®æ”¹)**
```cpp
// ...
LevelLoader::LevelLoader(engine::core::Context& context)
 : object_builder_(std::make_unique<engine::object::ObjectBuilder>(*this, context)){
    // æ„é€ æ—¶ï¼Œé»˜è®¤åˆ›å»ºä¸€ä¸ªé€šç”¨çš„ ObjectBuilder
}

void LevelLoader::setObjectBuilder(std::unique_ptr<engine::object::ObjectBuilder> object_builder) {
    // å…è®¸å¤–éƒ¨ä¼ å…¥ä¸€ä¸ªæ›´å…·ä½“çš„ builder æ¥æ›¿æ¢å®ƒ
    object_builder_ = std::move(object_builder);
}
// ...
void LevelLoader::loadObjectLayer(...) {
    // ...
    // ä¸å†åœ¨å‡½æ•°å†…éƒ¨åˆ›å»º builderï¼Œè€Œæ˜¯ä½¿ç”¨æˆå‘˜å˜é‡ object_builder_
    // engine::object::ObjectBuilder object_builder(*this, scene.getContext());
    // ...
    // ä½¿ç”¨æˆå‘˜å˜é‡è¿›è¡Œé…ç½®å’Œæ„å»º
    object_builder_->configure(&object)->build();
    // ...
}
```

### Step 2: åœ¨ `GameScene` ä¸­å®Œæˆæ³¨å…¥

æœ€åï¼Œåœ¨ `GameScene::initLevel()` ä¸­ï¼Œæˆ‘ä»¬åœ¨åŠ è½½å…³å¡ä¹‹å‰ï¼Œå°†æˆ‘ä»¬ç‰¹åˆ¶çš„ `ObjectBuilderSL` â€œæ³¨å…¥â€åˆ° `LevelLoader` ä¸­ã€‚

**`src/game/scene/game_scene.cpp` (ä¿®æ”¹)**
```cpp
#include "../object/object_builder_sl.h" // åŒ…å«æ–°çš„ builder å¤´æ–‡ä»¶

// ...

bool GameScene::initLevel()
{
    // åˆ›å»ºå…³å¡åŠ è½½å™¨
    engine::scene::LevelLoader level_loader(context_);

    // åˆ›å»ºæˆ‘ä»¬æ¸¸æˆä¸“å±çš„ç”Ÿæˆå™¨
    auto builder = std::make_unique<game::object::ObjectBuilderSL>(level_loader, context_);
    // å°†å®ƒè®¾ç½®ç»™ level_loaderï¼Œæ›¿æ¢æ‰é»˜è®¤çš„é€šç”¨ç”Ÿæˆå™¨
    level_loader.setObjectBuilder(std::move(builder)); 
    
    // åŠ è½½å…³å¡ï¼ˆæ­¤æ—¶ level_loader å†…éƒ¨ä¼šä½¿ç”¨æˆ‘ä»¬æä¾›çš„ ObjectBuilderSLï¼‰
    auto level_path = game_session_data_->getMapPath();
    if (!level_loader.loadLevel(level_path, *this)){
        // ...
    }
    // ...
    return true;
}

bool GameScene::initPlayer()
{
    // è·å–ç©å®¶å¯¹è±¡
    player_ = findGameObjectByName("player");
    if (!player_) { /*...*/ }
    
    // ä» SessionData ä¸­æ›´æ–°ç©å®¶ç”Ÿå‘½å€¼
    if (auto health_component = player_->getComponent<engine::component::HealthComponent>(); health_component) {
        health_component->setMaxHealth(game_session_data_->getMaxHealth());
        health_component->setCurrentHealth(game_session_data_->getCurrentHealth());
    }
    // ...
    return true;
}
```
åŒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ `GameScene` ä¸­çš„ `initEnemyAndItem()` æ–¹æ³•ä»¥åŠå®ƒçš„è°ƒç”¨å½»åº•åˆ é™¤äº†ï¼Œå› ä¸ºå®ƒçš„æ‰€æœ‰é€»è¾‘ç°åœ¨éƒ½å·²ç»è¢« `ObjectBuilderSL` è‡ªåŠ¨å¤„ç†äº†ï¼

è‡³æ­¤ï¼Œ`GameObject` çš„åˆ›å»ºè¿‡ç¨‹è¢«å®Œå…¨é‡æ„ã€‚`GameScene` ä¸å†å…³å¿ƒä»»ä½•å…³äºç©å®¶ã€æ•Œäººæˆ–ç‰©å“å¦‚ä½•åˆå§‹åŒ–çš„ç»†èŠ‚ã€‚å®ƒåªéœ€è¦å‘½ä»¤ `LevelLoader` åŠ è½½å…³å¡ï¼Œ`LevelLoader` ä¼šæŒ‡æŒ¥ `ObjectBuilderSL` ç²¾ç¡®åœ°æ„å»ºå‡ºæ‰€æœ‰éœ€è¦çš„å¯¹è±¡ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°åœºæ™¯ä¸­ã€‚æ•´ä¸ªæµç¨‹å®ç°äº†å®Œç¾çš„æ•°æ®é©±åŠ¨å’Œè´£ä»»åˆ†ç¦»ã€‚

## âœ¨ æ€»ç»“

é€šè¿‡ä¸¤éƒ¨åˆ†çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å½»åº•é‡æ„äº† `GameObject` çš„åˆ›å»ºæµç¨‹ï¼Œå®ç°äº†ç”Ÿæˆå™¨æ¨¡å¼çš„ç»å…¸åº”ç”¨ï¼š

*   **åˆ†è§£å¤æ‚æ€§**ï¼šæˆ‘ä»¬å°†ä¸€ä¸ªå·¨å¤§çš„å‡½æ•°åˆ†è§£ä¸ºä¸€ç³»åˆ—æ¸…æ™°ã€ç‹¬ç«‹çš„æ„å»ºæ­¥éª¤ï¼Œå°è£…åœ¨ `ObjectBuilder` ä¸­ã€‚
*   **è´£ä»»åˆ†ç¦» (SoC)**ï¼š`LevelLoader` (Director) è´Ÿè´£â€œä½•æ—¶â€ä¸â€œä»¥ä½•ç§é¡ºåºâ€æ„å»ºï¼Œè€Œ `ObjectBuilder` (Builder) è´Ÿè´£â€œå¦‚ä½•â€æ„å»ºæ¯ä¸ªéƒ¨åˆ†ã€‚
*   **å¯æ‰©å±•æ€§**ï¼šé€šè¿‡ç»§æ‰¿ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ç‰¹å®šäºæ¸¸æˆçš„ `ObjectBuilderSL`ï¼Œåœ¨ä¸ä¿®æ”¹é€šç”¨å¼•æ“ä»£ç çš„æƒ…å†µä¸‹ï¼Œæ·»åŠ äº†æ¸¸æˆé€»è¾‘ç›¸å…³çš„æ„å»ºæ­¥éª¤ã€‚
*   **æ•°æ®é©±åŠ¨**ï¼šç°åœ¨ï¼Œå¯¹è±¡çš„ç»å¤§éƒ¨åˆ†é…ç½®ï¼ˆåŒ…æ‹¬AIè¡Œä¸ºã€åŠ¨ç”»ã€ç”Ÿå‘½å€¼ç­‰ï¼‰éƒ½æ¥è‡ªäº Tiled ç¼–è¾‘å™¨å¯¼å‡ºçš„ JSON æ•°æ®ï¼Œä»£ç ä¸æ•°æ®åˆ†ç¦»ï¼Œå¤§å¤§æé«˜äº†å¼€å‘å’Œè°ƒè¯•æ•ˆç‡ã€‚

ç”Ÿæˆå™¨æ¨¡å¼æ˜¯å¤„ç†å¤æ‚å¯¹è±¡åˆ›å»ºçš„å¼ºå¤§å·¥å…·ã€‚å½“ä½ å‘ç°ä¸€ä¸ªç±»çš„æ„é€ å‡½æ•°å‚æ•°è¿‡å¤šï¼Œæˆ–è€…ä¸€ä¸ªå·¥å‚æ–¹æ³•è¿‡äºè‡ƒè‚¿æ—¶ï¼Œå°±æ˜¯è€ƒè™‘ä½¿ç”¨ç”Ÿæˆå™¨æ¨¡å¼çš„æœ€ä½³æ—¶æœºã€‚