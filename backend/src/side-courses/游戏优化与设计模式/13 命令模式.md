# å‘½ä»¤æ¨¡å¼ (Command)

<div class="video-container">
  <div id="bilibili" class="video-content">
    <iframe
      class="video-frame"
      src="https://player.bilibili.com/player.html?bvid=BV1yap4zREQ9&page=1&autoplay=0&danmaku=0&high_quality=1"
      width="100%"
      height="480"
      scrolling="no"
      frameborder="0"
      allowfullscreen>
    </iframe>
  </div>
</div>

è¿™ä¸€è¯¾æˆ‘ä»¬å°†æ·±å…¥æ¢è®¨**å‘½ä»¤æ¨¡å¼**ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒèƒ½æå¤§åœ°æå‡ä»£ç çš„çµæ´»æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†ç”¨æˆ·è¾“å…¥å’Œéœ€è¦æ’¤é”€/é‡åšåŠŸèƒ½çš„åœºæ™¯ä¸­ã€‚

æœ¬èŠ‚è¯¾åŒæ ·åˆ†ä¸ºä¸¤éƒ¨åˆ†ã€‚åœ¨ç¬¬ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†è¿›è¡Œä¸€æ¬¡é‡è¦çš„**é‡æ„**ï¼šå°†è¾“å…¥å¤„ç†çš„é€»è¾‘ä»åˆ†æ•£çš„ `PlayerState` å­ç±»ä¸­**ä¸Šç§»**åˆ° `PlayerComponent` ä¸­ï¼Œä¸ºå¼•å…¥å‘½ä»¤æ¨¡å¼åšå¥½å‡†å¤‡ã€‚

---

# Part 1: é‡æ„è¾“å…¥å¤„ç†

## ğŸ¯ è¯¾ç¨‹ç›®æ ‡

*   **è¯†åˆ«ç´§è€¦åˆçš„è®¾è®¡**ï¼šåˆ†æå½“å‰ `PlayerState` å­ç±»ç›´æ¥ä¾èµ– `InputManager` å¸¦æ¥çš„é—®é¢˜ã€‚
*   **é‡æ„çŠ¶æ€æœº**ï¼šå°†è¾“å…¥æ£€æµ‹çš„é€»è¾‘ä»å„ä¸ª `PlayerState` å­ç±»ä¸­ç§»é™¤ï¼Œç»Ÿä¸€ä¸Šç§»åˆ° `PlayerComponent` ä¸­ã€‚
*   **å®šä¹‰è¡Œä¸ºæ¥å£**ï¼šåœ¨ `PlayerState` åŸºç±»ä¸­å®šä¹‰ä¸€ç»„ä»£è¡¨ç©å®¶åŠ¨ä½œçš„è™šå‡½æ•°ï¼ˆå¦‚ `moveLeft()`, `jump()`ï¼‰ï¼Œç”±å…·ä½“çš„å­ç±»æ¥å®ç°ã€‚
*   **ä¸ºå‘½ä»¤æ¨¡å¼é“ºè·¯**ï¼šé€šè¿‡è¿™æ¬¡é‡æ„ï¼Œå°†â€œ**æ£€æµ‹è¾“å…¥**â€å’Œâ€œ**æ‰§è¡ŒåŠ¨ä½œ**â€è¿™ä¸¤ä¸ªèŒè´£åˆ†ç¦»å¼€ï¼Œä¸ºä¸‹ä¸€æ­¥å¼•å…¥å‘½ä»¤å¯¹è±¡æ‰“ä¸‹åšå®çš„åŸºç¡€ã€‚

## ğŸ¤” å½“å‰ä»£ç çš„é—®é¢˜åœ¨å“ªé‡Œï¼Ÿ

<img src="https://theorhythm.top/gamedev/opt/OPT.017.webp" alt="å‘½ä»¤æ¨¡å¼1" style="display: block; margin: auto; width: 800px;" />

ç›®å‰ï¼Œæˆ‘ä»¬çš„ç©å®¶çŠ¶æ€æœºè®¾è®¡æ˜¯è¿™æ ·çš„ï¼š`PlayerComponent` çš„ `handleInput` æ–¹æ³•å°†è¾“å…¥å¤„ç†çš„èŒè´£å®Œå…¨**å§”æ‰˜**ç»™äº†å½“å‰çš„ `PlayerState` å¯¹è±¡ã€‚

```cpp
// src/game/component/player_component.cpp (æ—§ä»£ç )
void PlayerComponent::handleInput(engine::core::Context& context) {
    if (!current_state_) return;

    // å°† context (åŒ…å« InputManager) ä¼ é€’ç»™çŠ¶æ€å¯¹è±¡
    auto next_state = current_state_->handleInput(context);
    if (next_state) {
        setState(std::move(next_state));
    }
}
```

æ¯ä¸ªå…·ä½“çš„çŠ¶æ€ç±»ï¼Œæ¯”å¦‚ `IdleState`ï¼Œéƒ½ç›´æ¥ä» `InputManager` æŸ¥è¯¢æŒ‰é”®çŠ¶æ€ï¼Œå¹¶æ®æ­¤å†³å®šæ˜¯å¦åˆ‡æ¢åˆ°å…¶ä»–çŠ¶æ€ã€‚

```cpp
// src/game/component/state/idle_state.cpp (æ—§ä»£ç )
std::unique_ptr<PlayerState> IdleState::handleInput(engine::core::Context& context)
{
    auto input_manager = context.getInputManager();

    // å¦‚æœæŒ‰ä¸‹äº†å·¦å³ç§»åŠ¨é”®ï¼Œåˆ™åˆ‡æ¢åˆ° WalkState
    if (input_manager.isActionDown("move_left") || input_manager.isActionDown("move_right")) {
        return std::make_unique<WalkState>(player_component_);
    }

    // å¦‚æœæŒ‰ä¸‹â€œjumpâ€åˆ™åˆ‡æ¢åˆ° JumpState
    if (input_manager.isActionPressed("jump")) {
        return std::make_unique<JumpState>(player_component_);
    }
    // ...
    return nullptr;
}
```

è¿™ç§è®¾è®¡è™½ç„¶ç›´è§‚ï¼Œä½†å­˜åœ¨å‡ ä¸ªé—®é¢˜ï¼š
1.  **èŒè´£ä¸æ¸…**ï¼š`PlayerState` å­ç±»çš„èŒè´£åº”è¯¥æ˜¯**å®šä¹‰åœ¨ç‰¹å®šçŠ¶æ€ä¸‹ï¼Œæ¥æ”¶åˆ°æŸä¸ªåŠ¨ä½œè¯·æ±‚æ—¶è¯¥å¦‚ä½•å“åº”**ï¼Œè€Œä¸åº”è¯¥å…³å¿ƒè¿™ä¸ªåŠ¨ä½œè¯·æ±‚æ˜¯æ¥è‡ªé”®ç›˜ã€æ‰‹æŸ„è¿˜æ˜¯ç½‘ç»œã€‚å®ƒç›´æ¥ä¸ `InputManager` è€¦åˆï¼Œæ„å‘³ç€å®ƒæ‰¿æ‹…äº†â€œæ£€æµ‹è¾“å…¥â€çš„èŒè´£ï¼Œè¿™è¶…å‡ºäº†å®ƒçš„æ ¸å¿ƒèŒè´£èŒƒå›´ã€‚
2.  **ä»£ç é‡å¤**ï¼š`JumpState`ã€`FallState`ã€`WalkState` ç­‰å¤šä¸ªçŠ¶æ€éƒ½éœ€è¦å¤„ç†å·¦å³ç§»åŠ¨çš„é€»è¾‘ï¼Œå¯¼è‡´ç±»ä¼¼ `input_manager.isActionDown("move_left")` è¿™æ ·çš„ä»£ç åœ¨å¤šä¸ªæ–‡ä»¶ä¸­é‡å¤å‡ºç°ã€‚
3.  **æ‰©å±•å›°éš¾**ï¼šå¦‚æœæˆ‘ä»¬æƒ³åŠ å…¥æ‰‹æŸ„æ”¯æŒï¼Œæˆ–è€…å…è®¸ç©å®¶è‡ªå®šä¹‰æŒ‰é”®æ˜ å°„ï¼Œæˆ‘ä»¬å°±å¯èƒ½éœ€è¦ä¿®æ”¹æ‰€æœ‰ `handleInput` çš„å®ç°ã€‚å¦‚æœæˆ‘ä»¬æƒ³å®ç°ä¸€ä¸ªAIæ¥æ§åˆ¶ç©å®¶ï¼ˆæ¯”å¦‚å½•åƒå›æ”¾ï¼‰ï¼ŒAIæ¨¡å—å°±éœ€è¦æ¨¡æ‹Ÿ `InputManager` çš„è¡Œä¸ºï¼Œè¿™éå¸¸ä¸ä¾¿ã€‚

## ğŸ“– ç¬¬ä¸€æ­¥ï¼šå°†è¾“å…¥æ£€æµ‹ä¸Šç§»è‡³ `PlayerComponent`

æˆ‘ä»¬çš„ç›®æ ‡æ˜¯è®© `PlayerState` å­ç±»å˜å¾—â€œçº¯ç²¹â€ï¼Œå®ƒä»¬ä¸å†å…³å¿ƒè¾“å…¥æ¥è‡ªä½•æ–¹ï¼Œåªå…³å¿ƒæ”¶åˆ°äº†ä»€ä¹ˆâ€œæŒ‡ä»¤â€ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬å°† `PlayerComponent::handleInput` çš„é€»è¾‘ä¿®æ”¹ä¸ºå®ƒè‡ªå·±æ¥æ£€æµ‹è¾“å…¥ï¼Œç„¶åè°ƒç”¨è‡ªèº«å¯¹åº”çš„åŠ¨ä½œæ–¹æ³•ã€‚

**`src/game/component/player_component.cpp` (ä¿®æ”¹)**
```cpp
void PlayerComponent::handleInput(engine::core::Context& context) {
    if (!current_state_) return;

    // --- åœ¨ PlayerComponent ä¸­ç»Ÿä¸€æ£€æµ‹è¾“å…¥ ---
    auto& input_manager = context.getInputManager();
    
    // åˆ¤æ–­å·¦å³ç§»åŠ¨æ“ä½œ
    if (input_manager.isActionDown("move_left")) moveLeft();
    else if (input_manager.isActionDown("move_right")) moveRight();
    
    // åˆ¤æ–­è·³è·ƒæˆ–ä¸Šä¸‹ç§»åŠ¨æ“ä½œ
    if (input_manager.isActionPressed("jump")) jump();
    else if (input_manager.isActionDown("move_up")) climbUp();
    else if (input_manager.isActionDown("move_down")) climbDown();
}
```
`PlayerComponent` ç°åœ¨æˆäº†å”¯ä¸€ä¸ `InputManager` ç›´æ¥äº¤äº’çš„åœ°æ–¹ã€‚å®ƒåƒä¸€ä¸ªâ€œæ€»æŒ‡æŒ¥â€ï¼Œè´Ÿè´£æ¥æ”¶å¤–éƒ¨è¾“å…¥ï¼Œç„¶åå‘å†…éƒ¨çš„çŠ¶æ€æœºä¸‹è¾¾æ˜ç¡®çš„æŒ‡ä»¤ï¼Œå¦‚ `moveLeft()`ã€`jump()` ç­‰ã€‚

## ğŸ“– ç¬¬äºŒæ­¥ï¼šåœ¨ `PlayerState` ä¸­å®šä¹‰åŠ¨ä½œæ¥å£

`PlayerComponent` è°ƒç”¨çš„ `moveLeft()` ç­‰æ–¹æ³•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®ƒä»¬ä¼šè¿›ä¸€æ­¥å°†è¯·æ±‚å§”æ‰˜ç»™å½“å‰çš„ `PlayerState` å¯¹è±¡ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ `PlayerState` åŸºç±»ä¸­å®šä¹‰ä¸€å¥—æ ‡å‡†çš„åŠ¨ä½œæ¥å£ã€‚

**`src/game/component/state/player_state.h` (ä¿®æ”¹)**
```cpp
class PlayerState {
// ...
public:
    // ...
    // --- å®šä¹‰ä¸€å¥—æ ‡å‡†çš„åŠ¨ä½œæ¥å£ ---
    virtual std::unique_ptr<PlayerState> moveLeft() { return nullptr; }
    virtual std::unique_ptr<PlayerState> moveRight() { return nullptr; }
    virtual std::unique_ptr<PlayerState> jump() { return nullptr; }
    virtual std::unique_ptr<PlayerState> climbUp() { return nullptr; }
    virtual std::unique_ptr<PlayerState> climbDown() { return nullptr; }

protected:
    virtual void enter() = 0;
    virtual void exit() = 0;
    // ä¸å†éœ€è¦ handleInput æ–¹æ³•
    // virtual std::unique_ptr<PlayerState> handleInput(engine::core::Context&) = 0;
    virtual std::unique_ptr<PlayerState> update(float, engine::core::Context&) = 0;
};
```
æˆ‘ä»¬å°† `handleInput` æ–¹æ³•å½»åº•ç§»é™¤ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä¸€ç»„ä»£è¡¨å…·ä½“åŠ¨ä½œçš„è™šå‡½æ•°ã€‚è¿™äº›å‡½æ•°éƒ½æœ‰é»˜è®¤å®ç°ï¼ˆè¿”å› `nullptr`ï¼‰ï¼Œè¿™æ„å‘³ç€å­ç±»**åªéœ€è¦é‡å†™å®ƒä»¬å…³å¿ƒçš„åŠ¨ä½œ**ã€‚ä¾‹å¦‚ï¼Œ`HurtState`ï¼ˆå—ä¼¤ç¡¬ç›´çŠ¶æ€ï¼‰å°±ä¸éœ€è¦å®ç°ä»»ä½•åŠ¨ä½œï¼Œå› ä¸ºå®ƒä¸å“åº”ä»»ä½•è¾“å…¥ã€‚

`PlayerComponent` ä¸­çš„åŠ¨ä½œæ–¹æ³•å®ç°å¦‚ä¸‹ï¼š

**`src/game/component/player_component.cpp` (ä¿®æ”¹)**
```cpp
void PlayerComponent::moveLeft() {
    // å°† moveLeft è¯·æ±‚å§”æ‰˜ç»™å½“å‰çŠ¶æ€
    auto next_state = current_state_->moveLeft();
    if (next_state) setState(std::move(next_state));
}

void PlayerComponent::jump() {
    // å°† jump è¯·æ±‚å§”æ‰˜ç»™å½“å‰çŠ¶æ€
    auto next_state = current_state_->jump();
    if (next_state) setState(std::move(next_state));
}
// ... å…¶ä»–åŠ¨ä½œæ–¹æ³•çš„å®ç°ç±»ä¼¼ ...
```

## ğŸ“– ç¬¬ä¸‰æ­¥ï¼šæ”¹é€ å…·ä½“çš„çŠ¶æ€ç±»

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…ç†æ‰€æœ‰çš„ `PlayerState` å­ç±»äº†ã€‚æˆ‘ä»¬å°†å®ƒä»¬å„è‡ªçš„ `handleInput` æ–¹æ³•ä¸­çš„é€»è¾‘ï¼Œæ‹†åˆ†åˆ°å¯¹åº”çš„åŠ¨ä½œæ–¹æ³•ä¸­ã€‚

ä»¥ `IdleState` ä¸ºä¾‹ï¼š

**`src/game/component/state/idle_state.cpp` (ä¿®æ”¹)**
```cpp
// ç§»é™¤ handleInput æ–¹æ³•...

std::unique_ptr<PlayerState> IdleState::moveLeft() {
    // åœ¨å¾…æœºçŠ¶æ€ä¸‹æ”¶åˆ°å‘å·¦ç§»åŠ¨çš„è¯·æ±‚ï¼Œåº”è¯¥åˆ‡æ¢åˆ°è¡Œèµ°çŠ¶æ€
    return std::make_unique<WalkState>(player_component_);
}

std::unique_ptr<PlayerState> IdleState::moveRight() {
    // åŒä¸Š
    return std::make_unique<WalkState>(player_component_);
}

std::unique_ptr<PlayerState> IdleState::jump() {
    // æ”¶åˆ°è·³è·ƒè¯·æ±‚ï¼Œåˆ‡æ¢åˆ°è·³è·ƒçŠ¶æ€
    return std::make_unique<JumpState>(player_component_);
}

std::unique_ptr<PlayerState> IdleState::climbUp() {
    auto physics_component = player_component_->getPhysicsComponent();
    // åªæœ‰åœ¨æ¥è§¦æ¢¯å­æ—¶ï¼Œå‘ä¸Šçˆ¬çš„è¯·æ±‚æ‰æœ‰æ•ˆ
    if (physics_component->hasCollidedLadder()) {
        return std::make_unique<ClimbState>(player_component_);
    }
    return nullptr; // å¦åˆ™å¿½ç•¥è¯¥è¯·æ±‚
}
// ... å…¶ä»–æ–¹æ³•çš„å®ç° ...
```

å†çœ‹ä¸€ä¸ªä¾‹å­ï¼Œ`WalkState`ï¼š

**`src/game/component/state/walk_state.cpp` (ä¿®æ”¹)**
```cpp
// ...
std::unique_ptr<PlayerState> WalkState::moveLeft() {
    // åœ¨è¡Œèµ°çŠ¶æ€ä¸‹æ”¶åˆ°å‘å·¦ç§»åŠ¨çš„è¯·æ±‚ï¼Œæ‰§è¡Œå‘å·¦ç§»åŠ¨çš„ç‰©ç†é€»è¾‘
    auto physics_component = player_component_->getPhysicsComponent();
    auto sprite_component = player_component_->getSpriteComponent();

    // ... (æ·»åŠ å‘å·¦çš„åŠ›ï¼Œç¿»è½¬ç²¾çµç­‰) ...

    is_moving_ = true; // æ ‡è®°æœ¬å¸§æœ‰ç§»åŠ¨è¾“å…¥
    return nullptr; // ä¸éœ€è¦åˆ‡æ¢çŠ¶æ€
}

std::unique_ptr<PlayerState> WalkState::update(float, engine::core::Context&)
{
    // ...
    // å¦‚æœæœ¬å¸§æ²¡æœ‰ä»»ä½•ç§»åŠ¨è¾“å…¥ (is_moving_ ä¸º false)ï¼Œåˆ™åˆ‡æ¢åˆ°å¾…æœºçŠ¶æ€
    if (!is_moving_) {
        return std::make_unique<IdleState>(player_component_);
    }
    // ...
    is_moving_ = false; // åœ¨ update çš„æœ€åé‡ç½®æ ‡å¿—ï¼Œä¸ºä¸‹ä¸€å¸§åšå‡†å¤‡
    return nullptr;
}
```
é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ¯ä¸ªçŠ¶æ€ç±»çš„èŒè´£å˜å¾—éå¸¸æ¸…æ™°ï¼š
*   **IdleState**: æ”¶åˆ° `moveLeft` è¯·æ±‚ -> åˆ‡æ¢åˆ° `WalkState`ã€‚
*   **WalkState**: æ”¶åˆ° `moveLeft` è¯·æ±‚ -> æ–½åŠ ä¸€ä¸ªåŠ›ï¼Œç»§ç»­ä¿æŒ `WalkState`ã€‚
*   **HurtState**: æ”¶åˆ° `moveLeft` è¯·æ±‚ -> (é»˜è®¤å®ç°) ä»€ä¹ˆéƒ½ä¸åšï¼Œå¿½ç•¥è¯·æ±‚ã€‚

## âœ¨ å°ç»“ (Part 1)

é€šè¿‡è¿™æ¬¡é‡æ„ï¼Œæˆ‘ä»¬å–å¾—äº†æ˜¾è‘—çš„è¿›æ­¥ï¼š
*   **èŒè´£åˆ†ç¦»**ï¼š`PlayerComponent` è´Ÿè´£â€œ**ç›‘å¬**â€è¾“å…¥ï¼Œ`PlayerState` è´Ÿè´£â€œ**å“åº”**â€åŠ¨ä½œã€‚äºŒè€…èŒè´£æ˜ç¡®ã€‚
*   **è§£è€¦**ï¼š`PlayerState` ä¸å†ä¸ `InputManager` è€¦åˆï¼Œå®ƒåªå“åº” `moveLeft()` è¿™æ ·çš„æŠ½è±¡æŒ‡ä»¤ã€‚
*   **ä»£ç æ›´æ¸…æ™°**ï¼šè¾“å…¥å¤„ç†é€»è¾‘è¢«é›†ä¸­åˆ°äº† `PlayerComponent` ä¸­ï¼ŒçŠ¶æ€ç±»çš„ä»£ç ä¹Ÿå˜å¾—æ›´åŠ çº¯ç²¹å’Œæ˜“äºç†è§£ã€‚

æˆ‘ä»¬æˆåŠŸåœ°åœ¨â€œè¾“å…¥æºâ€å’Œâ€œåŠ¨ä½œæ‰§è¡Œè€…â€ä¹‹é—´å»ºç«‹äº†ä¸€ä¸ªæ¸…æ™°çš„è¾¹ç•Œã€‚ç°åœ¨ï¼Œ`PlayerComponent` å°±åƒä¸€ä¸ªé¥æ§å™¨ï¼Œè€Œ `PlayerState` å°±åƒç”µè§†æœºå†…éƒ¨çš„ç”µè·¯ã€‚

è¿™ä¸ªâ€œé¥æ§å™¨â€è¿˜å¾ˆç®€å•ï¼Œå®ƒç›´æ¥è°ƒç”¨äº† `player->moveLeft()`ã€‚åœ¨ä¸‹ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†å¼•å…¥**å‘½ä»¤æ¨¡å¼**ï¼ŒæŠŠ `moveLeft()` è¿™ä¸ªè°ƒç”¨æœ¬èº«ä¹Ÿå°è£…æˆä¸€ä¸ªå¯¹è±¡ã€‚è¿™å°†ä¸ºæˆ‘ä»¬å¸¦æ¥å‰æ‰€æœªæœ‰çš„çµæ´»æ€§ï¼Œæ¯”å¦‚å®ç°æŒ‰é”®è‡ªå®šä¹‰ã€AIæ§åˆ¶ï¼Œç”šè‡³æ˜¯åŒäººåŒå±æ¸¸æˆï¼

---

åœ¨ä¸Šä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬æˆåŠŸåœ°é‡æ„äº†è¾“å…¥å¤„ç†æµç¨‹ï¼Œå°† `PlayerComponent` å¡‘é€ æˆäº†ä¸€ä¸ªâ€œæ€»æŒ‡æŒ¥â€ï¼Œå®ƒè´Ÿè´£æ£€æµ‹è¾“å…¥å¹¶è°ƒç”¨ç›¸åº”çš„åŠ¨ä½œæ–¹æ³•ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å°†å¼•å…¥**å‘½ä»¤æ¨¡å¼**ï¼Œå°†è¿™äº›â€œåŠ¨ä½œè°ƒç”¨â€æœ¬èº«ä¹Ÿå˜æˆå¯¹è±¡ã€‚è¿™å¬èµ·æ¥å¯èƒ½æœ‰ç‚¹æŠ½è±¡ï¼Œä½†å®ƒå°†è§£é”æˆ‘ä»¬è¾“å…¥ç³»ç»Ÿçš„å…¨éƒ¨æ½œåŠ›ï¼Œç”šè‡³èƒ½è½»æ¾å®ç°åŒäººåŒå±æ¸¸æˆã€‚

---

# Part 2: å°è£…è¯·æ±‚ä¸ºå¯¹è±¡

## ğŸ¯ è¯¾ç¨‹ç›®æ ‡

*   **ç†è§£å‘½ä»¤æ¨¡å¼**ï¼šå­¦ä¹ å¦‚ä½•å°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œå¯ç”¨ä¸åŒçš„è¯·æ±‚å¯¹å®¢æˆ·è¿›è¡Œå‚æ•°åŒ–ï¼Œå¯¹è¯·æ±‚æ’é˜Ÿæˆ–è®°å½•è¯·æ±‚æ—¥å¿—ï¼Œä»¥åŠæ”¯æŒå¯æ’¤é”€çš„æ“ä½œã€‚
*   **å®ç°å‘½ä»¤å¯¹è±¡**ï¼šä¸ºç©å®¶çš„æ¯ä¸ªåŠ¨ä½œï¼ˆ`moveLeft`, `jump` ç­‰ï¼‰åˆ›å»ºä¸€ä¸ªå…·ä½“çš„ `Command` å­ç±»ã€‚
*   **è§£è€¦è¯·æ±‚è€…ä¸æ¥æ”¶è€…**ï¼šå°†è¾“å…¥å¤„ç†ï¼ˆè¯·æ±‚è€…ï¼‰ä¸ `PlayerComponent`ï¼ˆæ¥æ”¶è€…ï¼‰å½»åº•è§£è€¦ï¼Œé€šè¿‡å‘½ä»¤å¯¹è±¡è¿›è¡Œé€šä¿¡ã€‚
*   **å®è·µåº”ç”¨**ï¼šåˆ©ç”¨å‘½ä»¤æ¨¡å¼çš„çµæ´»æ€§ï¼Œè½»æ¾å®ç°ä¸€ä¸ª**åŒäººåŒå±**çš„æ§åˆ¶åˆ‡æ¢åŠŸèƒ½ã€‚

## ğŸ¤” ä¸ºä»€ä¹ˆè¦æŠŠâ€œè°ƒç”¨ä¸€ä¸ªå‡½æ•°â€è¿™ä¹ˆç®€å•çš„äº‹æå¤æ‚ï¼Ÿ

æˆ‘ä»¬ç›®å‰çš„ `PlayerComponent::handleInput` æ˜¯è¿™æ ·çš„ï¼š
```cpp
// src/game/component/player_component.cpp (é‡æ„å)
void PlayerComponent::handleInput(engine::core::Context& context) {
    auto& input_manager = context.getInputManager();
    if (input_manager.isActionDown("move_left")) moveLeft();
    else if (input_manager.isActionDown("move_right")) moveRight();
    // ...
}
```
â€œæŒ‰ä¸‹Aé”®â€å’Œâ€œæ‰§è¡Œ`moveLeft()`â€è¿™ä¸¤ä¸ªæ¦‚å¿µè¢«ç›´æ¥ç»‘å®šåœ¨äº†ä¸€èµ·ã€‚è¿™åœ¨å•äººæ¸¸æˆä¸­ä¼¼ä¹æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³ï¼š

*   **è®©ç©å®¶è‡ªå®šä¹‰æŒ‰é”®ï¼Ÿ** æ¯”å¦‚æŠŠâ€œå‘å·¦ç§»åŠ¨â€ä»'A'é”®æ”¹æˆ'Q'é”®ã€‚æˆ‘ä»¬éœ€è¦ä¿®æ”¹ `InputManager` çš„é…ç½®ï¼Œä½†å¦‚æœé€»è¾‘æ›´å¤æ‚ï¼Œå¯èƒ½ä¼šå¾ˆéº»çƒ¦ã€‚
*   **è®©AIæ§åˆ¶ä¸€ä¸ªè§’è‰²ï¼Ÿ** AIæ¨¡å—éœ€è¦æ‰¾åˆ° `PlayerComponent` å®ä¾‹ï¼Œç„¶åç›´æ¥è°ƒç”¨ `moveLeft()`ã€‚AIå’Œç©å®¶ç»„ä»¶äº§ç”Ÿäº†è€¦åˆã€‚
*   **å®ç°åŒäººæ¸¸æˆï¼Ÿ** P1ç”¨WASDï¼ŒP2ç”¨æ–¹å‘é”®ï¼Œä»–ä»¬éƒ½æƒ³æ§åˆ¶å„è‡ªè§’è‰²çš„â€œå‘å·¦ç§»åŠ¨â€ã€‚`handleInput` é‡Œçš„ `if` è¯­å¥ä¼šå˜å¾—éå¸¸å¤æ‚ã€‚
*   **å®ç°ç½‘ç»œåŒæ­¥ï¼Ÿ** æˆ‘ä»¬ä¸èƒ½æŠŠâ€œAé”®è¢«æŒ‰ä¸‹â€è¿™ä¸ªäº‹ä»¶å‘é€åˆ°ç½‘ç»œä¸Šï¼Œå› ä¸ºå…¶ä»–ç©å®¶çš„æŒ‰é”®è®¾ç½®å¯èƒ½ä¸åŒã€‚æˆ‘ä»¬åº”è¯¥å‘é€â€œç©å®¶æ‰§è¡Œäº†â€˜å‘å·¦ç§»åŠ¨â€™è¿™ä¸ªåŠ¨ä½œâ€ã€‚

**å‘½ä»¤æ¨¡å¼**æ­£æ˜¯ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜è€Œç”Ÿçš„ã€‚å®ƒå°†â€œ**è¯·æ±‚**â€ï¼ˆæ¯”å¦‚â€œå‘å·¦ç§»åŠ¨â€ï¼‰æœ¬èº«å°è£…æˆä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œå°†â€œ**è°å‘å‡ºçš„è¯·æ±‚**â€ï¼ˆ`InputManager`ï¼‰å’Œâ€œ**è°æ‰§è¡Œè¯·æ±‚**â€ï¼ˆ`PlayerComponent`ï¼‰åˆ†ç¦»å¼€ã€‚

<img src="https://theorhythm.top/gamedev/opt/OPT.019.webp" alt=å‘½ä»¤æ¨¡å¼2" style="display: block; margin: auto; width: 800px;" />

<img src="https://theorhythm.top/gamedev/opt/OPT.018.webp" alt=å‘½ä»¤æ¨¡å¼3" style="display: block; margin: auto; width: 800px;" />

## ğŸ“– ç¬¬ä¸€æ­¥ï¼šå®šä¹‰å¹¶å®ç°å‘½ä»¤

### Step 1: åˆ›å»º `Command` åŸºç±»

æˆ‘ä»¬é¦–å…ˆåœ¨ `game/component/command/` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª `Command` æ¥å£ã€‚æ‰€æœ‰å…·ä½“çš„å‘½ä»¤éƒ½å°†ç»§æ‰¿è‡ªå®ƒã€‚

**`src/game/component/command/command.h` (æ–°å»º)**
```cpp
#pragma once

namespace game::component {
    class PlayerComponent;
}

namespace game::component::command {

/**
 * @brief å‘½ä»¤æ¨¡å¼ä¸­çš„å‘½ä»¤æŠ½è±¡åŸºç±»ã€‚
 */
class Command {
protected:
    PlayerComponent& player_component_; // æ¯ä¸ªå‘½ä»¤éƒ½éœ€è¦çŸ¥é“å®ƒè¦æ“ä½œå“ªä¸ªç©å®¶
public:
    Command(PlayerComponent& player_component) : player_component_(player_component) {}
    virtual ~Command() = default;

    virtual void execute() = 0; // æ‰€æœ‰å‘½ä»¤éƒ½æœ‰ä¸€ä¸ªæ‰§è¡Œæ¥å£
};

}   // namespace game::component::command
```

### Step 2: åˆ›å»ºå…·ä½“çš„å‘½ä»¤ç±»

ç°åœ¨ï¼Œæˆ‘ä»¬ä¸ºç©å®¶çš„æ¯ä¸€ä¸ªåŠ¨ä½œéƒ½åˆ›å»ºä¸€ä¸ªå…·ä½“çš„å‘½ä»¤ç±»ã€‚è¿™äº›ç±»éå¸¸ç®€å•ï¼Œå®ƒä»¬çš„ `execute()` æ–¹æ³•åªæ˜¯è°ƒç”¨ `PlayerComponent` å¯¹åº”çš„åŠ¨ä½œæ–¹æ³•ã€‚

**`src/game/component/command/left_command.h` (æ–°å»º)**
```cpp
#pragma once
#include "command.h"

namespace game::component::command {

class LeftCommand : public Command {
public:
    LeftCommand(PlayerComponent& player_component) : Command(player_component) {}
    void execute() override;
};

}   // namespace game::component::command
```
**`src/game/component/command/left_command.cpp` (æ–°å»º)**
```cpp
#include "left_command.h"
#include "../player_component.h"

namespace game::component::command {

void LeftCommand::execute() {
    player_component_.moveLeft();
}

}   // namespace game::component::command
```
åŒç†ï¼Œæˆ‘ä»¬åˆ›å»º `RightCommand`, `JumpCommand`, `UpCommand`, `DownCommand`ã€‚è¿™äº›å‘½ä»¤å¯¹è±¡å°±æ˜¯è¢«å°è£…èµ·æ¥çš„â€œè¯·æ±‚â€ã€‚

## ğŸ“– ç¬¬äºŒæ­¥ï¼šåœ¨ `GameScene` ä¸­ä½¿ç”¨å‘½ä»¤

ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåœ°æ–¹æ¥ç®¡ç†â€œè¾“å…¥â€å’Œâ€œå‘½ä»¤â€ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚`GameScene` æ˜¯ä¸€ä¸ªç†æƒ³çš„åœºæ‰€ï¼Œå› ä¸ºå®ƒç®¡ç†ç€åœºæ™¯ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼ŒåŒ…æ‹¬ç©å®¶ã€‚

### Step 1: å°†è¾“å…¥å¤„ç†é€»è¾‘ç§»è‡³ `GameScene`

æˆ‘ä»¬é¦–å…ˆå°† `PlayerComponent::handleInput` çš„é€»è¾‘å®Œå…¨è¿ç§»åˆ° `GameScene::handleInput` ä¸­ï¼Œå¹¶æ¸…ç©º `PlayerComponent` çš„ `handleInput` æ–¹æ³•ã€‚

**`src/game/component/player_component.h` (ä¿®æ”¹)**
```cpp
// ...
private:
    // æ ¸å¿ƒå¾ªç¯å‡½æ•°
    void init() override;
    // handleInput ä¸å†éœ€è¦äº†
    // void handleInput(engine::core::Context& context) override;
    void update(float delta_time, engine::core::Context& context) override;
// ...
```

### Step 2: å»ºç«‹è¾“å…¥åˆ°å‘½ä»¤çš„æ˜ å°„

`GameScene` å°†æŒæœ‰ä¸€ä¸ª `map`ï¼Œå°†è¾“å…¥çš„**åŠ¨ä½œåç§°**ï¼ˆå¦‚ "move_left"ï¼‰æ˜ å°„åˆ°ä¸€ä¸ªå…·ä½“çš„**å‘½ä»¤å¯¹è±¡**ã€‚

**`src/game/scene/game_scene.h` (ä¿®æ”¹)**
```cpp
// ...
#include <unordered_map>

namespace game::component::command {
    class Command;
}
// ...
class GameScene final: public engine::scene::Scene {
    // ...
private:
    // ...
    // å‘½ä»¤æ˜ å°„è¡¨ï¼Œå°†åŠ¨ä½œåç§°æ˜ å°„åˆ°å‘½ä»¤å¯¹è±¡
    std::unordered_map<std::string, std::unique_ptr<game::component::command::Command>> command_map_;
    
    // ...
    void setCommandMap(game::component::PlayerComponent& player_component);
};
```

`setCommandMap` æ–¹æ³•è´Ÿè´£å¡«å……è¿™ä¸ª `map`ï¼Œå®ƒå°†ä¸º**ç‰¹å®šçš„** `PlayerComponent` å®ä¾‹åˆ›å»ºä¸€å¥—å®Œæ•´çš„å‘½ä»¤å¯¹è±¡ã€‚

**`src/game/scene/game_scene.cpp` (ä¿®æ”¹)**
```cpp
#include "../component/command/up_command.h"
// ... åŒ…å«æ‰€æœ‰å…·ä½“ Command çš„å¤´æ–‡ä»¶ ...

void GameScene::setCommandMap(game::component::PlayerComponent& player_component)
{
    // ä½¿ç”¨ operator[] è¿›è¡Œè¦†ç›–æ€§æ’å…¥
    command_map_["move_up"] = std::make_unique<game::component::command::UpCommand>(player_component);
    command_map_["move_down"] = std::make_unique<game::component::command::DownCommand>(player_component);
    command_map_["move_left"] = std::make_unique<game::component::command::LeftCommand>(player_component);
    command_map_["move_right"] = std::make_unique<game::component::command::RightCommand>(player_component);
    command_map_["jump"] = std::make_unique<game::component::command::JumpCommand>(player_component);
}
```

åœ¨ `GameScene::init()` ä¸­ï¼Œæˆ‘ä»¬æ‰¾åˆ°ç©å®¶å¯¹è±¡åï¼Œç«‹å³ä¸ºå®ƒè®¾ç½®å‘½ä»¤æ˜ å°„ã€‚
```cpp
// src/game/scene/game_scene.cpp (ä¿®æ”¹)
void GameScene::init() {
    // ...
    if (!initPlayer()) { /* ... */ }

    // ä¸ºä¸»ç©å®¶è®¾ç½®å‘½ä»¤æ˜ å°„è¡¨
    if (auto player_component = player_->getComponent<game::component::PlayerComponent>(); player_component) {  
        setCommandMap(*player_component);
    } else {
        // ... é”™è¯¯å¤„ç† ...
    }
    // ...
}
```

### Step 3: æ‰§è¡Œå‘½ä»¤

æœ€åï¼Œ`GameScene::handleInput` çš„é€»è¾‘å˜ä¸ºï¼šæ£€æµ‹è¾“å…¥ï¼Œä» `map` ä¸­æ‰¾åˆ°å¯¹åº”çš„å‘½ä»¤å¯¹è±¡ï¼Œç„¶åè°ƒç”¨å®ƒçš„ `execute()` æ–¹æ³•ã€‚

**`src/game/scene/game_scene.cpp` (ä¿®æ”¹)**
```cpp
void GameScene::handleInput() {
    Scene::handleInput();
    // ... æš‚åœé€»è¾‘ ...

    // --- æ ¹æ®è¾“å…¥æ‰§è¡Œå¯¹åº”çš„å‘½ä»¤ ---
    if (context_.getInputManager().isActionDown("move_left")) {
        // æŸ¥æ‰¾ "move_left" å¯¹åº”çš„å‘½ä»¤
        if (auto command = command_map_.find("move_left"); command != command_map_.end()) {
            command->second->execute(); // æ‰§è¡Œå‘½ä»¤
        }
    } else if (context_.getInputManager().isActionDown("move_right")) {
        // ... æ‰§è¡Œ "move_right" å‘½ä»¤ ...
    }
    // ... å…¶ä»–è¾“å…¥çš„å¤„ç† ...
}
```
ç°åœ¨ï¼Œ`GameScene::handleInput` ä¸å†çŸ¥é“ `PlayerComponent` çš„å­˜åœ¨ï¼Œä¹Ÿä¸çŸ¥é“ `moveLeft()` è¿™ä¸ªæ–¹æ³•ã€‚å®ƒåªçŸ¥é“ï¼šâ€œå½“'move_left'åŠ¨ä½œè¢«è§¦å‘æ—¶ï¼Œæ‰§è¡Œä¸ä¹‹å…³è”çš„é‚£ä¸ªå‘½ä»¤å¯¹è±¡â€ã€‚**è¯·æ±‚è€…ï¼ˆ`GameScene`ï¼‰å’Œæ¥æ”¶è€…ï¼ˆ`PlayerComponent`ï¼‰è¢«å½»åº•è§£è€¦äº†ï¼**

## ğŸ“– ç¬¬ä¸‰æ­¥ï¼šå‘½ä»¤æ¨¡å¼çš„å¨åŠ›â€”â€”å®ç°åŒäººåŒå±

è§£è€¦å¸¦æ¥äº†å·¨å¤§çš„çµæ´»æ€§ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥å±•ç¤ºå‘½ä»¤æ¨¡å¼çš„å¨åŠ›ï¼šè½»æ¾å®ç°ä¸€ä¸ªâ€œåˆ‡æ¢æ§åˆ¶è§’è‰²â€çš„åŠŸèƒ½ï¼Œæ¨¡æ‹ŸåŒäººæ¸¸æˆã€‚

### Step 1: åœ¨åœ°å›¾ä¸­æ·»åŠ ç¬¬äºŒä¸ªç©å®¶

æˆ‘ä»¬åœ¨ Tiled ç¼–è¾‘å™¨ä¸­ï¼Œå¤åˆ¶ä¸€ä¸ªç©å®¶å¯¹è±¡ï¼Œå¹¶å°†å…¶å‘½åä¸º `player2`ã€‚æˆ‘ä»¬ç»™è¿™ä¸¤ä¸ªç©å®¶å¯¹è±¡éƒ½è®¾ç½®ä¸€ä¸ª "player" æ ‡ç­¾ï¼Œä»¥ä¾¿ `ObjectBuilderSL` èƒ½è¯†åˆ«å®ƒä»¬å¹¶æ·»åŠ  `PlayerComponent`ã€‚

**`assets/maps/level1.tmj` (ä¿®æ”¹)**
```json
// ... objectgroup "objects" ...
{
    "gid":608, "height":32, "id":20,
    "name":"player2",
    "properties":[
        {
         "name":"tag",
         "type":"string",
         "value":"player"
        }],
    // ...
}
```

**`src/game/object/object_builder_sl.cpp` (ä¿®æ”¹)**
```cpp
void ObjectBuilderSL::buildPlayer() {
    // ä¸å†æ ¹æ® name åˆ¤æ–­ï¼Œè€Œæ˜¯æ ¹æ® tag
    if (!tile_json_ || game_object_->getTag() != "player") return;
    
    // ... æ·»åŠ  PlayerComponent å’Œè®¾ç½®ç›¸æœº ...
    // æ³¨æ„ï¼šè¿™é‡Œä¸¤ä¸ªç©å®¶éƒ½ä¼šè®¾ç½®ç›¸æœºç›®æ ‡ï¼Œåè®¾ç½®çš„ä¼šè¦†ç›–å‰è€…ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„åˆå§‹çŠ¶æ€
}
```
### Step 2: å®ç°åˆ‡æ¢é€»è¾‘

æˆ‘ä»¬åœ¨ `GameScene` ä¸­æ·»åŠ ä¸€ä¸ª `switchPlayer()` æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¼šæ‰¾åˆ°åœºæ™¯ä¸­çš„ `player` å’Œ `player2`ï¼Œç„¶ååˆ‡æ¢ç›¸æœºç›®æ ‡ï¼Œå¹¶**é‡æ–°è®¾ç½®å‘½ä»¤æ˜ å°„è¡¨**ï¼Œå°†æ‰€æœ‰å‘½ä»¤çš„ç›®æ ‡æŒ‡å‘æ–°çš„ `PlayerComponent`ã€‚

**`src/game/scene/game_scene.cpp` (ä¿®æ”¹)**
```cpp
void GameScene::switchPlayer()
{
    spdlog::info("åˆ‡æ¢æ“æ§çš„ç©å®¶å¯¹è±¡");
    auto player2 = findGameObjectByName("player2");
    if (!player2) return;
    
    // ç”¨é™æ€å˜é‡è¿½è¸ªå½“å‰æ“æ§çš„ç©å®¶
    static engine::object::GameObject* current_player = player_;

    // åˆ‡æ¢ç©å®¶
    current_player = (current_player == player_) ? player2 : player_;

    // åˆ‡æ¢ç›¸æœºè·Ÿéšç›®æ ‡
    auto transform = current_player->getComponent<engine::component::TransformComponent>();
    context_.getCamera().setTarget(transform);

    // é‡æ–°ç»‘å®šå‘½ä»¤åˆ°æ–°çš„ç©å®¶ç»„ä»¶ï¼
    auto player_component = current_player->getComponent<game::component::PlayerComponent>();
    if (player_component) {
        setCommandMap(*player_component);
    }
}
```
æœ€åï¼Œåœ¨ `handleInput` ä¸­ï¼Œæˆ‘ä»¬ç›‘å¬ä¸€ä¸ªæŒ‰é”®ï¼ˆæ¯”å¦‚ "attack"ï¼Œå³Ké”®ï¼‰æ¥è§¦å‘è¿™ä¸ªåˆ‡æ¢ã€‚
```cpp
// src/game/scene/game_scene.cpp (ä¿®æ”¹)
void GameScene::handleInput() {
    // ...
    // æŒ‰ä¸‹ K é”®åˆ‡æ¢ç©å®¶
    if (context_.getInputManager().isActionPressed("attack")) {
        switchPlayer();
    }
}
```
ç°åœ¨è¿è¡Œæ¸¸æˆï¼Œä½ ä¼šçœ‹åˆ°ä¸¤ä¸ªç©å®¶è§’è‰²ã€‚æŒ‰ä¸‹ K é”®ï¼Œä½ ä¼šå‘ç°ä½ çš„æ“ä½œï¼ˆWASDå’ŒJï¼‰ç«‹å³ä»æ§åˆ¶ç¬¬ä¸€ä¸ªè§’è‰²åˆ‡æ¢åˆ°äº†ç¬¬äºŒä¸ªè§’è‰²ï¼æˆ‘ä»¬æ²¡æœ‰ä¿®æ”¹ä»»ä½•å…³äº `PlayerComponent` æˆ– `PlayerState` çš„ä»£ç ï¼Œä»…ä»…æ˜¯**é‡æ–°é…ç½®äº†å‘½ä»¤æ˜ å°„**ï¼Œå°±å®ç°äº†æ§åˆ¶æƒçš„è½¬ç§»ã€‚è¿™å°±æ˜¯å‘½ä»¤æ¨¡å¼çš„å¼ºå¤§ä¹‹å¤„ã€‚

## âœ¨ æ€»ç»“

é€šè¿‡å¼•å…¥å‘½ä»¤æ¨¡å¼ï¼Œæˆ‘ä»¬çš„è¾“å…¥ç³»ç»Ÿå˜å¾—å‰æ‰€æœªæœ‰çš„çµæ´»å’Œå¼ºå¤§ï¼š
*   **å®Œå…¨è§£è€¦**ï¼šè¾“å…¥å¤„ç†é€»è¾‘ï¼ˆ`GameScene`ï¼‰ä¸çŸ¥é“ç©å®¶çš„å­˜åœ¨ï¼Œç©å®¶ï¼ˆ`PlayerComponent`ï¼‰ä¹Ÿä¸çŸ¥é“è¾“å…¥æ¥è‡ªä½•æ–¹ã€‚å®ƒä»¬é€šè¿‡æŠ½è±¡çš„ `Command` å¯¹è±¡è¿›è¡Œé€šä¿¡ã€‚
*   **è¯·æ±‚å¯¹è±¡åŒ–**ï¼šå°†â€œå‘å·¦ç§»åŠ¨â€è¿™ä¸ªåŠ¨ä½œå˜æˆäº†ä¸€ä¸ª `LeftCommand` å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡å¯ä»¥è¢«å­˜å‚¨ã€ä¼ é€’ã€ç”šè‡³é€šè¿‡ç½‘ç»œå‘é€ã€‚
*   **é«˜åº¦å¯é…ç½®**ï¼šæˆ‘ä»¬å¯ä»¥è½»æ˜“åœ°æ”¹å˜ `command_map_` ä¸­çš„æ˜ å°„ï¼Œå®ç°æŒ‰é”®è‡ªå®šä¹‰ï¼Œæˆ–è€…åƒæˆ‘ä»¬åšçš„é‚£æ ·ï¼Œå°†ä¸€æ•´å¥—æ§åˆ¶ç»‘å®šåˆ°ä¸åŒçš„è§’è‰²ä¸Šã€‚
*   **æ˜“äºæ‰©å±•**ï¼šå¦‚æœæƒ³æ·»åŠ ä¸€ä¸ªâ€œå†²åˆºâ€åŠ¨ä½œï¼Œæˆ‘ä»¬åªéœ€ï¼š
    1.  åœ¨ `PlayerState` ä¸­æ·»åŠ  `dash()` æ¥å£ã€‚
    2.  åœ¨ `PlayerComponent` ä¸­æ·»åŠ  `dash()` æ–¹æ³•ã€‚
    3.  åˆ›å»ºä¸€ä¸ª `DashCommand` ç±»ã€‚
    4.  åœ¨ `GameScene` ä¸­å°† "dash" è¾“å…¥åŠ¨ä½œæ˜ å°„åˆ° `DashCommand` å®ä¾‹ã€‚æ•´ä¸ªè¿‡ç¨‹æ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç ï¼Œç¬¦åˆå¼€é—­åŸåˆ™ã€‚

å‘½ä»¤æ¨¡å¼æ˜¯æ„å»ºå¤æ‚äº¤äº’ç³»ç»Ÿï¼ˆå¦‚å¯è‡ªå®šä¹‰è¾“å…¥çš„åŠ¨ä½œæ¸¸æˆã€ç­–ç•¥æ¸¸æˆä¸­çš„å•ä½æŒ‡ä»¤ã€ç¼–è¾‘å™¨ä¸­çš„æ’¤é”€/é‡åšåŠŸèƒ½ï¼‰çš„åŸºçŸ³ã€‚æŒæ¡å®ƒï¼Œä½ å°±èƒ½æ„å»ºå‡ºæ›´ä¸“ä¸šã€æ›´çµæ´»çš„æ¸¸æˆç³»ç»Ÿã€‚